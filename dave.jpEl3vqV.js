import"./chunk.9p4a8sJU.js";import{g as te,S as _r}from"./chunk.sw_-D95Y.js";import{C as Ds,V as qe,a as Mt,b as Rt,M as Vr,c as Sr,E as Oo,d as bo,L as es,S as Ar,e as Mr,I as wr,f as Er,D as Do,g as Rr,h as Lr,F as zo,i as zs,N as ao,j as Cr,W as Ir,k as Fo,l as Or,m as br,U as Dr,n as zr,o as Fr,p as Pr,q as Ur,T as co,O as Br,r as Vs,s as Gr,R as Wr,t as kr,A as Hr,u as $r,v as Xr,B as qr,w as uo,x as Ss,H as jr,P as Yr,y as Zr,z as Po,G as Jr,J as Kr,K as Uo,Q as Qr,X as Bo,Y as ea,Z as ta,_ as sa,$ as oa,a0 as na,a1 as ia,a2 as ra}from"./chunk.uVdaq5N5.js";const lo={VERTEX:"vertex",FRAGMENT:"fragment"},Q={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},Fs=["x","y","z","w"];function Go(o){let e="{";o.isNode===!0&&(e+=o.id);for(const{property:t,childNode:s}of Ht(o))e+=","+t.slice(0,-4)+":"+s.getCacheKey();return e+="}",e}function*Ht(o,e=!1){for(const t in o){if(t.startsWith("_")===!0)continue;const s=o[t];if(Array.isArray(s)===!0)for(let n=0;n<s.length;n++){const i=s[n];i&&(i.isNode===!0||e&&typeof i.toJSON=="function")&&(yield{property:t,index:n,childNode:i})}else if(s&&s.isNode===!0)yield{property:t,childNode:s};else if(typeof s=="object")for(const n in s){const i=s[n];i&&(i.isNode===!0||e&&typeof i.toJSON=="function")&&(yield{property:t,index:n,childNode:i})}}}function tt(o){if(o==null)return null;const e=typeof o;return o.isNode===!0?"node":e==="number"?"float":e==="boolean"?"bool":e==="string"?"string":e==="function"?"shader":o.isVector2===!0?"vec2":o.isVector3===!0?"vec3":o.isVector4===!0?"vec4":o.isMatrix3===!0?"mat3":o.isMatrix4===!0?"mat4":o.isColor===!0?"color":o instanceof ArrayBuffer?"ArrayBuffer":null}function Wo(o,...e){const t=o?o.slice(-4):void 0;return e.length===1&&(t==="vec2"?e=[e[0],e[0]]:t==="vec3"?e=[e[0],e[0],e[0]]:t==="vec4"&&(e=[e[0],e[0],e[0],e[0]])),o==="color"?new Ds(...e):t==="vec2"?new qe(...e):t==="vec3"?new Mt(...e):t==="vec4"?new Rt(...e):t==="mat3"?new Vr(...e):t==="mat4"?new Sr(...e):o==="bool"?e[0]||!1:o==="float"||o==="int"||o==="uint"?e[0]||0:o==="string"?e[0]||"":o==="ArrayBuffer"?Ho(e[0]):null}function ko(o){let e="";const t=new Uint8Array(o);for(let s=0;s<t.length;s++)e+=String.fromCharCode(t[s]);return btoa(e)}function Ho(o){return Uint8Array.from(atob(o),e=>e.charCodeAt(0)).buffer}const ho=new Map;let aa=0;class E extends Oo{constructor(e=null){super(),this.nodeType=e,this.updateType=Q.NONE,this.updateBeforeType=Q.NONE,this.uuid=bo.generateUUID(),this.isNode=!0,Object.defineProperty(this,"id",{value:aa++})}get type(){return this.constructor.type}getSelf(){return this.self||this}updateReference(){return this}isGlobal(){return!1}*getChildren(){for(const{childNode:e}of Ht(this))yield e}dispose(){this.dispatchEvent({type:"dispose"})}traverse(e){e(this);for(const t of this.getChildren())t.traverse(e)}getCacheKey(){return Go(this)}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getNodeType(e){const t=e.getNodeProperties(this);return t.outputNode?t.outputNode.getNodeType(e):this.nodeType}getShared(e){const t=this.getHash(e);return e.getNodeFromHash(t)||this}setup(e){const t=e.getNodeProperties(this);for(const s of this.getChildren())t["_node"+s.id]=s;return null}construct(e){return console.warn("THREE.Node: construct() is deprecated. Use setup() instead."),this.setup(e)}analyze(e){const t=e.getDataFromNode(this);if(t.dependenciesCount=t.dependenciesCount===void 0?1:t.dependenciesCount+1,t.dependenciesCount===1){const s=e.getNodeProperties(this);for(const n of Object.values(s))n&&n.isNode===!0&&n.build(e)}}generate(e,t){const{outputNode:s}=e.getNodeProperties(this);if(s&&s.isNode===!0)return s.build(e,t)}updateBefore(){console.warn("Abstract function.")}update(){console.warn("Abstract function.")}build(e,t=null){const s=this.getShared(e);if(this!==s)return s.build(e,t);e.addNode(this),e.addChain(this);let n=null;const i=e.getBuildStage();if(i==="setup"){const r=e.getNodeProperties(this);if(r.initialized!==!0||e.context.tempRead===!1){const a=e.stack.nodes.length;r.initialized=!0,r.outputNode=this.setup(e),r.outputNode!==null&&e.stack.nodes.length!==a&&(r.outputNode=e.stack);for(const c of Object.values(r))c&&c.isNode===!0&&c.build(e)}}else if(i==="analyze")this.analyze(e);else if(i==="generate")if(this.generate.length===1){const a=this.getNodeType(e),c=e.getDataFromNode(this);n=c.snippet,n===void 0&&(n=this.generate(e)||"",c.snippet=n),n=e.format(n,a,t)}else n=this.generate(e,t)||"";return e.removeChain(this),n}getSerializeChildren(){return Ht(this)}serialize(e){const t=this.getSerializeChildren(),s={};for(const{property:n,index:i,childNode:r}of t)i!==void 0?(s[n]===void 0&&(s[n]=Number.isInteger(i)?[]:{}),s[n][i]=r.toJSON(e.meta).uuid):s[n]=r.toJSON(e.meta).uuid;Object.keys(s).length>0&&(e.inputNodes=s)}deserialize(e){if(e.inputNodes!==void 0){const t=e.meta.nodes;for(const s in e.inputNodes)if(Array.isArray(e.inputNodes[s])){const n=[];for(const i of e.inputNodes[s])n.push(t[i]);this[s]=n}else if(typeof e.inputNodes[s]=="object"){const n={};for(const i in e.inputNodes[s]){const r=e.inputNodes[s][i];n[i]=t[r]}this[s]=n}else{const n=e.inputNodes[s];this[s]=t[n]}}}toJSON(e){const{uuid:t,type:s}=this,n=e===void 0||typeof e=="string";n&&(e={textures:{},images:{},nodes:{}});let i=e.nodes[t];i===void 0&&(i={uuid:t,type:s,meta:e,metadata:{version:4.6,type:"Node",generator:"Node.toJSON"}},n!==!0&&(e.nodes[i.uuid]=i),this.serialize(i),delete i.meta);function r(a){const c=[];for(const u in a){const l=a[u];delete l.metadata,c.push(l)}return c}if(n){const a=r(e.textures),c=r(e.images),u=r(e.nodes);a.length>0&&(i.textures=a),c.length>0&&(i.images=c),u.length>0&&(i.nodes=u)}return i}}function x(o,e){if(typeof e!="function"||!o)throw new Error(`Node class ${o} is not a class`);if(ho.has(o)){console.warn(`Redefinition of node class ${o}`);return}ho.set(o,e),e.type=o}class ts extends E{constructor(e,t=null){super(t),this.isInputNode=!0,this.value=e,this.precision=null}getNodeType(){return this.nodeType===null?tt(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}setPrecision(e){return this.precision=e,this}serialize(e){super.serialize(e),e.value=this.value,this.value&&this.value.toArray&&(e.value=this.value.toArray()),e.valueType=tt(this.value),e.nodeType=this.nodeType,e.valueType==="ArrayBuffer"&&(e.value=ko(e.value)),e.precision=this.precision}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=Array.isArray(e.value)?Wo(e.valueType,...e.value):e.value,this.precision=e.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(e.value))}generate(){console.warn("Abstract function.")}}x("InputNode",ts);class Ps extends E{constructor(e,t=!1){super("string"),this.name=e,this.version=0,this.shared=t,this.isUniformGroup=!0}set needsUpdate(e){e===!0&&this.version++}}const ca=o=>new Ps(o),$o=o=>new Ps(o,!0);$o("frame");$o("render");const ua=ca("object");x("UniformGroupNode",Ps);class Us extends E{constructor(e,t){super(),this.node=e,this.indexNode=t,this.isArrayElementNode=!0}getNodeType(e){return this.node.getNodeType(e)}generate(e){const t=this.node.build(e),s=this.indexNode.build(e,"uint");return`${t}[ ${s} ]`}}x("ArrayElementNode",Us);class Bs extends E{constructor(e,t){super(),this.node=e,this.convertTo=t}getNodeType(e){const t=this.node.getNodeType(e);let s=null;for(const n of this.convertTo.split("|"))(s===null||e.getTypeLength(t)===e.getTypeLength(n))&&(s=n);return s}serialize(e){super.serialize(e),e.convertTo=this.convertTo}deserialize(e){super.deserialize(e),this.convertTo=e.convertTo}generate(e,t){const s=this.node,n=this.getNodeType(e),i=s.build(e,n);return e.format(i,n,t)}}x("ConvertNode",Bs);class $ extends E{constructor(e){super(e),this.isTempNode=!0}hasDependencies(e){return e.getDataFromNode(this).dependenciesCount>1}build(e,t){if(e.getBuildStage()==="generate"){const n=e.getVectorType(this.getNodeType(e,t)),i=e.getDataFromNode(this);if(e.context.tempRead!==!1&&i.propertyName!==void 0)return e.format(i.propertyName,n,t);if(e.context.tempWrite!==!1&&n!=="void"&&t!=="void"&&this.hasDependencies(e)){const r=super.build(e,n),a=e.getVarFromNode(this,null,n),c=e.getPropertyName(a);return e.addLineFlowCode(`${c} = ${r}`),i.snippet=r,i.propertyName=c,e.format(i.propertyName,n,t)}}return super.build(e,t)}}x("TempNode",$);class Xo extends ${constructor(e=[],t=null){super(t),this.nodes=e}getNodeType(e){return this.nodeType!==null?e.getVectorType(this.nodeType):e.getTypeFromLength(this.nodes.reduce((t,s)=>t+e.getTypeLength(s.getNodeType(e)),0))}generate(e,t){const s=this.getNodeType(e),n=this.nodes,i=e.getPrimitiveType(s),r=[];for(const c of n){let u=c.build(e);const l=e.getPrimitiveType(c.getNodeType(e));l!==i&&(u=e.format(u,l,i)),r.push(u)}const a=`${e.getType(s)}( ${r.join(", ")} )`;return e.format(a,s,t)}}x("JoinNode",Xo);const la=Fs.join("");class As extends E{constructor(e,t="x"){super(),this.node=e,this.components=t,this.isSplitNode=!0}getVectorLength(){let e=this.components.length;for(const t of this.components)e=Math.max(Fs.indexOf(t)+1,e);return e}getPrimitiveType(e){return e.getPrimitiveType(this.node.getNodeType(e))}getNodeType(e){return e.getTypeFromLength(this.components.length,this.getPrimitiveType(e))}generate(e,t){const s=this.node,n=e.getTypeLength(s.getNodeType(e));let i=null;if(n>1){let r=null;this.getVectorLength()>=n&&(r=e.getTypeFromLength(this.getVectorLength(),this.getPrimitiveType(e)));const c=s.build(e,r);this.components.length===n&&this.components===la.slice(0,this.components.length)?i=e.format(c,r,t):i=e.format(`${c}.${this.components}`,this.getNodeType(e),t)}else i=s.build(e,t);return i}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}}x("SplitNode",As);class qo extends ${constructor(e,t,s){super(),this.sourceNode=e,this.components=t,this.targetNode=s}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{sourceNode:t,components:s,targetNode:n}=this,i=this.getNodeType(e),r=e.getTypeFromLength(s.length),a=n.build(e,r),c=t.build(e,i),u=e.getTypeLength(i),l=[];for(let p=0;p<u;p++){const f=Fs[p];f===s[0]?(l.push(a),p+=s.length-1):l.push(c+"."+f)}return`${e.getType(i)}( ${l.join(", ")} )`}}x("SetNode",qo);class Ie extends ts{constructor(e,t=null){super(e,t),this.isConstNode=!0}generateConst(e){return e.generateConst(this.getNodeType(e),this.value)}generate(e,t){const s=this.getNodeType(e);return e.format(this.generateConst(e),s,t)}}x("ConstNode",Ie);let yt=null;const dt=new Map;function g(o,e){if(dt.has(o)){console.warn(`Redefinition of node element ${o}`);return}if(typeof e!="function")throw new Error(`Node element ${o} is not a function`);dt.set(o,e)}const po=o=>o.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),jo={setup(o,e){const t=e.shift();return o(ns(t),...e)},get(o,e,t){if(typeof e=="string"&&o[e]===void 0){if(o.isStackNode!==!0&&e==="assign")return(...s)=>(yt.assign(t,...s),t);if(dt.has(e)){const s=dt.get(e);return o.isStackNode?(...n)=>t.add(s(...n)):(...n)=>s(t,...n)}else{if(e==="self")return o;if(e.endsWith("Assign")&&dt.has(e.slice(0,e.length-6))){const s=dt.get(e.slice(0,e.length-6));return o.isStackNode?(...n)=>t.assign(n[0],s(...n)):(...n)=>t.assign(s(t,...n))}else{if(/^[xyzwrgbastpq]{1,4}$/.test(e)===!0)return e=po(e),w(new As(t,e));if(/^set[XYZWRGBASTPQ]{1,4}$/.test(e)===!0)return e=po(e.slice(3).toLowerCase()),e=e.split("").sort().join(""),s=>w(new qo(o,e,s));if(e==="width"||e==="height"||e==="depth")return e==="width"?e="x":e==="height"?e="y":e==="depth"&&(e="z"),w(new As(o,e));if(/^\d+$/.test(e)===!0)return w(new Us(t,new Ie(Number(e),"uint")))}}}return Reflect.get(o,e,t)},set(o,e,t,s){return typeof e=="string"&&o[e]===void 0&&(/^[xyzwrgbastpq]{1,4}$/.test(e)===!0||e==="width"||e==="height"||e==="depth"||/^\d+$/.test(e)===!0)?(s[e].assign(t),!0):Reflect.set(o,e,t,s)}},ls=new WeakMap,mo=new WeakMap,da=function(o,e=null){const t=tt(o);if(t==="node"){let s=ls.get(o);return s===void 0&&(s=new Proxy(o,jo),ls.set(o,s),ls.set(s,s)),s}else{if(e===null&&(t==="float"||t==="boolean")||t&&t!=="shader"&&t!=="string")return w(Ms(o,e));if(t==="shader")return T(o)}return o},ha=function(o,e=null){for(const t in o)o[t]=w(o[t],e);return o},pa=function(o,e=null){const t=o.length;for(let s=0;s<t;s++)o[s]=w(o[s],e);return o},ma=function(o,e=null,t=null,s=null){const n=i=>w(s!==null?Object.assign(i,s):i);return e===null?(...i)=>n(new o(...mt(i))):t!==null?(t=w(t),(...i)=>n(new o(e,...mt(i),t))):(...i)=>n(new o(e,...mt(i)))},fa=function(o,...e){return w(new o(...mt(e)))};class ga extends E{constructor(e,t){super(),this.shaderNode=e,this.inputNodes=t}getNodeType(e){const{outputNode:t}=e.getNodeProperties(this);return t?t.getNodeType(e):super.getNodeType(e)}call(e){const{shaderNode:t,inputNodes:s}=this;if(t.layout){let r=mo.get(e.constructor);r===void 0&&(r=new WeakMap,mo.set(e.constructor,r));let a=r.get(t);return a===void 0&&(a=w(e.buildFunctionNode(t)),r.set(t,a)),e.currentFunctionNode!==null&&e.currentFunctionNode.includes.push(a),w(a.call(s))}const n=t.jsFunc,i=s!==null?n(s,e.stack,e):n(e.stack,e);return w(i)}setup(e){return e.addStack(),e.stack.outputNode=this.call(e),e.removeStack()}generate(e,t){const{outputNode:s}=e.getNodeProperties(this);return s===null?this.call(e).build(e,t):super.generate(e,t)}}class Na extends E{constructor(e){super(),this.jsFunc=e,this.layout=null}get isArrayInput(){return/^\(\s+?\[/.test(this.jsFunc.toString())}setLayout(e){return this.layout=e,this}call(e=null){return ns(e),w(new ga(this,e))}setup(){return this.call()}}const ya=[!1,!0],xa=[0,1,2,3],Ta=[-1,-2],Yo=[.5,1.5,1/3,1e-6,1e6,Math.PI,Math.PI*2,1/Math.PI,2/Math.PI,1/(Math.PI*2),Math.PI/2],Gs=new Map;for(const o of ya)Gs.set(o,new Ie(o));const Ws=new Map;for(const o of xa)Ws.set(o,new Ie(o,"uint"));const ks=new Map([...Ws].map(o=>new Ie(o.value,"int")));for(const o of Ta)ks.set(o,new Ie(o,"int"));const ss=new Map([...ks].map(o=>new Ie(o.value)));for(const o of Yo)ss.set(o,new Ie(o));for(const o of Yo)ss.set(-o,new Ie(-o));const os={bool:Gs,uint:Ws,ints:ks,float:ss},fo=new Map([...Gs,...ss]),Ms=(o,e)=>fo.has(o)?fo.get(o):o.isNode===!0?o:new Ie(o,e),va=o=>{try{return o.getNodeType()}catch{return}},H=function(o,e=null){return(...t)=>{if((t.length===0||!["bool","float","int","uint"].includes(o)&&t.every(n=>typeof n!="object"))&&(t=[Wo(o,...t)]),t.length===1&&e!==null&&e.has(t[0]))return w(e.get(t[0]));if(t.length===1){const n=Ms(t[0],o);return va(n)===o?w(n):w(new Bs(n,o))}const s=t.map(n=>Ms(n));return w(new Xo(s,o))}},_a=o=>o!=null?o.nodeType||o.convertTo||(typeof o=="string"?o:null):null;function wt(o){return new Proxy(new Na(o),jo)}const w=(o,e=null)=>da(o,e),ns=(o,e=null)=>new ha(o,e),mt=(o,e=null)=>new pa(o,e),N=(...o)=>new ma(...o),S=(...o)=>new fa(...o),T=o=>{const e=new wt(o),t=(...s)=>{let n;return ns(s),s[0]&&s[0].isNode?n=[...s]:n=s[0],e.call(n)};return t.shaderNode=e,t.setLayout=s=>(e.setLayout(s),t),t};x("ShaderNode",wt);const go=o=>{yt=o},Va=()=>yt,W=(...o)=>yt.if(...o);function Sa(o){return yt&&yt.add(o),o}g("append",Sa);const Aa=new H("color"),h=new H("float",os.float),d=new H("int",os.int),A=new H("uint",os.uint),st=new H("bool",os.bool),L=new H("vec2"),Zo=new H("ivec2"),Ma=new H("uvec2"),wa=new H("bvec2"),y=new H("vec3"),Ea=new H("ivec3"),zt=new H("uvec3"),Jo=new H("bvec3"),P=new H("vec4"),Ra=new H("ivec4"),La=new H("uvec4"),Ca=new H("bvec4"),xt=new H("mat3"),Ia=new H("imat3"),Oa=new H("umat3"),ba=new H("bmat3"),Ko=new H("mat4"),Da=new H("imat4"),za=new H("umat4"),Fa=new H("bmat4"),Pa=(o="")=>w(new Ie(o,"string")),Ua=o=>w(new Ie(o,"ArrayBuffer"));g("color",Aa);g("float",h);g("int",d);g("uint",A);g("bool",st);g("vec2",L);g("ivec2",Zo);g("uvec2",Ma);g("bvec2",wa);g("vec3",y);g("ivec3",Ea);g("uvec3",zt);g("bvec3",Jo);g("vec4",P);g("ivec4",Ra);g("uvec4",La);g("bvec4",Ca);g("mat3",xt);g("imat3",Ia);g("umat3",Oa);g("bmat3",ba);g("mat4",Ko);g("imat4",Da);g("umat4",za);g("bmat4",Fa);g("string",Pa);g("arrayBuffer",Ua);const Ba=N(Us),Ga=(o,e)=>w(new Bs(w(o),e));g("element",Ba);g("convert",Ga);class Ze extends ts{constructor(e,t=null){super(e,t),this.isUniformNode=!0,this.groupNode=ua}setGroup(e){return this.groupNode=e,this}getGroup(){return this.groupNode}getUniformHash(e){return this.getHash(e)}generate(e,t){const s=this.getNodeType(e),n=this.getUniformHash(e);let i=e.getNodeFromHash(n);i===void 0&&(e.setHashNode(this,n),i=this);const r=i.getInputType(e),a=e.getUniformFromNode(i,r,e.shaderStage,e.context.label),c=e.getPropertyName(a);return e.context.label!==void 0&&delete e.context.label,e.format(c,s,t)}}const Z=(o,e)=>{const t=_a(e||o),s=o&&o.isNode===!0?o.node&&o.node.value||o.value:o;return w(new Ze(s,t))};x("UniformNode",Ze);class Wa extends Ze{constructor(e=[]){super(),this.isArrayUniformNode=!0,this.nodes=e}getNodeType(e){return this.nodes[0].getNodeType(e)}}x("ArrayUniformNode",Wa);class Qo extends ${constructor(e,t){super(),this.targetNode=e,this.sourceNode=t}hasDependencies(){return!1}getNodeType(e,t){return t!=="void"?this.targetNode.getNodeType(e):"void"}generate(e,t){const s=this.targetNode,n=this.sourceNode,i=s.getNodeType(e),r=s.build(e),a=n.build(e,i),c=`${r} = ${a}`;if(t==="void"){e.addLineFlowCode(c);return}else return n.getNodeType(e)==="void"?(e.addLineFlowCode(c),r):e.format(c,i,t)}}const ka=N(Qo);x("AssignNode",Qo);g("assign",ka);class en extends E{constructor(e,t=null){super(),this.node=e,this.name=t,this.isVaryingNode=!0}isGlobal(){return!0}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}generate(e){const{name:t,node:s}=this,n=this.getNodeType(e),i=e.getVaryingFromNode(this,t,n);i.needsInterpolation||(i.needsInterpolation=e.shaderStage==="fragment");const r=e.getPropertyName(i,lo.VERTEX);return e.flowNodeFromShaderStage(lo.VERTEX,s,n,r),e.getPropertyName(i)}}const Y=N(en);g("varying",Y);x("VaryingNode",en);class Hs extends E{constructor(e,t=null){super(t),this._attributeName=e}isGlobal(){return!0}getHash(e){return this.getAttributeName(e)}getNodeType(e){let t=super.getNodeType(e);if(t===null){const s=this.getAttributeName(e);if(e.hasGeometryAttribute(s)){const n=e.geometry.getAttribute(s);t=e.getTypeFromAttribute(n)}else t="float"}return t}setAttributeName(e){return this._attributeName=e,this}getAttributeName(){return this._attributeName}generate(e){const t=this.getAttributeName(e),s=this.getNodeType(e);if(e.hasGeometryAttribute(t)===!0){const i=e.geometry.getAttribute(t),r=e.getTypeFromAttribute(i),a=e.getAttribute(t,r);return e.shaderStage==="vertex"?e.format(a.name,r,s):Y(this).build(e,s)}else return console.warn(`AttributeNode: Attribute "${t}" not found.`),e.generateConst(s)}}const Ne=(o,e)=>w(new Hs(o,e));x("AttributeNode",Hs);class tn extends E{constructor(e,t){super(),this.isBypassNode=!0,this.outputNode=e,this.callNode=t}getNodeType(e){return this.outputNode.getNodeType(e)}generate(e){const t=this.callNode.build(e,"void");return t!==""&&e.addLineFlowCode(t),this.outputNode.build(e)}}const sn=N(tn);g("bypass",sn);x("BypassNode",tn);let Ha=0;class $a{constructor(){this.id=Ha++,this.nodesData=new WeakMap}getNodeData(e){return this.nodesData.get(e)}setNodeData(e,t){this.nodesData.set(e,t)}}class on extends E{constructor(e,t=new $a){super(),this.isCacheNode=!0,this.node=e,this.cache=t}getNodeType(e){return this.node.getNodeType(e)}build(e,...t){const s=e.getCache(),n=this.cache||e.globalCache;e.setCache(n);const i=this.node.build(e,...t);return e.setCache(s),i}}const $t=N(on),Xa=o=>$t(o,null);g("cache",$t);g("globalCache",Xa);x("CacheNode",on);class $s extends E{constructor(e,t={}){super(),this.isContextNode=!0,this.node=e,this.context=t}getNodeType(e){return this.node.getNodeType(e)}setup(e){const t=e.getContext();e.setContext({...e.context,...this.context});const s=this.node.build(e);return e.setContext(t),s}generate(e,t){const s=e.getContext();e.setContext({...e.context,...this.context});const n=this.node.build(e,t);return e.setContext(s),n}}const He=N($s),nn=(o,e)=>He(o,{label:e});g("context",He);g("label",nn);x("ContextNode",$s);class Pe extends E{constructor(e){super("uint"),this.scope=e,this.isInstanceIndexNode=!0}generate(e){const t=this.getNodeType(e),s=this.scope;let n;if(s===Pe.VERTEX)n=e.getVertexIndex();else if(s===Pe.INSTANCE)n=e.getInstanceIndex();else throw new Error("THREE.IndexNode: Unknown scope: "+s);let i;return e.shaderStage==="vertex"||e.shaderStage==="compute"?i=n:i=Y(this).build(e,t),i}}Pe.VERTEX="vertex";Pe.INSTANCE="instance";const qa=S(Pe,Pe.VERTEX),ja=S(Pe,Pe.INSTANCE);x("IndexNode",Pe);class rn{start(){}finish(){}direct(){}indirectDiffuse(){}indirectSpecular(){}ambientOcclusion(){}}class an extends E{constructor(e,t=null){super(),this.node=e,this.name=t,this.isVarNode=!0}isGlobal(){return!0}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}generate(e){const{node:t,name:s}=this,n=e.getVarFromNode(this,s,e.getVectorType(this.getNodeType(e))),i=e.getPropertyName(n),r=t.build(e,n.type);return e.addLineFlowCode(`${i} = ${r}`),i}}const Lt=N(an);g("temp",Lt);g("toVar",(...o)=>Lt(...o).append());x("VarNode",an);class ee extends E{constructor(e,t=null,s=!1){super(e),this.name=t,this.varying=s,this.isPropertyNode=!0}getHash(e){return this.name||super.getHash(e)}isGlobal(){return!0}generate(e){let t;return this.varying===!0?(t=e.getVaryingFromNode(this,this.name),t.needsInterpolation=!0):t=e.getVarFromNode(this,this.name),e.getPropertyName(t)}}const Re=(o,e)=>w(new ee(o,e)),Xe=(o,e)=>w(new ee(o,e,!0)),ge=S(ee,"vec4","DiffuseColor"),Et=S(ee,"float","Roughness"),Ya=S(ee,"float","Metalness"),ws=S(ee,"float","Clearcoat"),Xt=S(ee,"float","ClearcoatRoughness"),ht=S(ee,"vec3","Sheen"),Xs=S(ee,"float","SheenRoughness"),qs=S(ee,"float","Iridescence"),cn=S(ee,"float","IridescenceIOR"),un=S(ee,"float","IridescenceThickness"),We=S(ee,"color","SpecularColor"),Es=S(ee,"float","Shininess"),Za=S(ee,"vec4","Output"),ft=S(ee,"float","dashSize"),qt=S(ee,"float","gapSize");S(ee,"float","pointWidth");x("PropertyNode",ee);class Ja extends ee{constructor(e,t=null){super(e,t),this.isParameterNode=!0}getHash(){return this.uuid}generate(){return this.name}}x("ParameterNode",Ja);class js extends E{constructor(e="",t=[],s=""){super("code"),this.isCodeNode=!0,this.code=e,this.language=s,this.includes=t}setIncludes(e){return this.includes=e,this}getIncludes(){return this.includes}generate(e){const t=this.getIncludes(e);for(const n of t)n.build(e);const s=e.getCodeFromNode(this,this.getNodeType(e));return s.code=this.code,s.code}serialize(e){super.serialize(e),e.code=this.code,e.language=this.language}deserialize(e){super.deserialize(e),this.code=e.code,this.language=e.language}}N(js);x("CodeNode",js);class Ka extends js{constructor(e="",t=[],s=""){super(e,t,s),this.keywords={}}getNodeType(e){return this.getNodeFunction(e).type}getInputs(e){return this.getNodeFunction(e).inputs}getNodeFunction(e){const t=e.getDataFromNode(this);let s=t.nodeFunction;return s===void 0&&(s=e.parser.parseFunction(this.code),t.nodeFunction=s),s}generate(e,t){super.generate(e);const s=this.getNodeFunction(e),n=s.name,i=s.type,r=e.getCodeFromNode(this,i);n!==""&&(r.name=n);const a=e.getPropertyName(r);let c=this.getNodeFunction(e).getCode(a);const u=this.keywords,l=Object.keys(u);if(l.length>0)for(const p of l){const f=new RegExp(`\\b${p}\\b`,"g"),v=u[p].build(e,"property");c=c.replace(f,v)}return r.code=c+`
`,t==="property"?a:e.format(`${a}()`,i,t)}}x("FunctionNode",Ka);class ln extends Hs{constructor(e=0){super(null,"vec2"),this.isUVNode=!0,this.index=e}getAttributeName(){const e=this.index;return"uv"+(e>0?e:"")}serialize(e){super.serialize(e),e.index=this.index}deserialize(e){super.deserialize(e),this.index=e.index}}const Je=(...o)=>w(new ln(...o));x("UVNode",ln);class dn extends E{constructor(e,t=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=e,this.levelNode=t}generate(e,t){const s=this.textureNode.build(e,"property"),n=this.levelNode.build(e,"int");return e.format(`${e.getMethod("textureDimensions")}( ${s}, ${n} )`,this.getNodeType(e),t)}}const hn=N(dn);g("textureSize",hn);x("TextureSizeNode",dn);class j extends ${constructor(e,t,s,...n){if(super(),this.op=e,n.length>0){let i=s;for(let r=0;r<n.length;r++)i=new j(e,i,n[r]);s=i}this.aNode=t,this.bNode=s}getNodeType(e,t){const s=this.op,n=this.aNode,i=this.bNode,r=n.getNodeType(e),a=i.getNodeType(e);if(r==="void"||a==="void")return"void";if(s==="%")return r;if(s==="&"||s==="|"||s==="^"||s===">>"||s==="<<")return e.getIntegerType(r);if(s==="=="||s==="&&"||s==="||"||s==="^^")return"bool";if(s==="<"||s===">"||s==="<="||s===">="){const c=t?e.getTypeLength(t):Math.max(e.getTypeLength(r),e.getTypeLength(a));return c>1?`bvec${c}`:"bool"}else return r==="float"&&e.isMatrix(a)?a:e.isMatrix(r)&&e.isVector(a)?e.getVectorFromMatrix(r):e.isVector(r)&&e.isMatrix(a)?e.getVectorFromMatrix(a):e.getTypeLength(a)>e.getTypeLength(r)?a:r}generate(e,t){const s=this.op,n=this.aNode,i=this.bNode,r=this.getNodeType(e,t);let a=null,c=null;r!=="void"?(a=n.getNodeType(e),c=i.getNodeType(e),s==="<"||s===">"||s==="<="||s===">="||s==="=="?e.isVector(a)?c=a:a=c="float":s===">>"||s==="<<"?(a=r,c=e.changeComponentType(c,"uint")):e.isMatrix(a)&&e.isVector(c)?c=e.getVectorFromMatrix(a):e.isVector(a)&&e.isMatrix(c)?a=e.getVectorFromMatrix(c):a=c=r):a=c=r;const u=n.build(e,a),l=i.build(e,c),p=e.getTypeLength(t),f=e.getFunctionOperator(s);if(t!=="void")return s==="<"&&p>1?e.format(`${e.getMethod("lessThan")}( ${u}, ${l} )`,r,t):s==="<="&&p>1?e.format(`${e.getMethod("lessThanEqual")}( ${u}, ${l} )`,r,t):s===">"&&p>1?e.format(`${e.getMethod("greaterThan")}( ${u}, ${l} )`,r,t):s===">="&&p>1?e.format(`${e.getMethod("greaterThanEqual")}( ${u}, ${l} )`,r,t):f?e.format(`${f}( ${u}, ${l} )`,r,t):e.format(`( ${u} ${s} ${l} )`,r,t);if(a!=="void")return f?e.format(`${f}( ${u}, ${l} )`,r,t):e.format(`${u} ${s} ${l}`,r,t)}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}}const Le=N(j,"+"),he=N(j,"-"),X=N(j,"*"),Ct=N(j,"/"),Qa=N(j,"%"),ec=N(j,"=="),tc=N(j,"!="),sc=N(j,"<"),pn=N(j,">"),oc=N(j,"<="),nc=N(j,">="),ic=N(j,"&&"),rc=N(j,"||"),ac=N(j,"^^"),cc=N(j,"&"),uc=N(j,"|"),lc=N(j,"^"),dc=N(j,"<<"),hc=N(j,">>");g("add",Le);g("sub",he);g("mul",X);g("div",Ct);g("remainder",Qa);g("equal",ec);g("notEqual",tc);g("lessThan",sc);g("greaterThan",pn);g("lessThanEqual",oc);g("greaterThanEqual",nc);g("and",ic);g("or",rc);g("xor",ac);g("bitAnd",cc);g("bitOr",uc);g("bitXor",lc);g("shiftLeft",dc);g("shiftRight",hc);x("OperatorNode",j);class m extends ${constructor(e,t,s=null,n=null){super(),this.method=e,this.aNode=t,this.bNode=s,this.cNode=n}getInputType(e){const t=this.aNode.getNodeType(e),s=this.bNode?this.bNode.getNodeType(e):null,n=this.cNode?this.cNode.getNodeType(e):null,i=e.isMatrix(t)?0:e.getTypeLength(t),r=e.isMatrix(s)?0:e.getTypeLength(s),a=e.isMatrix(n)?0:e.getTypeLength(n);return i>r&&i>a?t:r>a?s:a>i?n:t}getNodeType(e){const t=this.method;return t===m.LENGTH||t===m.DISTANCE||t===m.DOT?"float":t===m.CROSS?"vec3":this.getInputType(e)}generate(e,t){const s=this.method,n=this.getNodeType(e),i=this.getInputType(e),r=this.aNode,a=this.bNode,c=this.cNode,u=e.renderer.isWebGLRenderer===!0;if(s===m.TRANSFORM_DIRECTION){let l=r,p=a;e.isMatrix(l.getNodeType(e))?p=P(y(p),0):l=P(y(l),0);const f=X(l,p).xyz;return Ce(f).build(e,t)}else{if(s===m.NEGATE)return e.format("( - "+r.build(e,i)+" )",n,t);if(s===m.ONE_MINUS)return he(1,r).build(e,t);if(s===m.RECIPROCAL)return Ct(1,r).build(e,t);if(s===m.DIFFERENCE)return Ee(he(r,a)).build(e,t);{const l=[];return s===m.CROSS?l.push(r.build(e,n),a.build(e,n)):s===m.STEP?l.push(r.build(e,e.getTypeLength(r.getNodeType(e))===1?"float":i),a.build(e,i)):u&&(s===m.MIN||s===m.MAX)||s===m.MOD?l.push(r.build(e,i),a.build(e,e.getTypeLength(a.getNodeType(e))===1?"float":i)):s===m.REFRACT?l.push(r.build(e,i),a.build(e,i),c.build(e,"float")):s===m.MIX?l.push(r.build(e,i),a.build(e,i),c.build(e,e.getTypeLength(c.getNodeType(e))===1?"float":i)):(l.push(r.build(e,i)),a!==null&&l.push(a.build(e,i)),c!==null&&l.push(c.build(e,i))),e.format(`${e.getMethod(s)}( ${l.join(", ")} )`,n,t)}}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}m.RADIANS="radians";m.DEGREES="degrees";m.EXP="exp";m.EXP2="exp2";m.LOG="log";m.LOG2="log2";m.SQRT="sqrt";m.INVERSE_SQRT="inversesqrt";m.FLOOR="floor";m.CEIL="ceil";m.NORMALIZE="normalize";m.FRACT="fract";m.SIN="sin";m.COS="cos";m.TAN="tan";m.ASIN="asin";m.ACOS="acos";m.ATAN="atan";m.ABS="abs";m.SIGN="sign";m.LENGTH="length";m.NEGATE="negate";m.ONE_MINUS="oneMinus";m.DFDX="dFdx";m.DFDY="dFdy";m.ROUND="round";m.RECIPROCAL="reciprocal";m.TRUNC="trunc";m.FWIDTH="fwidth";m.BITCAST="bitcast";m.ATAN2="atan2";m.MIN="min";m.MAX="max";m.MOD="mod";m.STEP="step";m.REFLECT="reflect";m.DISTANCE="distance";m.DIFFERENCE="difference";m.DOT="dot";m.CROSS="cross";m.POW="pow";m.TRANSFORM_DIRECTION="transformDirection";m.MIX="mix";m.CLAMP="clamp";m.REFRACT="refract";m.SMOOTHSTEP="smoothstep";m.FACEFORWARD="faceforward";const mn=h(1e-6);h(1e6);const pc=N(m,m.RADIANS),mc=N(m,m.DEGREES),fc=N(m,m.EXP),gc=N(m,m.EXP2),Nc=N(m,m.LOG),yc=N(m,m.LOG2),ct=N(m,m.SQRT),xc=N(m,m.INVERSE_SQRT),Ft=N(m,m.FLOOR),fn=N(m,m.CEIL),Ce=N(m,m.NORMALIZE),Ys=N(m,m.FRACT),Tc=N(m,m.SIN),vc=N(m,m.COS),_c=N(m,m.TAN),Vc=N(m,m.ASIN),Sc=N(m,m.ACOS),Ac=N(m,m.ATAN),Ee=N(m,m.ABS),Mc=N(m,m.SIGN),wc=N(m,m.LENGTH),Ec=N(m,m.NEGATE),Rc=N(m,m.ONE_MINUS),Lc=N(m,m.DFDX),Cc=N(m,m.DFDY),Ic=N(m,m.ROUND),Oc=N(m,m.RECIPROCAL),gn=N(m,m.TRUNC),bc=N(m,m.FWIDTH);N(m,m.BITCAST);const Dc=N(m,m.ATAN2),It=N(m,m.MIN),ot=N(m,m.MAX),zc=N(m,m.MOD),Fc=N(m,m.STEP),Pc=N(m,m.REFLECT),Uc=N(m,m.DISTANCE),Bc=N(m,m.DIFFERENCE),Pt=N(m,m.DOT),Gc=N(m,m.CROSS),Zs=N(m,m.POW),Wc=N(m,m.POW,2),kc=N(m,m.POW,3),Hc=N(m,m.POW,4),$c=N(m,m.TRANSFORM_DIRECTION),Ge=N(m,m.MIX),Nn=(o,e=0,t=1)=>w(new m(m.CLAMP,w(o),w(e),w(t))),Xc=o=>Nn(o),qc=N(m,m.REFRACT),nt=N(m,m.SMOOTHSTEP),jc=N(m,m.FACEFORWARD),Yc=(o,e,t)=>Ge(e,t,o),Zc=(o,e,t)=>nt(e,t,o);g("radians",pc);g("degrees",mc);g("exp",fc);g("exp2",gc);g("log",Nc);g("log2",yc);g("sqrt",ct);g("inverseSqrt",xc);g("floor",Ft);g("ceil",fn);g("normalize",Ce);g("fract",Ys);g("sin",Tc);g("cos",vc);g("tan",_c);g("asin",Vc);g("acos",Sc);g("atan",Ac);g("abs",Ee);g("sign",Mc);g("length",wc);g("negate",Ec);g("oneMinus",Rc);g("dFdx",Lc);g("dFdy",Cc);g("round",Ic);g("reciprocal",Oc);g("trunc",gn);g("fwidth",bc);g("atan2",Dc);g("min",It);g("max",ot);g("mod",zc);g("step",Fc);g("reflect",Pc);g("distance",Uc);g("dot",Pt);g("cross",Gc);g("pow",Zs);g("pow2",Wc);g("pow3",kc);g("pow4",Hc);g("transformDirection",$c);g("mix",Yc);g("clamp",Nn);g("refract",qc);g("smoothstep",Zc);g("faceForward",jc);g("difference",Bc);g("saturate",Xc);x("MathNode",m);const Jc=T(o=>{const{value:e}=o,{rgb:t}=e,s=t.mul(.9478672986).add(.0521327014).pow(2.4),n=t.mul(.0773993808),i=t.lessThanEqual(.04045),r=Ge(s,n,i);return P(r,e.a)}),Kc=T(o=>{const{value:e}=o,{rgb:t}=e,s=t.pow(.41666).mul(1.055).sub(.055),n=t.mul(12.92),i=t.lessThanEqual(.0031308),r=Ge(s,n,i);return P(r,e.a)}),No=o=>{let e=null;return o===es?e="Linear":o===Ar&&(e="sRGB"),e},yn=(o,e)=>No(o)+"To"+No(e);class Ve extends ${constructor(e,t){super("vec4"),this.method=e,this.node=t}setup(){const{method:e,node:t}=this;return e===Ve.LINEAR_TO_LINEAR?t:Qc[e]({value:t})}}Ve.LINEAR_TO_LINEAR="LinearToLinear";Ve.LINEAR_TO_sRGB="LinearTosRGB";Ve.sRGB_TO_LINEAR="sRGBToLinear";const Qc={[Ve.LINEAR_TO_sRGB]:Kc,[Ve.sRGB_TO_LINEAR]:Jc},eu=(o,e)=>w(new Ve(yn(es,e),w(o))),xn=(o,e)=>w(new Ve(yn(e,es),w(o))),tu=N(Ve,Ve.LINEAR_TO_sRGB),su=N(Ve,Ve.sRGB_TO_LINEAR);g("linearTosRGB",tu);g("sRGBToLinear",su);g("linearToColorSpace",eu);g("colorSpaceToLinear",xn);x("ColorSpaceNode",Ve);class Tn extends E{constructor(e="",t="void"){super(t),this.snippet=e}generate(e,t){const s=this.getNodeType(e),n=this.snippet;if(s==="void")e.addLineFlowCode(n);else return e.format(`( ${n} )`,s,t)}}const Js=N(Tn);x("ExpressionNode",Tn);class vn extends Ze{constructor(e){super(0),this.textureNode=e,this.updateType=Q.FRAME}get texture(){return this.textureNode.value}update(){const e=this.texture,t=e.images,s=t&&t.length>0?t[0]&&t[0].image||t[0]:e.image;if(s&&s.width!==void 0){const{width:n,height:i}=s;this.value=Math.log2(Math.max(n,i))}}}const Ks=N(vn);x("MaxMipLevelNode",vn);class Tt extends Ze{constructor(e,t=null,s=null){super(e),this.isTextureNode=!0,this.uvNode=t,this.levelNode=s,this.compareNode=null,this.depthNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=Q.NONE,this.setUpdateMatrix(t===null)}getUniformHash(){return this.value.uuid}getNodeType(){return this.value.isDepthTexture===!0?"float":"vec4"}getInputType(){return"texture"}getDefaultUV(){return Je(this.value.channel)}updateReference(){return this.value}getTransformedUV(e){const t=this.value;return Z(t.matrix).mul(y(e,1)).xy}setUpdateMatrix(e){return this.updateMatrix=e,this.updateType=e?Q.FRAME:Q.NONE,this}setupUV(e,t){const s=this.value;return e.isFlipY()&&(s.isRenderTargetTexture===!0||s.isFramebufferTexture===!0||s.isDepthTexture===!0)&&(t=t.setY(t.y.oneMinus())),t}setup(e){const t=e.getNodeProperties(this);let s=this.uvNode;(s===null||e.context.forceUVContext===!0)&&e.context.getUV&&(s=e.context.getUV(this)),s||(s=this.getDefaultUV()),this.updateMatrix===!0&&(s=this.getTransformedUV(s)),s=this.setupUV(e,s);let n=this.levelNode;n===null&&e.context.getTextureLevel&&(n=e.context.getTextureLevel(this)),n!==null&&e.context.getTextureLevelAlgorithm!==void 0&&(n=e.context.getTextureLevelAlgorithm(this,n)),t.uvNode=s,t.levelNode=n,t.compareNode=this.compareNode,t.depthNode=this.depthNode}generateUV(e,t){return t.build(e,this.sampler===!0?"vec2":"ivec2")}generateSnippet(e,t,s,n,i,r){const a=this.value;let c;return n?c=e.generateTextureLevel(a,t,s,n,i):r?c=e.generateTextureCompare(a,t,s,r,i):this.sampler===!1?c=e.generateTextureLoad(a,t,s,i):c=e.generateTexture(a,t,s,i),c}generate(e,t){const s=e.getNodeProperties(this),n=this.value;if(!n||n.isTexture!==!0)throw new Error("TextureNode: Need a three.js texture.");const i=super.generate(e,"property");if(t==="sampler")return i+"_sampler";if(e.isReference(t))return i;{const r=e.getDataFromNode(this);let a=r.propertyName;if(a===void 0){const{uvNode:l,levelNode:p,compareNode:f,depthNode:v}=s,_=this.generateUV(e,l),M=p?p.build(e,"float"):null,O=v?v.build(e,"int"):null,R=f?f.build(e,"float"):null,b=e.getVarFromNode(this);a=e.getPropertyName(b);const C=this.generateSnippet(e,i,_,M,O,R);e.addLineFlowCode(`${a} = ${C}`),e.context.tempWrite!==!1&&(r.snippet=C,r.propertyName=a)}let c=a;const u=this.getNodeType(e);return e.needsColorSpaceToLinear(n)&&(c=xn(Js(c,u),n.colorSpace).setup(e).build(e,u)),e.format(c,u,t)}}setSampler(e){return this.sampler=e,this}getSampler(){return this.sampler}uv(e){const t=this.clone();return t.uvNode=e,w(t)}blur(e){const t=this.clone();return t.levelNode=e.mul(Ks(t)),w(t)}level(e){const t=this.clone();return t.levelNode=e,t}size(e){return hn(this,e)}compare(e){const t=this.clone();return t.compareNode=w(e),w(t)}depth(e){const t=this.clone();return t.depthNode=w(e),w(t)}serialize(e){super.serialize(e),e.value=this.value.toJSON(e.meta).uuid}deserialize(e){super.deserialize(e),this.value=e.meta.textures[e.value]}update(){const e=this.value;e.matrixAutoUpdate===!0&&e.updateMatrix()}clone(){const e=new this.constructor(this.value,this.uvNode,this.levelNode);return e.sampler=this.sampler,e}}const De=N(Tt),ou=(...o)=>De(...o).setSampler(!1);g("texture",De);x("TextureNode",Tt);class Ut extends E{constructor(e,t,s=null){super(),this.property=e,this.index=null,this.uniformType=t,this.object=s,this.reference=null,this.node=null,this.updateType=Q.OBJECT,this.setNodeType(t)}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setIndex(e){return this.index=e,this}getIndex(){return this.index}setNodeType(e){let t=null;e==="texture"?t=De(null):t=Z(e),this.node=t}getNodeType(e){return this.node.getNodeType(e)}update(){let e=this.reference[this.property];this.index!==null&&(e=e[this.index]),this.node.value=e}setup(){return this.node}}const it=(o,e,t)=>w(new Ut(o,e,t)),nu=(o,e,t,s)=>w(new Ut(o,t,s).setIndex(e));x("ReferenceNode",Ut);class _n extends Ut{constructor(e,t,s=null){super(e,t,s),this.material=s}updateReference(e){return this.reference=this.material!==null?this.material:e.material,this.reference}setup(e){const t=this.material!==null?this.material:e.material;return this.node.value=t[this.property],super.setup(e)}}const iu=(o,e,t)=>w(new _n(o,e,t));x("MaterialReferenceNode",_n);class I extends E{constructor(e=I.VIEW_MATRIX,t=null){super(),this.scope=e,this.object3d=t,this.updateType=Q.OBJECT,this._uniformNode=new Ze(null)}getNodeType(){const e=this.scope;if(e===I.WORLD_MATRIX||e===I.VIEW_MATRIX)return"mat4";if(e===I.NORMAL_MATRIX)return"mat3";if(e===I.POSITION||e===I.VIEW_POSITION||e===I.DIRECTION||e===I.SCALE)return"vec3"}update(e){const t=this.object3d,s=this._uniformNode,n=this.scope;if(n===I.VIEW_MATRIX)s.value=t.modelViewMatrix;else if(n===I.NORMAL_MATRIX)s.value=t.normalMatrix;else if(n===I.WORLD_MATRIX)s.value=t.matrixWorld;else if(n===I.POSITION)s.value=s.value||new Mt,s.value.setFromMatrixPosition(t.matrixWorld);else if(n===I.SCALE)s.value=s.value||new Mt,s.value.setFromMatrixScale(t.matrixWorld);else if(n===I.DIRECTION)s.value=s.value||new Mt,t.getWorldDirection(s.value);else if(n===I.VIEW_POSITION){const i=e.camera;s.value=s.value||new Mt,s.value.setFromMatrixPosition(t.matrixWorld),s.value.applyMatrix4(i.matrixWorldInverse)}}generate(e){const t=this.scope;return t===I.WORLD_MATRIX||t===I.VIEW_MATRIX?this._uniformNode.nodeType="mat4":t===I.NORMAL_MATRIX?this._uniformNode.nodeType="mat3":(t===I.POSITION||t===I.VIEW_POSITION||t===I.DIRECTION||t===I.SCALE)&&(this._uniformNode.nodeType="vec3"),this._uniformNode.build(e)}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}I.VIEW_MATRIX="viewMatrix";I.NORMAL_MATRIX="normalMatrix";I.WORLD_MATRIX="worldMatrix";I.POSITION="position";I.SCALE="scale";I.VIEW_POSITION="viewPosition";I.DIRECTION="direction";N(I,I.DIRECTION);N(I,I.VIEW_MATRIX);N(I,I.NORMAL_MATRIX);N(I,I.WORLD_MATRIX);const Rs=N(I,I.POSITION);N(I,I.SCALE);const Vn=N(I,I.VIEW_POSITION);x("Object3DNode",I);class z extends I{constructor(e=z.POSITION){super(e),this.updateType=Q.RENDER}getNodeType(e){const t=this.scope;return t===z.PROJECTION_MATRIX?"mat4":t===z.NEAR||t===z.FAR||t===z.LOG_DEPTH?"float":super.getNodeType(e)}update(e){const t=e.camera,s=this._uniformNode,n=this.scope;n===z.VIEW_MATRIX?s.value=t.matrixWorldInverse:n===z.PROJECTION_MATRIX?s.value=t.projectionMatrix:n===z.NEAR?s.value=t.near:n===z.FAR?s.value=t.far:n===z.LOG_DEPTH?s.value=2/(Math.log(t.far+1)/Math.LN2):(this.object3d=t,super.update(e))}generate(e){const t=this.scope;return t===z.PROJECTION_MATRIX?this._uniformNode.nodeType="mat4":(t===z.NEAR||t===z.FAR||t===z.LOG_DEPTH)&&(this._uniformNode.nodeType="float"),super.generate(e)}}z.PROJECTION_MATRIX="projectionMatrix";z.NEAR="near";z.FAR="far";z.LOG_DEPTH="logDepth";const ke=nn(S(z,z.PROJECTION_MATRIX),"projectionMatrix"),ds=S(z,z.NEAR),hs=S(z,z.FAR),ru=S(z,z.LOG_DEPTH),Ke=S(z,z.VIEW_MATRIX);S(z,z.NORMAL_MATRIX);S(z,z.WORLD_MATRIX);S(z,z.POSITION);x("CameraNode",z);class fe extends I{constructor(e=fe.VIEW_MATRIX){super(e)}update(e){this.object3d=e.object,super.update(e)}}S(fe,fe.DIRECTION);const rt=S(fe,fe.VIEW_MATRIX).label("modelViewMatrix").temp("ModelViewMatrix"),Sn=S(fe,fe.NORMAL_MATRIX),jt=S(fe,fe.WORLD_MATRIX);S(fe,fe.POSITION);S(fe,fe.SCALE);S(fe,fe.VIEW_POSITION);x("ModelNode",fe);class se extends E{constructor(e=se.LOCAL){super("vec3"),this.scope=e}isGlobal(){return!0}getHash(){return`normal-${this.scope}`}generate(e){const t=this.scope;let s=null;if(t===se.GEOMETRY)s=Ne("normal","vec3");else if(t===se.LOCAL)s=Y(Yt);else if(t===se.VIEW){const n=Sn.mul($e);s=Ce(Y(n))}else if(t===se.WORLD){const n=Ye.transformDirection(Ke);s=Ce(Y(n))}return s.build(e,this.getNodeType(e))}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}se.GEOMETRY="geometry";se.LOCAL="local";se.VIEW="view";se.WORLD="world";const Yt=S(se,se.GEOMETRY),$e=S(se,se.LOCAL).temp("Normal"),Ye=S(se,se.VIEW),An=S(se,se.WORLD),K=Re("vec3","TransformedNormalView"),au=K.transformDirection(Ke).normalize(),pt=Re("vec3","TransformedClearcoatNormalView");x("NormalNode",se);const yo=new Map;class V extends E{constructor(e){super(),this.scope=e}getCache(e,t){let s=yo.get(e);return s===void 0&&(s=iu(e,t),yo.set(e,s)),s}getFloat(e){return this.getCache(e,"float")}getColor(e){return this.getCache(e,"color")}getTexture(e){return this.getCache(e==="map"?"map":e+"Map","texture")}setup(e){const t=e.context.material,s=this.scope;let n=null;if(s===V.COLOR){const i=this.getColor(s);t.map&&t.map.isTexture===!0?n=i.mul(this.getTexture("map")):n=i}else if(s===V.OPACITY){const i=this.getFloat(s);t.alphaMap&&t.alphaMap.isTexture===!0?n=i.mul(this.getTexture("alpha")):n=i}else if(s===V.SPECULAR_STRENGTH)t.specularMap&&t.specularMap.isTexture===!0?n=this.getTexture(s).r:n=h(1);else if(s===V.ROUGHNESS){const i=this.getFloat(s);t.roughnessMap&&t.roughnessMap.isTexture===!0?n=i.mul(this.getTexture(s).g):n=i}else if(s===V.METALNESS){const i=this.getFloat(s);t.metalnessMap&&t.metalnessMap.isTexture===!0?n=i.mul(this.getTexture(s).b):n=i}else if(s===V.EMISSIVE){const i=this.getColor(s);t.emissiveMap&&t.emissiveMap.isTexture===!0?n=i.mul(this.getTexture(s)):n=i}else if(s===V.NORMAL)t.normalMap?n=this.getTexture("normal").normalMap(this.getCache("normalScale","vec2")):t.bumpMap?n=this.getTexture("bump").r.bumpMap(this.getFloat("bumpScale")):n=Ye;else if(s===V.CLEARCOAT){const i=this.getFloat(s);t.clearcoatMap&&t.clearcoatMap.isTexture===!0?n=i.mul(this.getTexture(s).r):n=i}else if(s===V.CLEARCOAT_ROUGHNESS){const i=this.getFloat(s);t.clearcoatRoughnessMap&&t.clearcoatRoughnessMap.isTexture===!0?n=i.mul(this.getTexture(s).r):n=i}else if(s===V.CLEARCOAT_NORMAL)t.clearcoatNormalMap?n=this.getTexture(s).normalMap(this.getCache(s+"Scale","vec2")):n=Ye;else if(s===V.SHEEN){const i=this.getColor("sheenColor").mul(this.getFloat("sheen"));t.sheenColorMap&&t.sheenColorMap.isTexture===!0?n=i.mul(this.getTexture("sheenColor").rgb):n=i}else if(s===V.SHEEN_ROUGHNESS){const i=this.getFloat(s);t.sheenRoughnessMap&&t.sheenRoughnessMap.isTexture===!0?n=i.mul(this.getTexture(s).a):n=i,n=n.clamp(.07,1)}else if(s===V.IRIDESCENCE_THICKNESS){const i=it(1,"float",t.iridescenceThicknessRange);if(t.iridescenceThicknessMap){const r=it(0,"float",t.iridescenceThicknessRange);n=i.sub(r).mul(this.getTexture(s).g).add(r)}else n=i}else{const i=this.getNodeType(e);n=this.getCache(s,i)}return n}}V.ALPHA_TEST="alphaTest";V.COLOR="color";V.OPACITY="opacity";V.SHININESS="shininess";V.SPECULAR_COLOR="specular";V.SPECULAR_STRENGTH="specularStrength";V.REFLECTIVITY="reflectivity";V.ROUGHNESS="roughness";V.METALNESS="metalness";V.NORMAL="normal";V.CLEARCOAT="clearcoat";V.CLEARCOAT_ROUGHNESS="clearcoatRoughness";V.CLEARCOAT_NORMAL="clearcoatNormal";V.EMISSIVE="emissive";V.ROTATION="rotation";V.SHEEN="sheen";V.SHEEN_ROUGHNESS="sheenRoughness";V.IRIDESCENCE="iridescence";V.IRIDESCENCE_IOR="iridescenceIOR";V.IRIDESCENCE_THICKNESS="iridescenceThickness";V.LINE_SCALE="scale";V.LINE_DASH_SIZE="dashSize";V.LINE_GAP_SIZE="gapSize";V.LINE_WIDTH="linewidth";V.LINE_DASH_OFFSET="dashOffset";V.POINT_WIDTH="pointWidth";const cu=S(V,V.ALPHA_TEST),Ot=S(V,V.COLOR),uu=S(V,V.SHININESS),lu=S(V,V.EMISSIVE),Mn=S(V,V.OPACITY),du=S(V,V.SPECULAR_COLOR),hu=S(V,V.SPECULAR_STRENGTH);S(V,V.REFLECTIVITY);const pu=S(V,V.ROUGHNESS),mu=S(V,V.METALNESS),fu=S(V,V.NORMAL),gu=S(V,V.CLEARCOAT),Nu=S(V,V.CLEARCOAT_ROUGHNESS),yu=S(V,V.CLEARCOAT_NORMAL),xu=S(V,V.ROTATION),Tu=S(V,V.SHEEN),vu=S(V,V.SHEEN_ROUGHNESS),_u=S(V,V.IRIDESCENCE),Vu=S(V,V.IRIDESCENCE_IOR),Su=S(V,V.IRIDESCENCE_THICKNESS),Ls=S(V,V.LINE_SCALE),wn=S(V,V.LINE_DASH_SIZE),En=S(V,V.LINE_GAP_SIZE),St=S(V,V.LINE_WIDTH),xo=S(V,V.LINE_DASH_OFFSET),Au=S(V,V.POINT_WIDTH);x("MaterialNode",V);class G extends E{constructor(e=G.LOCAL){super("vec3"),this.scope=e}isGlobal(){return!0}getHash(){return`position-${this.scope}`}generate(e){const t=this.scope;let s=null;if(t===G.GEOMETRY)s=Ne("position","vec3");else if(t===G.LOCAL)s=Y(ye);else if(t===G.WORLD){const n=jt.mul(ve);s=Y(n)}else if(t===G.VIEW){const n=rt.mul(ve);s=Y(n)}else if(t===G.VIEW_DIRECTION){const n=Ue.negate();s=Ce(Y(n))}else if(t===G.WORLD_DIRECTION){const n=ve.transformDirection(jt);s=Ce(Y(n))}return s.build(e,this.getNodeType(e))}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}G.GEOMETRY="geometry";G.LOCAL="local";G.WORLD="world";G.WORLD_DIRECTION="worldDirection";G.VIEW="view";G.VIEW_DIRECTION="viewDirection";const ye=S(G,G.GEOMETRY),ve=S(G,G.LOCAL).temp("Position"),Mu=S(G,G.WORLD),wu=S(G,G.WORLD_DIRECTION),Ue=S(G,G.VIEW),ce=S(G,G.VIEW_DIRECTION);x("PositionNode",G);class Rn extends ${constructor(e=null){super("vec4"),this.positionNode=e}setup(e){if(e.shaderStage==="fragment")return Y(e.context.mvp);const t=this.positionNode||ve;return ke.mul(rt).mul(t)}}const To=N(Rn);x("ModelViewProjectionNode",Rn);class Ln extends ts{constructor(e,t=null,s=0,n=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferStride=s,this.bufferOffset=n,this.usage=Mr,this.instanced=!1,this.attribute=null,e&&e.isBufferAttribute===!0&&(this.attribute=e,this.usage=e.usage,this.instanced=e.isInstancedBufferAttribute)}getNodeType(e){return this.bufferType===null&&(this.bufferType=e.getTypeFromAttribute(this.attribute)),this.bufferType}setup(e){if(this.attribute!==null)return;const t=this.getNodeType(e),s=this.value,n=e.getTypeLength(t),i=this.bufferStride||n,r=this.bufferOffset,a=s.isInterleavedBuffer===!0?s:new wr(s,i),c=new Er(a,n,r);a.setUsage(this.usage),this.attribute=c,this.attribute.isInstancedBufferAttribute=this.instanced}generate(e){const t=this.getNodeType(e),s=e.getBufferAttributeFromNode(this,t),n=e.getPropertyName(s);let i=null;return e.shaderStage==="vertex"?i=n:i=Y(this).build(e,t),i}getInputType(){return"bufferAttribute"}setUsage(e){return this.usage=e,this}setInstanced(e){return this.instanced=e,this}}const Qs=(o,e,t,s)=>w(new Ln(o,e,t,s)),Eu=(o,e,t,s)=>Qs(o,e,t,s).setUsage(Do),Ru=(o,e,t,s)=>Qs(o,e,t,s).setInstanced(!0),Lu=(o,e,t,s)=>Eu(o,e,t,s).setInstanced(!0);g("toAttribute",o=>Qs(o.value));x("BufferAttributeNode",Ln);class Cn extends E{constructor(e){super("void"),this.instanceMesh=e,this.instanceMatrixNode=null}setup(){let e=this.instanceMatrixNode;if(e===null){const a=this.instanceMesh.instanceMatrix,c=new Rr(a.array,16,1),u=a.usage===Do?Lu:Ru,l=[u(c,"vec4",16,0),u(c,"vec4",16,4),u(c,"vec4",16,8),u(c,"vec4",16,12)];e=Ko(...l),this.instanceMatrixNode=e}const t=e.mul(ve).xyz,s=xt(e[0].xyz,e[1].xyz,e[2].xyz),n=$e.div(y(s[0].dot(s[0]),s[1].dot(s[1]),s[2].dot(s[2]))),i=s.mul(n).xyz;ve.assign(t),$e.assign(i)}}const Cu=N(Cn);x("InstanceNode",Cn);class eo extends Ze{constructor(e,t,s=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferCount=s}getInputType(){return"buffer"}}const In=(o,e,t)=>w(new eo(o,e,t));x("BufferNode",eo);class J extends E{constructor(e=J.LOCAL){super(),this.scope=e}getHash(){return`tangent-${this.scope}`}getNodeType(){return this.scope===J.GEOMETRY?"vec4":"vec3"}generate(e){const t=this.scope;let s=null;if(t===J.GEOMETRY)s=Ne("tangent","vec4");else if(t===J.LOCAL)s=Y(Zt.xyz);else if(t===J.VIEW){const n=rt.mul(to).xyz;s=Ce(Y(n))}else if(t===J.WORLD){const n=is.transformDirection(Ke);s=Ce(Y(n))}return s.build(e,this.getNodeType(e))}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}J.GEOMETRY="geometry";J.LOCAL="local";J.VIEW="view";J.WORLD="world";const Zt=S(J,J.GEOMETRY),to=S(J,J.LOCAL),is=S(J,J.VIEW),Iu=S(J,J.WORLD),On=Lt(is,"TransformedTangentView");Ce(On.transformDirection(Ke));x("TangentNode",J);class bn extends E{constructor(e){super("void"),this.skinnedMesh=e,this.updateType=Q.OBJECT,this.skinIndexNode=Ne("skinIndex","uvec4"),this.skinWeightNode=Ne("skinWeight","vec4"),this.bindMatrixNode=Z(e.bindMatrix,"mat4"),this.bindMatrixInverseNode=Z(e.bindMatrixInverse,"mat4"),this.boneMatricesNode=In(e.skeleton.boneMatrices,"mat4",e.skeleton.bones.length)}setup(e){const{skinIndexNode:t,skinWeightNode:s,bindMatrixNode:n,bindMatrixInverseNode:i,boneMatricesNode:r}=this,a=r.element(t.x),c=r.element(t.y),u=r.element(t.z),l=r.element(t.w),p=n.mul(ve),f=Le(a.mul(s.x).mul(p),c.mul(s.y).mul(p),u.mul(s.z).mul(p),l.mul(s.w).mul(p)),v=i.mul(f).xyz;let _=Le(s.x.mul(a),s.y.mul(c),s.z.mul(u),s.w.mul(l));_=i.mul(_).mul(n);const M=_.transformDirection($e).xyz;ve.assign(v),$e.assign(M),e.hasGeometryAttribute("tangent")&&to.assign(M)}generate(e,t){if(t!=="void")return ve.build(e,t)}update(){this.skinnedMesh.skeleton.update()}}const Ou=N(bn);x("SkinningNode",bn);const ps=new WeakMap,Se=new Rt,vo=T(({bufferMap:o,influence:e,stride:t,width:s,depth:n,offset:i})=>{const r=d(qa).mul(t).add(i),a=r.div(s),c=r.sub(a.mul(s));return ou(o,Zo(c,a)).depth(n).mul(e)});function bu(o){const e=o.morphAttributes.position!==void 0,t=o.morphAttributes.normal!==void 0,s=o.morphAttributes.color!==void 0,n=o.morphAttributes.position||o.morphAttributes.normal||o.morphAttributes.color,i=n!==void 0?n.length:0;let r=ps.get(o);if(r===void 0||r.count!==i){let R=function(){M.dispose(),ps.delete(o),o.removeEventListener("dispose",R)};r!==void 0&&r.texture.dispose();const a=o.morphAttributes.position||[],c=o.morphAttributes.normal||[],u=o.morphAttributes.color||[];let l=0;e===!0&&(l=1),t===!0&&(l=2),s===!0&&(l=3);let p=o.attributes.position.count*l,f=1;const v=4096;p>v&&(f=Math.ceil(p/v),p=v);const _=new Float32Array(p*f*4*i),M=new Lr(_,p,f,i);M.type=zo,M.needsUpdate=!0;const O=l*4;for(let b=0;b<i;b++){const C=a[b],D=c[b],de=u[b],F=p*f*4*b;for(let ie=0;ie<C.count;ie++){const re=ie*O;e===!0&&(Se.fromBufferAttribute(C,ie),_[F+re+0]=Se.x,_[F+re+1]=Se.y,_[F+re+2]=Se.z,_[F+re+3]=0),t===!0&&(Se.fromBufferAttribute(D,ie),_[F+re+4]=Se.x,_[F+re+5]=Se.y,_[F+re+6]=Se.z,_[F+re+7]=0),s===!0&&(Se.fromBufferAttribute(de,ie),_[F+re+8]=Se.x,_[F+re+9]=Se.y,_[F+re+10]=Se.z,_[F+re+11]=de.itemSize===4?Se.w:1)}}r={count:i,texture:M,stride:l,size:new qe(p,f)},ps.set(o,r),o.addEventListener("dispose",R)}return r}class Dn extends E{constructor(e){super("void"),this.mesh=e,this.morphBaseInfluence=Z(1),this.updateType=Q.OBJECT}setup(e){const{geometry:t}=e,s=t.morphAttributes.position!==void 0,n=t.morphAttributes.normal!==void 0,i=t.morphAttributes.position||t.morphAttributes.normal||t.morphAttributes.color,r=i!==void 0?i.length:0,{texture:a,stride:c,size:u}=bu(t);s===!0&&ve.mulAssign(this.morphBaseInfluence),n===!0&&$e.mulAssign(this.morphBaseInfluence);const l=d(u.width);for(let p=0;p<r;p++){const f=nu("morphTargetInfluences",p,"float"),v=d(p);s===!0&&ve.addAssign(vo({bufferMap:a,influence:f,stride:c,width:l,depth:v,offset:d(0)})),n===!0&&$e.addAssign(vo({bufferMap:a,influence:f,stride:c,width:l,depth:v,offset:d(1)}))}}update(){const e=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?e.value=1:e.value=1-this.mesh.morphTargetInfluences.reduce((t,s)=>t+s,0)}}const Du=N(Dn);x("MorphNode",Dn);class zn extends E{constructor(){super("vec3")}getHash(){return"reflectVector"}setup(){return ce.negate().reflect(K).transformDirection(Ke)}}const zu=S(zn);x("ReflectVectorNode",zn);class Fn extends Tt{constructor(e,t=null,s=null){super(e,t,s),this.isCubeTextureNode=!0}getInputType(){return"cubeTexture"}getDefaultUV(){return zu}setUpdateMatrix(){}setupUV(e,t){return y(t.x.negate(),t.yz)}generateUV(e,t){return t.build(e,"vec3")}}const so=N(Fn);g("cubeTexture",so);x("CubeTextureNode",Fn);class rs extends E{constructor(){super("vec3")}generate(){console.warn("Abstract function.")}}x("LightingNode",rs);let ms=null;class ut extends rs{constructor(e=null){super(),this.updateType=Q.FRAME,this.light=e,this.rtt=null,this.shadowNode=null,this.color=new Ds,this._defaultColorNode=Z(this.color),this.colorNode=this._defaultColorNode,this.isAnalyticLightNode=!0}getCacheKey(){return super.getCacheKey()+"-"+(this.light.id+"-"+(this.light.castShadow?"1":"0"))}getHash(){return this.light.uuid}setupShadow(e){let t=this.shadowNode;if(t===null){ms===null&&(ms=e.createNodeMaterial("MeshBasicNodeMaterial"));const s=this.light.shadow,n=e.getRenderTarget(s.mapSize.width,s.mapSize.height),i=new zs;i.minFilter=ao,i.magFilter=ao,i.image.width=s.mapSize.width,i.image.height=s.mapSize.height,i.compareFunction=Cr,n.depthTexture=i,s.camera.updateProjectionMatrix();const r=it("bias","float",s),a=it("normalBias","float",s);let c=Z(s.matrix).mul(Mu.add(An.mul(a)));c=c.xyz.div(c.w);const u=c.x.greaterThanEqual(0).and(c.x.lessThanEqual(1)).and(c.y.greaterThanEqual(0)).and(c.y.lessThanEqual(1)).and(c.z.lessThanEqual(1));let l=c.z.add(r);e.renderer.coordinateSystem===Ir&&(l=l.mul(2).sub(1)),c=y(c.x,c.y.oneMinus(),l),t=((f,v,_)=>De(f,v).compare(_))(i,c.xy,c.z),this.rtt=n,this.colorNode=this.colorNode.mul(u.mix(1,t)),this.shadowNode=t,this.updateBeforeType=Q.RENDER}}setup(e){this.light.castShadow?this.setupShadow(e):this.shadowNode!==null&&this.disposeShadow()}updateShadow(e){const{rtt:t,light:s}=this,{renderer:n,scene:i}=e,r=i.overrideMaterial;i.overrideMaterial=ms,t.setSize(s.shadow.mapSize.width,s.shadow.mapSize.height),s.shadow.updateMatrices(s);const a=n.getRenderTarget(),c=n.getRenderObjectFunction();n.setRenderObjectFunction((u,...l)=>{u.castShadow===!0&&n.renderObject(u,...l)}),n.setRenderTarget(t),n.render(i,s.shadow.camera),n.setRenderTarget(a),n.setRenderObjectFunction(c),i.overrideMaterial=r}disposeShadow(){this.rtt.dispose(),this.shadowNode=null,this.rtt=null,this.colorNode=this._defaultColorNode}updateBefore(e){const{light:t}=this;t.castShadow&&this.updateShadow(e)}update(){const{light:e}=this;this.color.copy(e.color).multiplyScalar(e.intensity)}}x("AnalyticLightNode",ut);const Jt=new WeakMap,Fu=o=>o.sort((e,t)=>e.id-t.id);class Pu extends E{constructor(e=[]){super("vec3"),this.totalDiffuseNode=y().temp("totalDiffuse"),this.totalSpecularNode=y().temp("totalSpecular"),this.outgoingLightNode=y().temp("outgoingLight"),this.lightNodes=e,this._hash=null}get hasLight(){return this.lightNodes.length>0}getHash(){if(this._hash===null){const e=[];for(const t of this.lightNodes)e.push(t.getHash());this._hash="lights-"+e.join(",")}return this._hash}setup(e){const t=e.context,s=t.lightingModel;let n=this.outgoingLightNode;if(s){const{lightNodes:i,totalDiffuseNode:r,totalSpecularNode:a}=this;t.outgoingLight=n;const c=e.addStack();s.start(t,c,e);for(const O of i)O.build(e);s.indirectDiffuse(t,c,e),s.indirectSpecular(t,c,e),s.ambientOcclusion(t,c,e);const{backdrop:u,backdropAlpha:l}=t,{directDiffuse:p,directSpecular:f,indirectDiffuse:v,indirectSpecular:_}=t.reflectedLight;let M=p.add(v);u!==null&&(M=y(l!==null?l.mix(M,u):u)),r.assign(M),a.assign(f.add(_)),n.assign(r.add(a)),s.finish(t,c,e),n=n.bypass(e.removeStack())}return n}_getLightNodeById(e){for(const t of this.lightNodes)if(t.isAnalyticLightNode&&t.light.id===e)return t;return null}fromLights(e=[]){const t=[];e=Fu(e);for(const s of e){let n=this._getLightNodeById(s.id);if(n===null){const i=s.constructor,r=Jt.has(i)?Jt.get(i):ut;n=w(new r(s))}t.push(n)}return this.lightNodes=t,this._hash=null,this}}const Uu=N(Pu);function vt(o,e){if(Jt.has(o)){console.warn(`Redefinition of light node ${e.type}`);return}if(typeof o!="function")throw new Error(`Light ${o.name} is not a class`);if(typeof e!="function"||!e.type)throw new Error(`Light node ${e.type} is not a class`);Jt.set(o,e)}class Pn extends rs{constructor(e=null){super(),this.aoNode=e}setup(e){const s=this.aoNode.x.sub(1).mul(1).add(1);e.context.ambientOcclusion.mulAssign(s)}}x("AONode",Pn);class Un extends $s{constructor(e,t=null,s=null,n=null){super(e),this.lightingModel=t,this.backdropNode=s,this.backdropAlphaNode=n,this._context=null}getContext(){const{backdropNode:e,backdropAlphaNode:t}=this,s=y().temp("directDiffuse"),n=y().temp("directSpecular"),i=y().temp("indirectDiffuse"),r=y().temp("indirectSpecular"),a={directDiffuse:s,directSpecular:n,indirectDiffuse:i,indirectSpecular:r};return{radiance:y().temp("radiance"),irradiance:y().temp("irradiance"),iblIrradiance:y().temp("iblIrradiance"),ambientOcclusion:h(1).temp("ambientOcclusion"),reflectedLight:a,backdrop:e,backdropAlpha:t}}setup(e){return this.context=this._context||(this._context=this.getContext()),this.context.lightingModel=this.lightingModel||e.context.lightingModel,super.setup(e)}}const Bn=N(Un);g("lightingContext",Bn);x("LightingContextNode",Un);class Gn extends ${constructor(e=wu){super("vec2"),this.dirNode=e}setup(){const e=this.dirNode,t=e.z.atan2(e.x).mul(1/(Math.PI*2)).add(.5),s=e.y.negate().clamp(-1,1).asin().mul(1/Math.PI).add(.5);return L(t,s)}}const Wn=N(Gn);x("EquirectUVNode",Gn);class kn extends E{constructor(e,t=null){super("float"),this.textureNode=e,this.roughnessNode=t}setup(){const{textureNode:e,roughnessNode:t}=this,s=Ks(e),n=t.mul(t).mul(Math.PI).div(t.add(1));return s.add(n.log2()).clamp(0,s)}}const Bu=N(kn);x("SpecularMIPLevelNode",kn);const _o=new WeakMap;class Hn extends rs{constructor(e=null){super(),this.envNode=e}setup(e){let t=this.envNode;if(t.isTextureNode&&t.value.isCubeTexture!==!0){let c=_o.get(t.value);if(c===void 0){const u=t.value,l=e.renderer,p=e.getCubeRenderTarget(512).fromEquirectangularTexture(l,u);c=so(p.texture),_o.set(t.value,c)}t=c}const s=it("envMapIntensity","float",e.material),n=He(t,Vo(Et,K)).mul(s),i=He(t,Gu(au)).mul(Math.PI).mul(s),r=$t(n);e.context.radiance.addAssign(r),e.context.iblIrradiance.addAssign(i);const a=e.context.lightingModel.clearcoatRadiance;if(a){const c=He(t,Vo(Xt,pt)).mul(s),u=$t(c);a.addAssign(u)}}}const Vo=(o,e)=>{let t=null,s=null;return{getUV:n=>{let i=null;return t===null&&(t=ce.negate().reflect(e),t=o.mul(o).mix(t,e).normalize(),t=t.transformDirection(Ke)),n.isCubeTextureNode?i=t:n.isTextureNode&&(s===null&&(s=Wn(t)),i=s),i},getTextureLevel:()=>o,getTextureLevelAlgorithm:(n,i)=>Bu(n,i)}},Gu=o=>{let e=null;return{getUV:t=>{let s=null;return t.isCubeTextureNode?s=o:t.isTextureNode&&(e===null&&(e=Wn(o),e=L(e.x,e.y.oneMinus())),s=e),s},getTextureLevel:t=>Ks(t)}};x("EnvironmentNode",Hn);let fs,gs;class U extends E{constructor(e){super(),this.scope=e,this.isViewportNode=!0}getNodeType(){return this.scope===U.VIEWPORT?"vec4":"vec2"}getUpdateType(){let e=Q.NONE;return(this.scope===U.RESOLUTION||this.scope===U.VIEWPORT)&&(e=Q.FRAME),this.updateType=e,e}update({renderer:e}){this.scope===U.VIEWPORT?e.getViewport(gs):e.getDrawingBufferSize(fs)}setup(){const e=this.scope;if(e===U.COORDINATE)return;let t=null;if(e===U.RESOLUTION)t=Z(fs||(fs=new qe));else if(e===U.VIEWPORT)t=Z(gs||(gs=new Rt));else{t=Wu.div(So);let s=t.x,n=t.y;/bottom/i.test(e)&&(n=n.oneMinus()),/right/i.test(e)&&(s=s.oneMinus()),t=L(s,n)}return t}generate(e){if(this.scope===U.COORDINATE){let t=e.getFragCoord();if(e.isFlipY()){const s=e.getNodeProperties(So).outputNode.build(e);t=`${e.getType("vec2")}( ${t}.x, ${s}.y - ${t}.y )`}return t}return super.generate(e)}}U.COORDINATE="coordinate";U.RESOLUTION="resolution";U.VIEWPORT="viewport";U.TOP_LEFT="topLeft";U.BOTTOM_LEFT="bottomLeft";U.TOP_RIGHT="topRight";U.BOTTOM_RIGHT="bottomRight";const Wu=S(U,U.COORDINATE),So=S(U,U.RESOLUTION),gt=S(U,U.VIEWPORT),oo=S(U,U.TOP_LEFT);S(U,U.BOTTOM_LEFT);S(U,U.TOP_RIGHT);S(U,U.BOTTOM_RIGHT);x("ViewportNode",U);const At=new qe;class Bt extends Tt{constructor(e=oo,t=null,s=null){s===null&&(s=new Fo,s.minFilter=Or),super(s,e,t),this.generateMipmaps=!1,this.isOutputTextureNode=!0,this.updateBeforeType=Q.FRAME}updateBefore(e){const t=e.renderer;t.getDrawingBufferSize(At);const s=this.value;(s.image.width!==At.width||s.image.height!==At.height)&&(s.image.width=At.width,s.image.height=At.height,s.needsUpdate=!0);const n=s.generateMipmaps;s.generateMipmaps=this.generateMipmaps,t.copyFramebufferToTexture(s),s.generateMipmaps=n}clone(){return new this.constructor(this.uvNode,this.levelNode,this.value)}}const ku=N(Bt),Hu=N(Bt,null,null,{generateMipmaps:!0});g("viewportTexture",ku);g("viewportMipTexture",Hu);x("ViewportTextureNode",Bt);let lt=null;class $n extends Bt{constructor(e=oo,t=null){lt===null&&(lt=new zs,lt.minFilter=br,lt.type=Dr,lt.format=zr),super(e,t,lt)}}const Xn=N($n);g("viewportDepthTexture",Xn);x("ViewportDepthTextureNode",$n);class pe extends E{constructor(e,t=null){super("float"),this.scope=e,this.valueNode=t,this.isViewportDepthNode=!0}generate(e){const{scope:t}=this;return t===pe.DEPTH_PIXEL?e.getFragDepth():super.generate(e)}setup(){const{scope:e}=this;let t=null;if(e===pe.DEPTH)t=Cs(Ue.z,ds,hs);else if(e===pe.DEPTH_TEXTURE){const s=this.valueNode||Xn(),n=qn(s,ds,hs);t=Cs(n,ds,hs)}else e===pe.DEPTH_PIXEL&&this.valueNode!==null&&(t=jn().assign(this.valueNode));return t}}const Cs=(o,e,t)=>o.add(e).div(e.sub(t)),qn=(o,e,t)=>e.mul(t).div(t.sub(e).mul(o).sub(t));pe.DEPTH="depth";pe.DEPTH_TEXTURE="depthTexture";pe.DEPTH_PIXEL="depthPixel";const jn=N(pe,pe.DEPTH_PIXEL);S(pe,pe.DEPTH);N(pe,pe.DEPTH_TEXTURE);const Yn=S(pe,pe.DEPTH_PIXEL);Yn.assign=o=>jn(o);x("ViewportDepthNode",pe);const Is=new Map;class Oe extends Fr{constructor(){super(),this.isNodeMaterial=!0,this.type=this.constructor.type,this.forceSinglePass=!1,this.fog=!0,this.lights=!0,this.normals=!0,this.colorSpaced=!0,this.lightsNode=null,this.envNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.positionNode=null,this.depthNode=null,this.outputNode=null,this.fragmentNode=null,this.vertexNode=null}customProgramCacheKey(){return this.type+Go(this)}build(e){this.setup(e)}setup(e){e.addStack(),e.stack.outputNode=this.vertexNode||this.setupPosition(e),e.addFlow("vertex",e.removeStack()),e.addStack();let t;if(this.fragmentNode===null){this.depthWrite===!0&&this.setupDepth(e),this.normals===!0&&this.setupNormal(e),this.setupDiffuseColor(e),this.setupVariants(e);const s=this.setupLighting(e);t=this.setupOutput(e,P(s,ge.a)),Za.assign(t),this.outputNode!==null&&(t=this.outputNode)}else t=this.setupOutput(e,this.fragmentNode);e.stack.outputNode=t,e.addFlow("fragment",e.removeStack())}setupDepth(e){const{renderer:t}=e;let s=this.depthNode;s===null&&t.logarithmicDepthBuffer===!0&&(s=To().w.add(1).log2().mul(ru).mul(.5)),s!==null&&Yn.assign(s).append()}setupPosition(e){const{object:t}=e,s=t.geometry;e.addStack(),(s.morphAttributes.position||s.morphAttributes.normal||s.morphAttributes.color)&&Du(t).append(),t.isSkinnedMesh===!0&&Ou(t).append(),t.instanceMatrix&&t.instanceMatrix.isInstancedBufferAttribute===!0&&e.isAvailable("instance")===!0&&Cu(t).append(),this.positionNode!==null&&ve.assign(this.positionNode);const n=To();return e.context.vertex=e.removeStack(),e.context.mvp=n,n}setupDiffuseColor({geometry:e}){let t=this.colorNode?P(this.colorNode):Ot;this.vertexColors===!0&&e.hasAttribute("color")&&(t=P(t.xyz.mul(Ne("color","vec3")),t.a)),ge.assign(t);const s=this.opacityNode?h(this.opacityNode):Mn;if(ge.a.assign(ge.a.mul(s)),this.alphaTestNode!==null||this.alphaTest>0){const n=this.alphaTestNode!==null?h(this.alphaTestNode):cu;ge.a.lessThanEqual(n).discard()}}setupVariants(){}setupNormal(){if(this.flatShading===!0){const e=Ue.dFdx().cross(Ue.dFdy()).normalize();K.assign(e)}else{const e=this.normalNode?y(this.normalNode):fu;K.assign(e)}}getEnvNode(e){let t=null;return this.envNode?t=this.envNode:this.envMap?t=this.envMap.isCubeTexture?so(this.envMap):De(this.envMap):e.environmentNode&&(t=e.environmentNode),t}setupLights(e){const t=this.getEnvNode(e),s=[];t&&s.push(new Hn(t)),e.material.aoMap&&s.push(new Pn(De(e.material.aoMap)));let n=this.lightsNode||e.lightsNode;return s.length>0&&(n=Uu([...n.lightNodes,...s])),n}setupLightingModel(){}setupLighting(e){const{material:t}=e,{backdropNode:s,backdropAlphaNode:n,emissiveNode:i}=this,a=this.lights===!0||this.lightsNode!==null?this.setupLights(e):null;let c=ge.rgb;if(a&&a.hasLight!==!1){const u=this.setupLightingModel(e);c=Bn(a,u,s,n)}else s!==null&&(c=y(n!==null?Ge(c,s,n):s));return(i&&i.isNode===!0||t.emissive&&t.emissive.isColor===!0)&&(c=c.add(y(i||lu))),c}setupOutput(e,t){const s=e.renderer,n=e.toneMappingNode;if(this.toneMapped===!0&&n&&(t=P(n.context({color:t.rgb}),t.a)),this.fog===!0){const i=e.fogNode;i&&(t=P(i.mixAssign(t.rgb),t.a))}if(this.colorSpaced===!0){const i=s.currentColorSpace;i!==es&&i!==Pr&&(t=t.linearToColorSpace(i))}return t}setDefaultValues(e){for(const s in e){const n=e[s];this[s]===void 0&&(this[s]=n,n&&n.clone&&(this[s]=n.clone()))}Object.assign(this.defines,e.defines);const t=Object.getOwnPropertyDescriptors(e.constructor.prototype);for(const s in t)Object.getOwnPropertyDescriptor(this.constructor.prototype,s)===void 0&&t[s].get!==void 0&&Object.defineProperty(this.constructor.prototype,s,t[s])}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{},nodes:{}});const s=Ur.prototype.toJSON.call(this,e),n=Ht(this);s.inputNodes={};for(const{property:r,childNode:a}of n)s.inputNodes[r]=a.toJSON(e).uuid;function i(r){const a=[];for(const c in r){const u=r[c];delete u.metadata,a.push(u)}return a}if(t){const r=i(e.textures),a=i(e.images),c=i(e.nodes);r.length>0&&(s.textures=r),a.length>0&&(s.images=a),c.length>0&&(s.nodes=c)}return s}copy(e){return this.lightsNode=e.lightsNode,this.envNode=e.envNode,this.colorNode=e.colorNode,this.normalNode=e.normalNode,this.opacityNode=e.opacityNode,this.backdropNode=e.backdropNode,this.backdropAlphaNode=e.backdropAlphaNode,this.alphaTestNode=e.alphaTestNode,this.positionNode=e.positionNode,this.depthNode=e.depthNode,this.outputNode=e.outputNode,this.fragmentNode=e.fragmentNode,this.vertexNode=e.vertexNode,super.copy(e)}static fromMaterial(e){if(e.isNodeMaterial===!0)return e;const t=e.type.replace("Material","NodeMaterial"),s=$u(t);if(s===void 0)throw new Error(`NodeMaterial: Material "${e.type}" is not compatible.`);for(const n in e)s[n]=e[n];return s}}function Ae(o,e){if(typeof e!="function"||!o)throw new Error(`Node material ${o} is not a class`);if(Is.has(o)){console.warn(`Redefinition of node material ${o}`);return}Is.set(o,e),e.type=o}function $u(o){const e=Is.get(o);if(e!==void 0)return new e}Ae("NodeMaterial",Oe);class no extends E{constructor(e,t,s=null){super(),this.condNode=e,this.ifNode=t,this.elseNode=s}getNodeType(e){const t=this.ifNode.getNodeType(e);if(this.elseNode!==null){const s=this.elseNode.getNodeType(e);if(e.getTypeLength(s)>e.getTypeLength(t))return s}return t}generate(e){const t=this.getNodeType(e),s={tempWrite:!1},{ifNode:n,elseNode:i}=this,r=n.getNodeType(e)!=="void"||i&&i.getNodeType(e)!=="void",a=r?Re(t).build(e):"",c=He(this.condNode).build(e,"bool");e.addFlowCode(`
${e.tab}if ( ${c} ) {

`).addFlowTab();let u=He(this.ifNode,s).build(e,t);if(u=r?a+" = "+u+";":u,e.removeFlowTab().addFlowCode(e.tab+"	"+u+`

`+e.tab+"}"),i!==null){e.addFlowCode(` else {

`).addFlowTab();let l=He(i,s).build(e,t);l=a?a+" = "+l+";":l,e.removeFlowTab().addFlowCode(e.tab+"	"+l+`

`+e.tab+`}

`)}else e.addFlowCode(`

`);return a}}const je=N(no);g("cond",je);x("CondNode",no);class Zn extends E{constructor(e=null){super(),this.nodes=[],this.outputNode=null,this.parent=e,this._currentCond=null,this.isStackNode=!0}getNodeType(e){return this.outputNode?this.outputNode.getNodeType(e):"void"}add(e){return this.nodes.push(e),this}if(e,t){const s=new wt(t);return this._currentCond=je(e,s),this.add(this._currentCond)}elseif(e,t){const s=new wt(t),n=je(e,s);return this._currentCond.elseNode=n,this._currentCond=n,this}else(e){return this._currentCond.elseNode=new wt(e),this}build(e,...t){const s=Va();go(this);for(const n of this.nodes)n.build(e,"void");return go(s),this.outputNode?this.outputNode.build(e,...t):super.build(e,...t)}}N(Zn);x("StackNode",Zn);class Jn extends E{constructor(e){super(),this.types=e,this.isStructTypeNode=!0}getMemberTypes(){return this.types}}x("StructTypeNode",Jn);class Kn extends E{constructor(...e){super(),this.isOutputStructNode=!0,this.members=e}setup(e){super.setup(e);const t=this.members,s=[];for(let n=0;n<t.length;n++)s.push(t[n].getNodeType(e));this.nodeType=e.getStructTypeFromNode(new Jn(s)).name}generate(e,t){const s=e.getVarFromNode(this);s.isOutputStructVar=!0;const n=e.getPropertyName(s),i=this.members,r=n!==""?n+".":"";for(let a=0;a<i.length;a++){const c=i[a].build(e,t);e.addLineFlowCode(`${r}m${a} = ${c}`)}return n}}N(Kn);x("OutputStructNode",Kn);class Qn extends E{constructor(e){super(),this.seedNode=e}setup(){const e=this.seedNode.uint().mul(747796405).add(2891336453),t=e.shiftRight(e.shiftRight(28).add(4)).bitXor(e).mul(277803737);return t.shiftRight(22).bitXor(t).float().mul(1/2**32)}}const Xu=N(Qn);g("hash",Xu);x("HashNode",Qn);let Ns;class ei extends no{constructor(e){Ns=Ns||Js("discard"),super(e,Ns)}}const qu=N(ei),ju=o=>qu(o).append();g("discard",ju);x("DiscardNode",ei);class ti extends E{constructor(e=[],...t){super(),this.functionNodes=e,this.parametersNodes=t,this._candidateFnCall=null}getNodeType(){return this.functionNodes[0].shaderNode.layout.type}setup(e){const t=this.parametersNodes;let s=this._candidateFnCall;if(s===null){let n=null,i=-1;for(const r of this.functionNodes){const c=r.shaderNode.layout;if(c===null)throw new Error("FunctionOverloadingNode: FunctionNode must be a layout.");const u=c.inputs;if(t.length===u.length){let l=0;for(let p=0;p<t.length;p++){const f=t[p],v=u[p];f.getNodeType(e)===v.type?l++:l=0}l>i&&(n=r,i=l)}}this._candidateFnCall=s=n(...t)}return s}}const Yu=N(ti),be=o=>(...e)=>Yu(o,...e);x("FunctionOverloadingNode",ti);class si extends E{constructor(e=[]){super(),this.params=e}getVarName(e){return String.fromCharCode(105+e)}getProperties(e){const t=e.getNodeProperties(this);if(t.stackNode!==void 0)return t;const s={};for(let n=0,i=this.params.length-1;n<i;n++){const r=this.params[n],a=r.isNode!==!0&&r.name||this.getVarName(n),c=r.isNode!==!0&&r.type||"int";s[a]=Js(a,c)}return t.returnsNode=this.params[this.params.length-1](s,e.addStack(),e),t.stackNode=e.removeStack(),t}getNodeType(e){const{returnsNode:t}=this.getProperties(e);return t?t.getNodeType(e):"void"}setup(e){this.getProperties(e)}generate(e){const t=this.getProperties(e),s={tempWrite:!1},n=this.params,i=t.stackNode;for(let c=0,u=n.length-1;c<u;c++){const l=n[c];let p=null,f=null,v=null,_=null,M=null,O=null;l.isNode?(_="int",v=this.getVarName(c),p="0",f=l.build(e,_),M="<"):(_=l.type||"int",v=l.name||this.getVarName(c),p=l.start,f=l.end,M=l.condition,O=l.update,typeof p=="number"?p=p.toString():p&&p.isNode&&(p=p.build(e,_)),typeof f=="number"?f=f.toString():f&&f.isNode&&(f=f.build(e,_)),p!==void 0&&f===void 0?(p=p+" - 1",f="0",M=">="):f!==void 0&&p===void 0&&(p="0",M="<"),M===void 0&&(Number(p)>Number(f)?M=">=":M="<"));const R={start:p,end:f,condition:M},b=R.start,C=R.end;let D="",de="",F="";O||(_==="int"?M.includes("<")?O="++":O="--":M.includes("<")?O="+= 1":O="-= 1"),D+=e.getVar(_,v)+" = "+b,de+=v+" "+M+" "+C,F+=v+" "+O;const ie=`for ( ${D}; ${de}; ${F} )`;e.addFlowCode((c===0?`
`:"")+e.tab+ie+` {

`).addFlowTab()}const r=He(i,s).build(e,"void"),a=t.returnsNode?t.returnsNode.build(e):"";e.removeFlowTab().addFlowCode(`
`+e.tab+r);for(let c=0,u=this.params.length-1;c<u;c++)e.addFlowCode((c===0?"":e.tab)+`}

`).removeFlowTab();return e.addFlowTab(),a}}const le=(...o)=>w(new si(mt(o,"int"))).append();g("loop",(o,...e)=>sn(o,le(...e)));x("LoopNode",si);class oi extends ${constructor(){super("vec2")}setup(){const e=y(ce.z,0,ce.x.negate()).normalize(),t=ce.cross(e);return L(e.dot(K),t.dot(K)).mul(.495).add(.5)}}S(oi);x("MatcapUVNode",oi);class Te extends Ze{constructor(e=Te.LOCAL,t=1,s=0){super(s),this.scope=e,this.scale=t,this.updateType=Q.FRAME}update(e){const t=this.scope,s=this.scale;t===Te.LOCAL?this.value+=e.deltaTime*s:t===Te.DELTA?this.value=e.deltaTime*s:t===Te.FRAME?this.value=e.frameId:this.value=e.time*s}serialize(e){super.serialize(e),e.scope=this.scope,e.scale=this.scale}deserialize(e){super.deserialize(e),this.scope=e.scope,this.scale=e.scale}}Te.LOCAL="local";Te.GLOBAL="global";Te.DELTA="delta";Te.FRAME="frame";const Zu=(o,e=0)=>w(new Te(Te.LOCAL,o,e));S(Te,Te.FRAME).uint();x("TimerNode",Te);class oe extends E{constructor(e=oe.SINE,t=Zu()){super(),this.method=e,this.timeNode=t}getNodeType(e){return this.timeNode.getNodeType(e)}setup(){const e=this.method,t=w(this.timeNode);let s=null;return e===oe.SINE?s=t.add(.75).mul(Math.PI*2).sin().mul(.5).add(.5):e===oe.SQUARE?s=t.fract().round():e===oe.TRIANGLE?s=t.add(.5).fract().mul(2).sub(1).abs():e===oe.SAWTOOTH&&(s=t.fract()),s}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}oe.SINE="sine";oe.SQUARE="square";oe.TRIANGLE="triangle";oe.SAWTOOTH="sawtooth";N(oe,oe.SINE);N(oe,oe.SQUARE);N(oe,oe.TRIANGLE);N(oe,oe.SAWTOOTH);x("OscNode",oe);class Be extends ${constructor(e,t){super(),this.scope=e,this.node=t}getNodeType(e){return this.node.getNodeType(e)}setup(){const{scope:e,node:t}=this;let s=null;return e===Be.DIRECTION_TO_COLOR?s=t.mul(.5).add(.5):e===Be.COLOR_TO_DIRECTION&&(s=t.mul(2).sub(1)),s}}Be.DIRECTION_TO_COLOR="directionToColor";Be.COLOR_TO_DIRECTION="colorToDirection";const ni=N(Be,Be.DIRECTION_TO_COLOR),Ju=N(Be,Be.COLOR_TO_DIRECTION);g("directionToColor",ni);g("colorToDirection",Ju);x("PackingNode",Be);class io extends E{constructor(e,t,s,n=h(0),i=h(1)){super(),this.node=e,this.inLowNode=t,this.inHighNode=s,this.outLowNode=n,this.outHighNode=i,this.doClamp=!0}setup(){const{node:e,inLowNode:t,inHighNode:s,outLowNode:n,outHighNode:i,doClamp:r}=this;let a=e.sub(t).div(s.sub(t));return r===!0&&(a=a.clamp()),a.mul(i.sub(n)).add(n)}}const Ku=N(io,null,null,{doClamp:!1}),Qu=N(io);g("remap",Ku);g("remapClamp",Qu);x("RemapNode",io);class ii extends ${constructor(e,t,s=L(.5)){super("vec2"),this.uvNode=e,this.rotationNode=t,this.centerNode=s}setup(){const{uvNode:e,rotationNode:t,centerNode:s}=this,n=t.cos(),i=t.sin(),r=e.sub(s);return L(L(n,i).dot(r),L(i.negate(),n).dot(r)).add(s)}}const el=N(ii);g("rotateUV",el);x("RotateUVNode",ii);class ri extends E{constructor(e,t=Je(),s=h(0)){super("vec2"),this.countNode=e,this.uvNode=t,this.frameNode=s}setup(){const{frameNode:e,uvNode:t,countNode:s}=this,{width:n,height:i}=s,r=e.mod(n.mul(i)).floor(),a=r.mod(n),c=i.sub(r.add(1).div(n).ceil()),u=s.reciprocal(),l=L(a,c);return t.add(l).mul(u)}}N(ri);x("SpriteSheetUVNode",ri);class ai extends E{constructor(e,t=null,s=null,n=h(1),i=ve,r=$e){super("vec4"),this.textureXNode=e,this.textureYNode=t,this.textureZNode=s,this.scaleNode=n,this.positionNode=i,this.normalNode=r}setup(){const{textureXNode:e,textureYNode:t,textureZNode:s,scaleNode:n,positionNode:i,normalNode:r}=this;let a=r.abs().normalize();a=a.div(a.dot(y(1)));const c=i.yz.mul(n),u=i.zx.mul(n),l=i.xy.mul(n),p=e.value,f=t!==null?t.value:p,v=s!==null?s.value:p,_=De(p,c).mul(a.x),M=De(f,u).mul(a.y),O=De(v,l).mul(a.z);return Le(_,M,O)}}const tl=N(ai),sl=(...o)=>tl(...o);g("triplanarTexture",sl);x("TriplanarTexturesNode",ai);class ne extends E{constructor(e=ne.LOCAL){super("vec3"),this.scope=e}getHash(){return`bitangent-${this.scope}`}generate(e){const t=this.scope;let s;t===ne.GEOMETRY?s=Yt.cross(Zt):t===ne.LOCAL?s=$e.cross(to):t===ne.VIEW?s=Ye.cross(is):t===ne.WORLD&&(s=An.cross(Iu));const n=s.mul(Zt.w).xyz;return Ce(Y(n)).build(e,this.getNodeType(e))}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}ne.GEOMETRY="geometry";ne.LOCAL="local";ne.VIEW="view";ne.WORLD="world";S(ne,ne.GEOMETRY);S(ne,ne.LOCAL);const ol=S(ne,ne.VIEW);S(ne,ne.WORLD);const nl=Ce(K.cross(On).mul(Zt.w));Ce(nl.transformDirection(Ke));x("BitangentNode",ne);const as=1/6,ci=o=>X(as,X(o,X(o,o.negate().add(3)).sub(3)).add(1)),Os=o=>X(as,X(o,X(o,X(3,o).sub(6))).add(4)),ui=o=>X(as,X(o,X(o,X(-3,o).add(3)).add(3)).add(1)),bs=o=>X(as,Zs(o,3)),Ao=o=>ci(o).add(Os(o)),Mo=o=>ui(o).add(bs(o)),wo=o=>Le(-1,Os(o).div(ci(o).add(Os(o)))),Eo=o=>Le(1,bs(o).div(ui(o).add(bs(o)))),Ro=(o,e,t)=>{const s=o.uvNode,n=X(s,e.zw).add(.5),i=Ft(n),r=Ys(n),a=Ao(r.x),c=Mo(r.x),u=wo(r.x),l=Eo(r.x),p=wo(r.y),f=Eo(r.y),v=L(i.x.add(u),i.y.add(p)).sub(.5).mul(e.xy),_=L(i.x.add(l),i.y.add(p)).sub(.5).mul(e.xy),M=L(i.x.add(u),i.y.add(f)).sub(.5).mul(e.xy),O=L(i.x.add(l),i.y.add(f)).sub(.5).mul(e.xy),R=Ao(r.y).mul(Le(a.mul(o.uv(v).level(t)),c.mul(o.uv(_).level(t)))),b=Mo(r.y).mul(Le(a.mul(o.uv(M).level(t)),c.mul(o.uv(O).level(t))));return R.add(b)},il=(o,e)=>{const t=L(o.size(d(e))),s=L(o.size(d(e.add(1)))),n=Ct(1,t),i=Ct(1,s),r=Ro(o,P(n,t),Ft(e)),a=Ro(o,P(i,s),fn(e));return Ys(e).mix(r,a)};class li extends ${constructor(e,t=h(3)){super("vec4"),this.textureNode=e,this.blurNode=t}setup(){return il(this.textureNode,this.blurNode)}}const rl=N(li);g("bicubic",rl);x("TextureBicubicNode",li);class di extends E{constructor(){super("vec2"),this.isPointUVNode=!0}generate(){return"vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y )"}}S(di);x("PointUVNode",di);class ze extends E{constructor(e=ze.BACKGROUND_BLURRINESS,t=null){super(),this.scope=e,this.scene=t}setup(e){const t=this.scope,s=this.scene!==null?this.scene:e.scene;let n;return t===ze.BACKGROUND_BLURRINESS?n=it("backgroundBlurriness","float",s):t===ze.BACKGROUND_INTENSITY?n=it("backgroundIntensity","float",s):console.error("THREE.SceneNode: Unknown scope:",t),n}}ze.BACKGROUND_BLURRINESS="backgroundBlurriness";ze.BACKGROUND_INTENSITY="backgroundIntensity";S(ze,ze.BACKGROUND_BLURRINESS);S(ze,ze.BACKGROUND_INTENSITY);x("SceneNode",ze);class al extends eo{constructor(e,t,s=0){super(e,t,s),this.isStorageBufferNode=!0}getInputType(){return"storageBuffer"}}x("StorageBufferNode",al);class hi extends Tt{constructor(e,t,s=null){super(e,t),this.storeNode=s,this.isStoreTextureNode=!0}getNodeType(){return"void"}}N(hi);x("TextureStoreNode",hi);class cl extends Ut{constructor(e,t,s=null){super(e,t,s),this.userData=s}update(e){this.reference=this.userData!==null?this.userData:e.object.userData,super.update(e)}}x("UserDataNode",cl);const ul=T(({base:o,blend:e})=>{const t=s=>e[s].lessThan(mn).cond(e[s],o[s].oneMinus().div(e[s]).oneMinus().max(0));return y(t("x"),t("y"),t("z"))}),ll=T(({base:o,blend:e})=>{const t=s=>e[s].equal(1).cond(e[s],o[s].div(e[s].oneMinus()).max(0));return y(t("x"),t("y"),t("z"))}),dl=T(({base:o,blend:e})=>{const t=s=>o[s].oneMinus().mul(e[s].oneMinus()).oneMinus();return y(t("x"),t("y"),t("z"))}),hl=T(({base:o,blend:e})=>{const t=s=>o[s].lessThan(.5).cond(o[s].mul(e[s],2),o[s].oneMinus().mul(e[s].oneMinus()).oneMinus());return y(t("x"),t("y"),t("z"))});class ue extends ${constructor(e,t,s){super(),this.blendMode=e,this.baseNode=t,this.blendNode=s}setup(){const{blendMode:e,baseNode:t,blendNode:s}=this,n={base:t,blend:s};let i=null;return e===ue.BURN?i=ul(n):e===ue.DODGE?i=ll(n):e===ue.SCREEN?i=dl(n):e===ue.OVERLAY&&(i=hl(n)),i}}ue.BURN="burn";ue.DODGE="dodge";ue.SCREEN="screen";ue.OVERLAY="overlay";const pl=N(ue,ue.BURN),ml=N(ue,ue.DODGE),fl=N(ue,ue.OVERLAY),gl=N(ue,ue.SCREEN);g("burn",pl);g("dodge",ml);g("overlay",fl);g("screen",gl);x("BlendModeNode",ue);class pi extends E{constructor(){super("bool"),this.isFrontFacingNode=!0}generate(e){return e.getFrontFacing()}}const Nl=S(pi),mi=h(Nl).mul(2).sub(1);x("FrontFacingNode",pi);const yl=T(({textureNode:o,bumpScale:e})=>{let t=o;if(t.isTextureNode!==!0&&t.traverse(r=>{r.isTextureNode===!0&&(t=r)}),t.isTextureNode!==!0)throw new Error("THREE.TSL: dHdxy_fwd() requires a TextureNode.");const s=h(o),n=t.uvNode||Je(),i=r=>o.cache().context({getUV:()=>r,forceUVContext:!0});return L(h(i(n.add(n.dFdx()))).sub(s),h(i(n.add(n.dFdy()))).sub(s)).mul(e)}),xl=T(o=>{const{surf_pos:e,surf_norm:t,dHdxy:s}=o,n=e.dFdx().normalize(),i=e.dFdy().normalize(),r=t,a=i.cross(r),c=r.cross(n),u=n.dot(a).mul(mi),l=u.sign().mul(s.x.mul(a).add(s.y.mul(c)));return u.abs().mul(t).sub(l).normalize()});class fi extends ${constructor(e,t=null){super("vec3"),this.textureNode=e,this.scaleNode=t}setup(){const e=this.scaleNode!==null?this.scaleNode:1,t=yl({textureNode:this.textureNode,bumpScale:e});return xl({surf_pos:Ue,surf_norm:Ye,dHdxy:t})}}const Tl=N(fi);g("bumpMap",Tl);x("BumpMapNode",fi);const vl=T(({color:o,adjustment:e})=>e.mix(El(o.rgb),o.rgb)),_l=T(({color:o,adjustment:e})=>{const t=Le(o.r,o.g,o.b).div(3),s=o.r.max(o.g.max(o.b)),n=s.sub(t).mul(e).mul(-3);return Ge(o.rgb,s,n)}),Vl=T(({color:o,adjustment:e})=>{const t=y(.57735,.57735,.57735),s=e.cos();return y(o.rgb.mul(s).add(t.cross(o.rgb).mul(e.sin()).add(t.mul(Pt(t,o.rgb).mul(s.oneMinus())))))});class _e extends ${constructor(e,t,s=h(1)){super("vec3"),this.method=e,this.colorNode=t,this.adjustmentNode=s}setup(){const{method:e,colorNode:t,adjustmentNode:s}=this,n={color:t,adjustment:s};let i=null;return e===_e.SATURATION?i=vl(n):e===_e.VIBRANCE?i=_l(n):e===_e.HUE?i=Vl(n):console.error(`${this.type}: Method "${this.method}" not supported!`),i}}_e.SATURATION="saturation";_e.VIBRANCE="vibrance";_e.HUE="hue";const Sl=N(_e,_e.SATURATION),Al=N(_e,_e.VIBRANCE),Ml=N(_e,_e.HUE),wl=y(.2125,.7154,.0721),El=(o,e=wl)=>Pt(o,e);g("saturation",Sl);g("vibrance",Al);g("hue",Ml);x("ColorAdjustmentNode",_e);const Rl=T(o=>{const{eye_pos:e,surf_norm:t,mapN:s,uv:n}=o,i=e.dFdx(),r=e.dFdy(),a=n.dFdx(),c=n.dFdy(),u=t,l=r.cross(u),p=u.cross(i),f=l.mul(a.x).add(p.mul(c.x)),v=l.mul(a.y).add(p.mul(c.y)),_=f.dot(f).max(v.dot(v)),M=mi.mul(_.inverseSqrt());return Le(f.mul(s.x,M),v.mul(s.y,M),u.mul(s.z)).normalize()});class gi extends ${constructor(e,t=null){super("vec3"),this.node=e,this.scaleNode=t,this.normalMapType=co}setup(e){const{normalMapType:t,scaleNode:s}=this;let n=this.node.mul(2).sub(1);s!==null&&(n=y(n.xy.mul(s),n.z));let i=null;return t===Br?i=Sn.mul(n).normalize():t===co&&(e.hasGeometryAttribute("tangent")===!0?i=Cl.mul(n).normalize():i=Rl({eye_pos:Ue,surf_norm:Ye,mapN:n,uv:Je()})),i}}const Ll=N(gi),Cl=xt(is,ol,Ye);g("normalMap",Ll);x("NormalMapNode",gi);class Ni extends ${constructor(e,t){super(),this.sourceNode=e,this.stepsNode=t}setup(){const{sourceNode:e,stepsNode:t}=this;return e.mul(t).floor().div(t)}}const Il=N(Ni);g("posterize",Il);x("PosterizeNode",Ni);const Ol=T(({color:o,exposure:e})=>o.mul(e).clamp()),bl=T(({color:o,exposure:e})=>(o=o.mul(e),o.div(o.add(1)).clamp())),Dl=T(({color:o,exposure:e})=>{o=o.mul(e),o=o.sub(.004).max(0);const t=o.mul(o.mul(6.2).add(.5)),s=o.mul(o.mul(6.2).add(1.7)).add(.06);return t.div(s).pow(2.2)}),zl=T(({color:o})=>{const e=o.mul(o.add(.0245786)).sub(90537e-9),t=o.mul(o.add(.432951).mul(.983729)).add(.238081);return e.div(t)}),Fl=T(({color:o,exposure:e})=>{const t=xt(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),s=xt(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return o=o.mul(e).div(.6),o=t.mul(o),o=zl({color:o}),o=s.mul(o),o.clamp()}),Pl={[Gr]:Ol,[Wr]:bl,[kr]:Dl,[Hr]:Fl};class Ul extends ${constructor(e=Vs,t=h(1),s=null){super("vec3"),this.toneMapping=e,this.exposureNode=t,this.colorNode=s}getCacheKey(){let e=super.getCacheKey();return e="{toneMapping:"+this.toneMapping+",nodes:"+e+"}",e}setup(e){const t=this.colorNode||e.context.color,s=this.toneMapping;if(s===Vs)return t;const n={exposure:this.exposureNode,color:t},i=Pl[s];let r=null;return i?r=i(n):(console.error("ToneMappingNode: Unsupported Tone Mapping configuration.",s),r=t),r}}x("ToneMappingNode",Ul);let ys=null;class yi extends Bt{constructor(e=oo,t=null){ys===null&&(ys=new Fo),super(e,t,ys)}}const Bl=N(yi);g("viewportSharedTexture",Bl);x("ViewportSharedTextureNode",yi);const Gl=new $r(-1,1,1,-1,0,1);class Wl extends qr{constructor(e=!1){super();const t=e===!1?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute("position",new uo([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new uo(t,2))}}const kl=new Wl;class Hl{constructor(e=null){this._mesh=new Xr(kl,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,Gl)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}const xs=new Hl;class $l extends ${constructor(e,t=2){super(e),this.textureNode=e,this.sigma=t,this.directionNode=L(1),this._invSize=Z(new qe),this._passDirection=Z(new qe),this._horizontalRT=new Ss,this._verticalRT=new Ss,this.updateBeforeType=Q.RENDER,this.resolution=new qe(1,1)}setSize(e,t){e=Math.max(Math.round(e*this.resolution.x),1),t=Math.max(Math.round(t*this.resolution.y),1),this._invSize.value.set(1/e,1/t),this._horizontalRT.setSize(e,t),this._verticalRT.setSize(e,t)}updateBefore(e){const{renderer:t}=e,s=this.textureNode,n=s.value,i=t.getRenderTarget(),r=s.value;xs.material=this._material,this.setSize(n.image.width,n.image.height),t.setRenderTarget(this._horizontalRT),this._passDirection.value.set(1,0),xs.render(t),s.value=this._horizontalRT.texture,t.setRenderTarget(this._verticalRT),this._passDirection.value.set(0,1),xs.render(t),t.setRenderTarget(i),s.value=r}setup(e){const t=this.textureNode;if(t.isTextureNode!==!0)return console.error("GaussianBlurNode requires a TextureNode."),P();const s=t.uvNode||Je(),n=c=>t.cache().context({getUV:()=>c,forceUVContext:!0}),i=T(()=>{const c=3+2*this.sigma,u=this._getCoefficients(c),l=this._invSize,p=L(this.directionNode).mul(this._passDirection),f=h(u[0]).toVar(),v=y(n(s).mul(f)).toVar();for(let _=1;_<c;_++){const M=h(_),O=h(u[_]),R=L(p.mul(l.mul(M))).toVar(),b=y(n(s.add(R))),C=y(n(s.sub(R)));v.addAssign(b.add(C).mul(O)),f.addAssign(X(2,O))}return P(v.div(f),1)}),r=this._material||(this._material=e.createNodeMaterial("MeshBasicNodeMaterial"));r.fragmentNode=i();const a=e.getNodeProperties(this);return a.textureNode=t,De(this._verticalRT.texture)}_getCoefficients(e){const t=[];for(let s=0;s<e;s++)t.push(.39894*Math.exp(-.5*s*s/(e*e))/e);return t}}const Xl=(o,e)=>w(new $l(w(o),e));g("gaussianBlur",Xl);class Lo extends Tt{constructor(e,t){super(t),this.passNode=e,this.setUpdateMatrix(!1)}setup(e){return this.passNode.build(e),super.setup(e)}clone(){return new this.constructor(this.passNode,this.value)}}class Gt extends ${constructor(e,t,s){super("vec4"),this.scope=e,this.scene=t,this.camera=s,this._pixelRatio=1,this._width=1,this._height=1;const n=new zs;n.isRenderTargetTexture=!0,n.type=zo,n.name="PostProcessingDepth";const i=new Ss(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:jr});i.texture.name="PostProcessing",i.depthTexture=n,this.renderTarget=i,this.updateBeforeType=Q.FRAME,this._textureNode=w(new Lo(this,i.texture)),this._depthTextureNode=w(new Lo(this,n)),this._depthNode=null,this._cameraNear=Z(0),this._cameraFar=Z(0),this.isPassNode=!0}isGlobal(){return!0}getTextureNode(){return this._textureNode}getTextureDepthNode(){return this._depthTextureNode}getDepthNode(){if(this._depthNode===null){const e=this._cameraNear,t=this._cameraFar;this._depthNode=Cs(qn(this._depthTextureNode,e,t),e,t)}return this._depthNode}setup(){return this.scope===Gt.COLOR?this.getTextureNode():this.getDepthNode()}updateBefore(e){const{renderer:t}=e,{scene:s,camera:n}=this;this._pixelRatio=t.getPixelRatio();const i=t.getSize(new qe);this.setSize(i.width,i.height);const r=t.toneMapping,a=t.toneMappingNode,c=t.getRenderTarget();this._cameraNear.value=n.near,this._cameraFar.value=n.far,t.toneMapping=Vs,t.toneMappingNode=null,t.setRenderTarget(this.renderTarget),t.render(s,n),t.toneMapping=r,t.toneMappingNode=a,t.setRenderTarget(c)}setSize(e,t){this._width=e,this._height=t;const s=this._width*this._pixelRatio,n=this._height*this._pixelRatio;this.renderTarget.setSize(s,n)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}Gt.COLOR="color";Gt.DEPTH="depth";x("PassNode",Gt);class xi extends ${constructor(e=null,t={}){super(),this.functionNode=e,this.parameters=t}setParameters(e){return this.parameters=e,this}getParameters(){return this.parameters}getNodeType(e){return this.functionNode.getNodeType(e)}generate(e){const t=[],s=this.functionNode,n=s.getInputs(e),i=this.parameters;if(Array.isArray(i))for(let a=0;a<i.length;a++){const c=n[a],u=i[a];t.push(u.build(e,c.type))}else for(const a of n){const c=i[a.name];if(c!==void 0)t.push(c.build(e,a.type));else throw new Error(`FunctionCallNode: Input '${a.name}' not found in FunctionNode.`)}return`${s.build(e,"property")}( ${t.join(", ")} )`}}const ql=(o,...e)=>(e=e.length>1||e[0]&&e[0].isNode===!0?mt(e):ns(e[0]),w(new xi(w(o),e)));g("call",ql);x("FunctionCallNode",xi);class Ti extends E{constructor(e=null){super(),this._value=e,this._cache=null,this.inputType=null,this.outpuType=null,this.events=new Oo,this.isScriptableValueNode=!0}get isScriptableOutputNode(){return this.outputType!==null}set value(e){this._value!==e&&(this._cache&&this.inputType==="URL"&&this.value.value instanceof ArrayBuffer&&(URL.revokeObjectURL(this._cache),this._cache=null),this._value=e,this.events.dispatchEvent({type:"change"}),this.refresh())}get value(){return this._value}refresh(){this.events.dispatchEvent({type:"refresh"})}getValue(){const e=this.value;if(e&&this._cache===null&&this.inputType==="URL"&&e.value instanceof ArrayBuffer)this._cache=URL.createObjectURL(new Blob([e.value]));else if(e&&e.value!==null&&e.value!==void 0&&((this.inputType==="URL"||this.inputType==="String")&&typeof e.value=="string"||this.inputType==="Number"&&typeof e.value=="number"||this.inputType==="Vector2"&&e.value.isVector2||this.inputType==="Vector3"&&e.value.isVector3||this.inputType==="Vector4"&&e.value.isVector4||this.inputType==="Color"&&e.value.isColor||this.inputType==="Matrix3"&&e.value.isMatrix3||this.inputType==="Matrix4"&&e.value.isMatrix4))return e.value;return this._cache||e}getNodeType(e){return this.value&&this.value.isNode?this.value.getNodeType(e):"float"}setup(){return this.value&&this.value.isNode?this.value:h()}serialize(e){super.serialize(e),this.value!==null?this.inputType==="ArrayBuffer"?e.value=ko(this.value):e.value=this.value?this.value.toJSON(e.meta).uuid:null:e.value=null,e.inputType=this.inputType,e.outputType=this.outputType}deserialize(e){super.deserialize(e);let t=null;e.value!==null&&(e.inputType==="ArrayBuffer"?t=Ho(e.value):e.inputType==="Texture"?t=e.meta.textures[e.value]:t=e.meta.nodes[e.value]||null),this.value=t,this.inputType=e.inputType,this.outputType=e.outputType}}const kt=N(Ti);g("scriptableValue",kt);x("ScriptableValueNode",Ti);class vi extends Map{get(e,t=null,...s){if(this.has(e))return super.get(e);if(t!==null){const n=t(...s);return this.set(e,n),n}}}class jl{constructor(e){this.scriptableNode=e}get parameters(){return this.scriptableNode.parameters}get layout(){return this.scriptableNode.getLayout()}getInputLayout(e){return this.scriptableNode.getInputLayout(e)}get(e){const t=this.parameters[e];return t?t.getValue():null}}const Ts=new vi;class _i extends E{constructor(e=null,t={}){super(),this.codeNode=e,this.parameters=t,this._local=new vi,this._output=kt(),this._outputs={},this._source=this.source,this._method=null,this._object=null,this._value=null,this._needsOutputUpdate=!0,this.onRefresh=this.onRefresh.bind(this),this.isScriptableNode=!0}get source(){return this.codeNode?this.codeNode.code:""}setLocal(e,t){return this._local.set(e,t)}getLocal(e){return this._local.get(e)}onRefresh(){this._refresh()}getInputLayout(e){for(const t of this.getLayout())if(t.inputType&&(t.id===e||t.name===e))return t}getOutputLayout(e){for(const t of this.getLayout())if(t.outputType&&(t.id===e||t.name===e))return t}setOutput(e,t){const s=this._outputs;return s[e]===void 0?s[e]=kt(t):s[e].value=t,this}getOutput(e){return this._outputs[e]}getParameter(e){return this.parameters[e]}setParameter(e,t){const s=this.parameters;return t&&t.isScriptableNode?(this.deleteParameter(e),s[e]=t,s[e].getDefaultOutput().events.addEventListener("refresh",this.onRefresh)):t&&t.isScriptableValueNode?(this.deleteParameter(e),s[e]=t,s[e].events.addEventListener("refresh",this.onRefresh)):s[e]===void 0?(s[e]=kt(t),s[e].events.addEventListener("refresh",this.onRefresh)):s[e].value=t,this}getValue(){return this.getDefaultOutput().getValue()}deleteParameter(e){let t=this.parameters[e];return t&&(t.isScriptableNode&&(t=t.getDefaultOutput()),t.events.removeEventListener("refresh",this.onRefresh)),this}clearParameters(){for(const e of Object.keys(this.parameters))this.deleteParameter(e);return this.needsUpdate=!0,this}call(e,...t){const n=this.getObject()[e];if(typeof n=="function")return n(...t)}async callAsync(e,...t){const n=this.getObject()[e];if(typeof n=="function")return n.constructor.name==="AsyncFunction"?await n(...t):n(...t)}getNodeType(e){return this.getDefaultOutputNode().getNodeType(e)}refresh(e=null){e!==null?this.getOutput(e).refresh():this._refresh()}getObject(){if(this.needsUpdate&&this.dispose(),this._object!==null)return this._object;const e=()=>this.refresh(),t=(u,l)=>this.setOutput(u,l),s=new jl(this),n=Ts.get("THREE"),i=Ts.get("TSL"),r=this.getMethod(this.codeNode),a=[s,this._local,Ts,e,t,n,i];this._object=r(...a);const c=this._object.layout;if(c&&(c.cache===!1&&this._local.clear(),this._output.outputType=c.outputType||null,Array.isArray(c.elements)))for(const u of c.elements){const l=u.id||u.name;u.inputType&&(this.getParameter(l)===void 0&&this.setParameter(l,null),this.getParameter(l).inputType=u.inputType),u.outputType&&(this.getOutput(l)===void 0&&this.setOutput(l,null),this.getOutput(l).outputType=u.outputType)}return this._object}deserialize(e){super.deserialize(e);for(const t in this.parameters){let s=this.parameters[t];s.isScriptableNode&&(s=s.getDefaultOutput()),s.events.addEventListener("refresh",this.onRefresh)}}getLayout(){return this.getObject().layout}getDefaultOutputNode(){const e=this.getDefaultOutput().value;return e&&e.isNode?e:h()}getDefaultOutput(){return this._exec()._output}getMethod(){if(this.needsUpdate&&this.dispose(),this._method!==null)return this._method;const e=["parameters","local","global","refresh","setOutput","THREE","TSL"],s=["layout","init","main","dispose"].join(", "),n="var "+s+`; var output = {};
`,i=`
return { ...output, `+s+" };",r=n+this.codeNode.code+i;return this._method=new Function(...e,r),this._method}dispose(){this._method!==null&&(this._object&&typeof this._object.dispose=="function"&&this._object.dispose(),this._method=null,this._object=null,this._source=null,this._value=null,this._needsOutputUpdate=!0,this._output.value=null,this._outputs={})}setup(){return this.getDefaultOutputNode()}set needsUpdate(e){e===!0&&this.dispose()}get needsUpdate(){return this.source!==this._source}_exec(){return this.codeNode===null?this:(this._needsOutputUpdate===!0&&(this._value=this.call("main"),this._needsOutputUpdate=!1),this._output.value=this._value,this)}_refresh(){this.needsUpdate=!0,this._exec(),this._output.refresh()}}const Yl=N(_i);g("scriptable",Yl);x("ScriptableNode",_i);class cs extends E{constructor(e,t){super("float"),this.isFogNode=!0,this.colorNode=e,this.factorNode=t}mixAssign(e){return this.mix(e,this.colorNode)}setup(){return this.factorNode}}const Zl=N(cs);g("fog",Zl);x("FogNode",cs);class Vi extends cs{constructor(e,t,s){super(e),this.isFogRangeNode=!0,this.nearNode=t,this.farNode=s}setup(){return nt(this.nearNode,this.farNode,Ue.z.negate())}}const Jl=N(Vi);g("rangeFog",Jl);x("FogRangeNode",Vi);class Si extends cs{constructor(e,t){super(e),this.isFogExp2Node=!0,this.densityNode=t}setup(){const e=Ue.z.negate(),t=this.densityNode;return t.mul(t,e,e).negate().exp().oneMinus()}}const Kl=N(Si);g("densityFog",Kl);x("FogExp2Node",Si);let Qe=null,et=null;class Ai extends E{constructor(e=h(),t=h()){super(),this.minNode=e,this.maxNode=t}getVectorLength(e){const t=e.getTypeLength(tt(this.minNode.value)),s=e.getTypeLength(tt(this.maxNode.value));return t>s?t:s}getNodeType(e){return e.object.isInstancedMesh===!0?e.getTypeFromLength(this.getVectorLength(e)):"float"}setup(e){const t=e.object;let s=null;if(t.isInstancedMesh===!0){const n=this.minNode.value,i=this.maxNode.value,r=e.getTypeLength(tt(n)),a=e.getTypeLength(tt(i));Qe=Qe||new Rt,et=et||new Rt,Qe.setScalar(0),et.setScalar(0),r===1?Qe.setScalar(n):n.isColor?Qe.set(n.r,n.g,n.b):Qe.set(n.x,n.y,n.z||0,n.w||0),a===1?et.setScalar(i):i.isColor?et.set(i.r,i.g,i.b):et.set(i.x,i.y,i.z||0,i.w||0);const c=4,u=c*t.count,l=new Float32Array(u);for(let f=0;f<u;f++){const v=f%c,_=Qe.getComponent(v),M=et.getComponent(v);l[f]=bo.lerp(_,M,Math.random())}const p=this.getNodeType(e);s=In(l,"vec4",t.count).element(ja).convert(p)}else s=h(0);return s}}N(Ai);x("RangeNode",Ai);class Mi extends E{constructor(e,t,s=[64]){super("void"),this.isComputeNode=!0,this.computeNode=e,this.count=t,this.workgroupSize=s,this.dispatchCount=0,this.version=1,this.updateBeforeType=Q.OBJECT,this.updateDispatchCount()}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}updateDispatchCount(){const{count:e,workgroupSize:t}=this;let s=t[0];for(let n=1;n<t.length;n++)s*=t[n];this.dispatchCount=Math.ceil(e/s)}onInit(){}updateBefore({renderer:e}){e.compute(this)}generate(e){const{shaderStage:t}=e;if(t==="compute"){const s=this.computeNode.build(e,"void");s!==""&&e.addLineFlowCode(s)}}}const Ql=(o,e,t)=>w(new Mi(w(o),e,t));g("compute",Ql);x("ComputeNode",Mi);class at extends E{constructor(e=at.TARGET_DIRECTION,t=null){super(),this.scope=e,this.light=t}setup(){const{scope:e,light:t}=this;let s=null;return e===at.TARGET_DIRECTION&&(s=Ke.transformDirection(Rs(t).sub(Rs(t.target)))),s}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}at.TARGET_DIRECTION="targetDirection";const wi=N(at,at.TARGET_DIRECTION);x("LightNode",at);const Ei=T(o=>{const{lightDistance:e,cutoffDistance:t,decayExponent:s}=o,n=e.pow(s).max(.01).reciprocal();return t.greaterThan(0).cond(n.mul(e.div(t).pow4().oneMinus().clamp().pow2()),n)});class Ri extends ut{constructor(e=null){super(e),this.cutoffDistanceNode=Z(0),this.decayExponentNode=Z(0)}update(e){const{light:t}=this;super.update(e),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}setup(e){const{colorNode:t,cutoffDistanceNode:s,decayExponentNode:n,light:i}=this,r=e.context.lightingModel,a=Vn(i).sub(Ue),c=a.normalize(),u=a.length(),l=Ei({lightDistance:u,cutoffDistance:s,decayExponent:n}),p=t.mul(l),f=e.context.reflectedLight;r.direct({lightDirection:c,lightColor:p,reflectedLight:f},e.stack,e)}}x("PointLightNode",Ri);vt(Yr,Ri);class Li extends ut{constructor(e=null){super(e)}setup(e){super.setup(e);const t=e.context.lightingModel,s=this.colorNode,n=wi(this.light),i=e.context.reflectedLight;t.direct({lightDirection:n,lightColor:s,reflectedLight:i},e.stack,e)}}x("DirectionalLightNode",Li);vt(Zr,Li);class ro extends ut{constructor(e=null){super(e),this.coneCosNode=Z(0),this.penumbraCosNode=Z(0),this.cutoffDistanceNode=Z(0),this.decayExponentNode=Z(0)}update(e){super.update(e);const{light:t}=this;this.coneCosNode.value=Math.cos(t.angle),this.penumbraCosNode.value=Math.cos(t.angle*(1-t.penumbra)),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}getSpotAttenuation(e){const{coneCosNode:t,penumbraCosNode:s}=this;return nt(t,s,e)}setup(e){super.setup(e);const t=e.context.lightingModel,{colorNode:s,cutoffDistanceNode:n,decayExponentNode:i,light:r}=this,a=Vn(r).sub(Ue),c=a.normalize(),u=c.dot(wi(r)),l=this.getSpotAttenuation(u),p=a.length(),f=Ei({lightDistance:p,cutoffDistance:n,decayExponent:i}),v=s.mul(l).mul(f),_=e.context.reflectedLight;t.direct({lightDirection:c,lightColor:v,reflectedLight:_},e.stack,e)}}x("SpotLightNode",ro);vt(Po,ro);class ed extends Po{constructor(e,t,s,n,i,r){super(e,t,s,n,i,r),this.iesMap=null}copy(e,t){return super.copy(e,t),this.iesMap=e.iesMap,this}}const td=ed;class Ci extends ro{getSpotAttenuation(e){const t=this.light.iesMap;let s=null;if(t&&t.isTexture===!0){const n=e.acos().mul(1/Math.PI);s=De(t,L(n,0),0).r}else s=super.getSpotAttenuation(e);return s}}x("IESSpotLightNode",Ci);vt(td,Ci);class Ii extends ut{constructor(e=null){super(e)}setup({context:e}){e.irradiance.addAssign(this.colorNode)}}x("AmbientLightNode",Ii);vt(Jr,Ii);class Oi extends ut{constructor(e=null){super(e),this.lightPositionNode=Rs(e),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=Z(new Ds)}update(e){const{light:t}=this;super.update(e),this.lightPositionNode.object3d=t,this.groundColorNode.value.copy(t.groundColor).multiplyScalar(t.intensity)}setup(e){const{colorNode:t,groundColorNode:s,lightDirectionNode:n}=this,r=Ye.dot(n).mul(.5).add(.5),a=Ge(s,t,r);e.context.irradiance.addAssign(a)}}x("HemisphereLightNode",Oi);vt(Kr,Oi);const sd=T(o=>{const e=o.uv.mul(2),t=e.x.floor(),s=e.y.floor();return t.add(s).mod(2).sign()});class bi extends ${constructor(e=Je()){super("float"),this.uvNode=e}setup(){return sd({uv:this.uvNode})}}const od=N(bi);g("checker",od);x("CheckerNode",bi);const nd=new Uo;class id extends Oe{constructor(e={}){super(),this.normals=!1,this.lights=!1,this.useAlphaToCoverage=!0,this.useColor=e.vertexColors,this.pointWidth=1,this.pointColorNode=null,this.setDefaultValues(nd),this.setupShaders(),this.setValues(e)}setupShaders(){const e=this.alphaToCoverage,t=this.useColor;this.vertexNode=T(()=>{Y(L(),"vUv").assign(Je());const s=Ne("instancePosition"),n=Re("vec4","mvPos");n.assign(rt.mul(P(s,1)));const i=gt.z.div(gt.w),r=ke.mul(n),a=Re("vec2","offset");return a.assign(ye.xy),a.assign(a.mul(Au)),a.assign(a.div(gt.z)),a.y.assign(a.y.mul(i)),a.assign(a.mul(r.w)),r.assign(r.add(P(a,0,0))),r})(),this.fragmentNode=T(()=>{const s=Y(L(),"vUv"),n=Re("float","alpha");n.assign(1);const i=s.x,r=s.y,a=i.mul(i).add(r.mul(r));if(e){const u=Re("float","dlen");u.assign(a.fwidth()),n.assign(nt(u.oneMinus(),u.add(1),a).oneMinus())}else a.greaterThan(1).discard();let c;return this.pointColorNode?c=this.pointColorNode:t?c=Ne("instanceColor").mul(Ot):c=Ot,P(c,n)})(),this.needsUpdate=!0}get alphaToCoverage(){return this.useAlphaToCoverage}set alphaToCoverage(e){this.useAlphaToCoverage!==e&&(this.useAlphaToCoverage=e,this.setupShaders())}}Ae("InstancedPointsNodeMaterial",id);const rd=new Qr;class ad extends Oe{constructor(e){super(),this.isLineBasicNodeMaterial=!0,this.lights=!1,this.normals=!1,this.setDefaultValues(rd),this.setValues(e)}}Ae("LineBasicNodeMaterial",ad);const cd=new Bo;class ud extends Oe{constructor(e){super(),this.isLineDashedNodeMaterial=!0,this.lights=!1,this.normals=!1,this.setDefaultValues(cd),this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(e)}setupVariants(){const e=this.offsetNode,t=this.dashScaleNode?h(this.dashScaleNode):Ls,s=this.dashSizeNode?h(this.dashSizeNode):wn,n=this.dashSizeNode?h(this.dashGapNode):En;ft.assign(s),qt.assign(n);const i=Y(Ne("lineDistance").mul(t));(e?i.add(e):i).mod(ft.add(qt)).greaterThan(ft).discard()}}Ae("LineDashedNodeMaterial",ud);const ld=new Bo;class dd extends Oe{constructor(e={}){super(),this.normals=!1,this.lights=!1,this.setDefaultValues(ld),this.useAlphaToCoverage=!0,this.useColor=e.vertexColors,this.useDash=e.dashed,this.useWorldUnits=!1,this.dashOffset=0,this.lineWidth=1,this.lineColorNode=null,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setupShaders(),this.setValues(e)}setupShaders(){const e=this.alphaToCoverage,t=this.useColor,s=this.dashed,n=this.worldUnits,i=T(({start:a,end:c})=>{const u=ke.element(2).element(2),f=ke.element(3).element(2).mul(-.5).div(u).sub(a.z).div(c.z.sub(a.z));return P(Ge(a.xyz,c.xyz,f),c.w)});this.vertexNode=T(()=>{Xe("vec2","vUv").assign(Je());const a=Ne("instanceStart"),c=Ne("instanceEnd"),u=Re("vec4","start"),l=Re("vec4","end");u.assign(rt.mul(P(a,1))),l.assign(rt.mul(P(c,1))),n&&(Xe("vec3","worldStart").assign(u.xyz),Xe("vec3","worldEnd").assign(l.xyz));const p=gt.z.div(gt.w),f=ke.element(2).element(3).equal(-1);W(f,()=>{W(u.z.lessThan(0).and(l.z.greaterThan(0)),()=>{l.assign(i({start:u,end:l}))}).elseif(l.z.lessThan(0).and(u.z.greaterThanEqual(0)),()=>{u.assign(i({start:l,end:u}))})});const v=ke.mul(u),_=ke.mul(l),M=v.xyz.div(v.w),O=_.xyz.div(_.w),R=O.xy.sub(M.xy).temp();R.x.assign(R.x.mul(p)),R.assign(R.normalize());const b=Lt(P());if(n){const C=l.xyz.sub(u.xyz).normalize(),D=ye.y.lessThan(.5).cond(u.xyz.cross(C).normalize(),l.xyz.cross(C).normalize());D.assign(ye.x.lessThan(0).cond(D.negate(),D));const de=C.dot(y(0,0,1));s||(u.assign(u.sub(P(C.mul(St).mul(.5),0))),l.assign(l.add(P(C.mul(St).mul(.5),0))),D.assign(D.sub(y(R.mul(de),0))),D.z.assign(D.z.add(.5))),W(ye.y.greaterThan(1).or(ye.y.lessThan(0)),()=>{D.assign(D.add(y(R.mul(2).mul(de),0)))}),D.assign(D.mul(St).mul(.5));const F=Xe("vec4","worldPos");F.assign(ye.y.lessThan(.5).cond(u,l)),F.assign(F.add(P(D,0))),b.assign(ke.mul(F));const ie=Lt(y());ie.assign(ye.y.lessThan(.5).cond(M,O)),b.z.assign(ie.z.mul(b.w))}else{const C=Re("vec2","offset");C.assign(L(R.y,R.x.negate())),R.x.assign(R.x.div(p)),C.x.assign(C.x.div(p)),C.assign(ye.x.lessThan(0).cond(C.negate(),C)),W(ye.y.lessThan(0),()=>{C.assign(C.sub(R))}).elseif(ye.y.greaterThan(1),()=>{C.assign(C.add(R))}),C.assign(C.mul(St)),C.assign(C.div(gt.w)),b.assign(ye.y.lessThan(.5).cond(v,_)),C.assign(C.mul(b.w)),b.assign(b.add(P(C,0,0)))}return b})();const r=T(({p1:a,p2:c,p3:u,p4:l})=>{const p=a.sub(u),f=l.sub(u),v=c.sub(a),_=p.dot(f),M=f.dot(v),O=p.dot(v),R=f.dot(f),C=v.dot(v).mul(R).sub(M.mul(M)),de=_.mul(M).sub(O.mul(R)).div(C).clamp(),F=_.add(M.mul(de)).div(R).clamp();return L(de,F)});this.fragmentNode=T(()=>{const a=Xe("vec2","vUv");if(s){const l=this.offsetNode?h(this.offsetNodeNode):xo,p=this.dashScaleNode?h(this.dashScaleNode):Ls,f=this.dashSizeNode?h(this.dashSizeNode):wn,v=this.dashSizeNode?h(this.dashGapNode):En;ft.assign(f),qt.assign(v);const _=Ne("instanceDistanceStart"),M=Ne("instanceDistanceEnd"),O=ye.y.lessThan(.5).cond(p.mul(_),Ls.mul(M)),R=Y(O.add(xo)),b=l?R.add(l):R;a.y.lessThan(-1).or(a.y.greaterThan(1)).discard(),b.mod(ft.add(qt)).greaterThan(ft).discard()}const c=Re("float","alpha");if(c.assign(1),n){const l=Xe("vec3","worldStart"),p=Xe("vec3","worldEnd"),f=Xe("vec4","worldPos").xyz.normalize().mul(1e5),v=p.sub(l),_=r({p1:l,p2:p,p3:y(0,0,0),p4:f}),M=l.add(v.mul(_.x)),O=f.mul(_.y),C=M.sub(O).length().div(St);if(!s)if(e){const D=C.fwidth();c.assign(nt(D.negate().add(.5),D.add(.5),C).oneMinus())}else C.greaterThan(.5).discard()}else if(e){const l=a.x,p=a.y.greaterThan(0).cond(a.y.sub(1),a.y.add(1)),f=l.mul(l).add(p.mul(p)),v=Re("float","dlen");v.assign(f.fwidth()),W(a.y.abs().greaterThan(1),()=>{c.assign(nt(v.oneMinus(),v.add(1),f).oneMinus())})}else W(a.y.abs().greaterThan(1),()=>{const l=a.x,p=a.y.greaterThan(0).cond(a.y.sub(1),a.y.add(1));l.mul(l).add(p.mul(p)).greaterThan(1).discard()});let u;if(this.lineColorNode)u=this.lineColorNode;else if(t){const l=Ne("instanceColorStart"),p=Ne("instanceColorEnd");u=ye.y.lessThan(.5).cond(l,p).mul(Ot)}else u=Ot;return P(u,c)})(),this.needsUpdate=!0}get worldUnits(){return this.useWorldUnits}set worldUnits(e){this.useWorldUnits!==e&&(this.useWorldUnits=e,this.setupShaders())}get dashed(){return this.useDash}set dashed(e){this.useDash!==e&&(this.useDash=e,this.setupShaders())}get alphaToCoverage(){return this.useAlphaToCoverage}set alphaToCoverage(e){this.useAlphaToCoverage!==e&&(this.useAlphaToCoverage=e,this.setupShaders())}}Ae("Line2NodeMaterial",dd);const hd=new ea;class pd extends Oe{constructor(e){super(),this.isMeshNormalNodeMaterial=!0,this.colorSpaced=!1,this.setDefaultValues(hd),this.setValues(e)}setupDiffuseColor(){const e=this.opacityNode?h(this.opacityNode):Mn;ge.assign(P(ni(K),e))}}Ae("MeshNormalNodeMaterial",pd);const md=new ta;class fd extends Oe{constructor(e){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!1,this.setDefaultValues(md),this.setValues(e)}}Ae("MeshBasicNodeMaterial",fd);const bt=T(({f0:o,f90:e,dotVH:t})=>{const s=t.mul(-5.55473).sub(6.98316).mul(t).exp2();return o.mul(s.oneMinus()).add(e.mul(s))}),Kt=T(o=>o.diffuseColor.mul(1/Math.PI)),gd=()=>h(.25),Nd=T(({dotNH:o})=>Es.mul(.5/Math.PI).add(1).mul(o.pow(Es))),yd=T(({lightDirection:o})=>{const e=o.add(ce).normalize(),t=K.dot(e).clamp(),s=ce.dot(e).clamp(),n=bt({f0:We,f90:1,dotVH:s}),i=gd(),r=Nd({dotNH:t});return n.mul(i).mul(r)});class Di extends rn{constructor(e=!0){super(),this.specular=e}direct({lightDirection:e,lightColor:t,reflectedLight:s}){const i=K.dot(e).clamp().mul(t);s.directDiffuse.addAssign(i.mul(Kt({diffuseColor:ge.rgb}))),this.specular===!0&&s.directSpecular.addAssign(i.mul(yd({lightDirection:e})).mul(hu))}indirectDiffuse({irradiance:e,reflectedLight:t}){t.indirectDiffuse.addAssign(e.mul(Kt({diffuseColor:ge})))}}const xd=new sa;class Td extends Oe{constructor(e){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(xd),this.setValues(e)}setupLightingModel(){return new Di(!1)}}Ae("MeshLambertNodeMaterial",Td);const vd=new oa;class _d extends Oe{constructor(e){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(vd),this.setValues(e)}setupLightingModel(){return new Di}setupVariants(){const e=(this.shininessNode?h(this.shininessNode):uu).max(1e-4);Es.assign(e);const t=this.specularNode||du;We.assign(t)}copy(e){return this.shininessNode=e.shininessNode,this.specularNode=e.specularNode,super.copy(e)}}Ae("MeshPhongNodeMaterial",_d);const Vd=T(()=>{const o=Yt.dFdx().abs().max(Yt.dFdy().abs());return o.x.max(o.y).max(o.z)}),Sd=T(o=>{const{roughness:e}=o,t=Vd();let s=e.max(.0525);return s=s.add(t),s=s.min(1),s}),Ad=T(o=>{const{alpha:e,dotNL:t,dotNV:s}=o,n=e.pow2(),i=t.mul(n.add(n.oneMinus().mul(s.pow2())).sqrt()),r=s.mul(n.add(n.oneMinus().mul(t.pow2())).sqrt());return Ct(.5,i.add(r).max(mn))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),Md=T(({alpha:o,dotNH:e})=>{const t=o.pow2(),s=e.pow2().mul(t.oneMinus()).oneMinus();return t.div(s.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),Co=T(o=>{const{lightDirection:e,f0:t,f90:s,roughness:n,iridescenceFresnel:i}=o,r=o.normalView||K,a=n.pow2(),c=e.add(ce).normalize(),u=r.dot(e).clamp(),l=r.dot(ce).clamp(),p=r.dot(c).clamp(),f=ce.dot(c).clamp();let v=bt({f0:t,f90:s,dotVH:f});i&&(v=qs.mix(v,i));const _=Ad({alpha:a,dotNL:u,dotNV:l}),M=Md({alpha:a,dotNH:p});return v.mul(_).mul(M)}),zi=T(({roughness:o,dotNV:e})=>{const t=P(-1,-.0275,-.572,.022),s=P(1,.0425,1.04,-.04),n=o.mul(t).add(s),i=n.x.mul(n.x).min(e.mul(-9.28).exp2()).mul(n.x).add(n.y);return L(-1.04,1.04).mul(i).add(n.zw)}).setLayout({name:"DFGApprox",type:"vec2",inputs:[{name:"roughness",type:"float"},{name:"dotNV",type:"vec3"}]}),wd=T(o=>{const{dotNV:e,specularColor:t,specularF90:s,roughness:n}=o,i=zi({dotNV:e,roughness:n});return t.mul(i.x).add(s.mul(i.y))}),Ed=T(({f:o,f90:e,dotVH:t})=>{const s=t.oneMinus().saturate(),n=s.mul(s),i=s.mul(n,n).clamp(0,.9999);return o.sub(y(e).mul(i)).div(i.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),Rd=T(({roughness:o,dotNH:e})=>{const t=o.pow2(),s=h(1).div(t),i=e.pow2().oneMinus().max(.0078125);return h(2).add(s).mul(i.pow(s.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),Ld=T(({dotNV:o,dotNL:e})=>h(1).div(h(4).mul(e.add(o).sub(e.mul(o))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),Cd=T(({lightDirection:o})=>{const e=o.add(ce).normalize(),t=K.dot(o).clamp(),s=K.dot(ce).clamp(),n=K.dot(e).clamp(),i=Rd({roughness:Xs,dotNH:n}),r=Ld({dotNV:s,dotNL:t});return ht.mul(i).mul(r)}),Id=xt(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),Od=o=>{const e=o.sqrt();return y(1).add(e).div(y(1).sub(e))},Io=(o,e)=>o.sub(e).div(o.add(e)).pow2(),bd=(o,e)=>{const t=o.mul(2*Math.PI*1e-9),s=y(54856e-17,44201e-17,52481e-17),n=y(1681e3,1795300,2208400),i=y(43278e5,93046e5,66121e5),r=h(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(t.mul(2239900).add(e.x).cos()).mul(t.pow2().mul(-45282e5).exp());let a=s.mul(i.mul(2*Math.PI).sqrt()).mul(n.mul(t).add(e).cos()).mul(t.pow2().negate().mul(i).exp());return a=y(a.x.add(r),a.y,a.z).div(10685e-11),Id.mul(a)},Dd=T(({outsideIOR:o,eta2:e,cosTheta1:t,thinFilmThickness:s,baseF0:n})=>{const i=Ge(o,e,nt(0,.03,s)),r=o.div(i).pow2().mul(h(1).sub(t.pow2())),c=h(1).sub(r).sqrt(),u=Io(i,o),l=bt({f0:u,f90:1,dotVH:t}),p=l.oneMinus(),f=i.lessThan(o).cond(Math.PI,0),v=h(Math.PI).sub(f),_=Od(n.clamp(0,.9999)),M=Io(_,i.vec3()),O=bt({f0:M,f90:1,dotVH:c}),R=y(_.x.lessThan(i).cond(Math.PI,0),_.y.lessThan(i).cond(Math.PI,0),_.z.lessThan(i).cond(Math.PI,0)),b=i.mul(s,c,2),C=y(v).add(R),D=l.mul(O).clamp(1e-5,.9999),de=D.sqrt(),F=p.pow2().mul(O).div(y(1).sub(D));let re=l.add(F),us=F.sub(p);for(let Wt=1;Wt<=2;++Wt){us=us.mul(de);const vr=bd(h(Wt).mul(b),h(Wt).mul(C)).mul(2);re=re.add(us.mul(vr))}return re.max(y(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),zd=T(({normal:o,viewDir:e,roughness:t})=>{const s=o.dot(e).saturate(),n=t.pow2(),i=je(t.lessThan(.25),h(-339.2).mul(n).add(h(161.4).mul(t)).sub(25.9),h(-8.48).mul(n).add(h(14.3).mul(t)).sub(9.95)),r=je(t.lessThan(.25),h(44).mul(n).sub(h(23.7).mul(t)).add(3.26),h(1.97).mul(n).sub(h(3.27).mul(t)).add(.72));return je(t.lessThan(.25),0,h(.1).mul(t).sub(.025)).add(i.mul(s).add(r).exp()).mul(1/Math.PI).saturate()}),vs=y(.04),_s=y(1);class Fi extends rn{constructor(e=!1,t=!1,s=!1){super(),this.clearcoat=e,this.sheen=t,this.iridescence=s,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null}start(){if(this.clearcoat===!0&&(this.clearcoatRadiance=y().temp("clearcoatRadiance"),this.clearcoatSpecularDirect=y().temp("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=y().temp("clearcoatSpecularIndirect")),this.sheen===!0&&(this.sheenSpecularDirect=y().temp("sheenSpecularDirect"),this.sheenSpecularIndirect=y().temp("sheenSpecularIndirect")),this.iridescence===!0){const e=K.dot(ce).clamp();this.iridescenceFresnel=Dd({outsideIOR:h(1),eta2:cn,cosTheta1:e,thinFilmThickness:un,baseF0:We}),this.iridescenceF0=Ed({f:this.iridescenceFresnel,f90:1,dotVH:e})}}computeMultiscattering(e,t,s=h(1)){const n=K.dot(ce).clamp(),i=zi({roughness:Et,dotNV:n}),a=(this.iridescenceF0?qs.mix(We,this.iridescenceF0):We).mul(i.x).add(s.mul(i.y)),u=i.x.add(i.y).oneMinus(),l=We.add(We.oneMinus().mul(.047619)),p=a.mul(l).div(u.mul(l).oneMinus());e.addAssign(a),t.addAssign(p.mul(u))}direct({lightDirection:e,lightColor:t,reflectedLight:s}){const i=K.dot(e).clamp().mul(t);if(this.sheen===!0&&this.sheenSpecularDirect.addAssign(i.mul(Cd({lightDirection:e}))),this.clearcoat===!0){const a=pt.dot(e).clamp().mul(t);this.clearcoatSpecularDirect.addAssign(a.mul(Co({lightDirection:e,f0:vs,f90:_s,roughness:Xt,normalView:pt})))}s.directDiffuse.addAssign(i.mul(Kt({diffuseColor:ge.rgb}))),s.directSpecular.addAssign(i.mul(Co({lightDirection:e,f0:We,f90:1,roughness:Et,iridescence:this.iridescence,iridescenceFresnel:this.iridescenceFresnel})))}indirectDiffuse({irradiance:e,reflectedLight:t}){t.indirectDiffuse.addAssign(e.mul(Kt({diffuseColor:ge})))}indirectSpecular({radiance:e,iblIrradiance:t,reflectedLight:s}){if(this.sheen===!0&&this.sheenSpecularIndirect.addAssign(t.mul(ht,zd({normal:K,viewDir:ce,roughness:Xs}))),this.clearcoat===!0){const u=pt.dot(ce).clamp(),l=wd({dotNV:u,specularColor:vs,specularF90:_s,roughness:Xt});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(l))}const n=y().temp("singleScattering"),i=y().temp("multiScattering"),r=t.mul(1/Math.PI);this.computeMultiscattering(n,i);const a=n.add(i),c=ge.mul(a.r.max(a.g).max(a.b).oneMinus());s.indirectSpecular.addAssign(e.mul(n)),s.indirectSpecular.addAssign(i.mul(r)),s.indirectDiffuse.addAssign(c.mul(r))}ambientOcclusion({ambientOcclusion:e,reflectedLight:t}){const n=K.dot(ce).clamp().add(e),i=Et.mul(-16).oneMinus().negate().exp2(),r=e.sub(n.pow(i).oneMinus()).clamp();this.clearcoat===!0&&this.clearcoatSpecularIndirect.mulAssign(e),this.sheen===!0&&this.sheenSpecularIndirect.mulAssign(e),t.indirectDiffuse.mulAssign(e),t.indirectSpecular.mulAssign(r)}finish(e){const{outgoingLight:t}=e;if(this.clearcoat===!0){const s=pt.dot(ce).clamp(),n=bt({dotVH:s,f0:vs,f90:_s}),i=t.mul(ws.mul(n).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(ws));t.assign(i)}if(this.sheen===!0){const s=ht.r.max(ht.g).max(ht.b).mul(.157).oneMinus(),n=t.mul(s).add(this.sheenSpecularDirect,this.sheenSpecularIndirect);t.assign(n)}}}const Fd=new na;class Pi extends Oe{constructor(e){super(),this.isMeshStandardNodeMaterial=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(Fd),this.setValues(e)}setupLightingModel(){return new Fi}setupVariants(){const e=this.metalnessNode?h(this.metalnessNode):mu;Ya.assign(e);let t=this.roughnessNode?h(this.roughnessNode):pu;t=Sd({roughness:t}),Et.assign(t);const s=Ge(y(.04),ge.rgb,e);We.assign(s),ge.assign(P(ge.rgb.mul(e.oneMinus()),ge.a))}copy(e){return this.emissiveNode=e.emissiveNode,this.metalnessNode=e.metalnessNode,this.roughnessNode=e.roughnessNode,super.copy(e)}}Ae("MeshStandardNodeMaterial",Pi);const Pd=new ia;class Ud extends Pi{constructor(e){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.setDefaultValues(Pd),this.setValues(e)}get useClearcoat(){return this.clearcoat>0||this.clearcoatNode!==null}get useIridescence(){return this.iridescence>0||this.iridescenceNode!==null}get useSheen(){return this.sheen>0||this.sheenNode!==null}setupLightingModel(){return new Fi(this.useClearcoat,this.useSheen,this.useIridescence)}setupVariants(e){if(super.setupVariants(e),this.useClearcoat){const t=this.clearcoatNode?h(this.clearcoatNode):gu,s=this.clearcoatRoughnessNode?h(this.clearcoatRoughnessNode):Nu;ws.assign(t),Xt.assign(s)}if(this.useSheen){const t=this.sheenNode?y(this.sheenNode):Tu,s=this.sheenRoughnessNode?h(this.sheenRoughnessNode):vu;ht.assign(t),Xs.assign(s)}if(this.useIridescence){const t=this.iridescenceNode?h(this.iridescenceNode):_u,s=this.iridescenceIORNode?h(this.iridescenceIORNode):Vu,n=this.iridescenceThicknessNode?h(this.iridescenceThicknessNode):Su;qs.assign(t),cn.assign(s),un.assign(n)}}setupNormal(e){super.setupNormal(e);const t=this.clearcoatNormalNode?y(this.clearcoatNormalNode):yu;pt.assign(t)}copy(e){return this.clearcoatNode=e.clearcoatNode,this.clearcoatRoughnessNode=e.clearcoatRoughnessNode,this.clearcoatNormalNode=e.clearcoatNormalNode,this.sheenNode=e.sheenNode,this.sheenRoughnessNode=e.sheenRoughnessNode,this.iridescenceNode=e.iridescenceNode,this.iridescenceIORNode=e.iridescenceIORNode,this.iridescenceThicknessNode=e.iridescenceThicknessNode,this.specularIntensityNode=e.specularIntensityNode,this.specularColorNode=e.specularColorNode,this.transmissionNode=e.transmissionNode,this.thicknessNode=e.thicknessNode,this.attenuationDistanceNode=e.attenuationDistanceNode,this.attenuationColorNode=e.attenuationColorNode,super.copy(e)}}Ae("MeshPhysicalNodeMaterial",Ud);const Bd=new Uo;class Gd extends Oe{constructor(e){super(),this.isPointsNodeMaterial=!0,this.lights=!1,this.normals=!1,this.transparent=!0,this.sizeNode=null,this.setDefaultValues(Bd),this.setValues(e)}copy(e){return this.sizeNode=e.sizeNode,super.copy(e)}}Ae("PointsNodeMaterial",Gd);const Wd=new ra;class kd extends Oe{constructor(e){super(),this.isSpriteNodeMaterial=!0,this.lights=!1,this.normals=!1,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.setDefaultValues(Wd),this.setValues(e)}setupPosition({object:e,context:t}){const{positionNode:s,rotationNode:n,scaleNode:i}=this,r=ve;let a=rt.mul(y(s||0)),c=L(jt[0].xyz.length(),jt[1].xyz.length());i!==null&&(c=c.mul(i));let u=r.xy;e.center&&e.center.isVector2===!0&&(u=u.sub(Z(e.center).sub(.5))),u=u.mul(c);const l=h(n||xu),p=l.cos(),f=l.sin(),v=L(L(p,f.negate()).dot(u),L(f,p).dot(u));a=P(a.xy.add(v),a.zw);const _=ke.mul(a);return t.vertex=r,_}copy(e){return this.positionNode=e.positionNode,this.rotationNode=e.rotationNode,this.scaleNode=e.scaleNode,super.copy(e)}}Ae("SpriteNodeMaterial",kd);const Nt=T(([o,e,t])=>{const s=h(t).toVar(),n=h(e).toVar(),i=st(o).toVar();return je(i,n,s)}),Dt=T(([o,e])=>{const t=st(e).toVar(),s=h(o).toVar();return je(t,s.negate(),s)}),q=T(([o])=>{const e=h(o).toVar();return d(Ft(e))}),k=T(([o,e])=>{const t=h(o).toVar();return e.assign(q(t)),t.sub(h(e))}),Ui=T(([o,e,t,s,n,i])=>{const r=h(i).toVar(),a=h(n).toVar(),c=h(s).toVar(),u=h(t).toVar(),l=h(e).toVar(),p=h(o).toVar(),f=h(he(1,a)).toVar();return he(1,r).mul(p.mul(f).add(l.mul(a))).add(r.mul(u.mul(f).add(c.mul(a))))}),Bi=T(([o,e,t,s,n,i])=>{const r=h(i).toVar(),a=h(n).toVar(),c=y(s).toVar(),u=y(t).toVar(),l=y(e).toVar(),p=y(o).toVar(),f=h(he(1,a)).toVar();return he(1,r).mul(p.mul(f).add(l.mul(a))).add(r.mul(u.mul(f).add(c.mul(a))))}),Gi=be([Ui,Bi]),Wi=T(([o,e,t,s,n,i,r,a,c,u,l])=>{const p=h(l).toVar(),f=h(u).toVar(),v=h(c).toVar(),_=h(a).toVar(),M=h(r).toVar(),O=h(i).toVar(),R=h(n).toVar(),b=h(s).toVar(),C=h(t).toVar(),D=h(e).toVar(),de=h(o).toVar(),F=h(he(1,v)).toVar(),ie=h(he(1,f)).toVar();return h(he(1,p)).toVar().mul(ie.mul(de.mul(F).add(D.mul(v))).add(f.mul(C.mul(F).add(b.mul(v))))).add(p.mul(ie.mul(R.mul(F).add(O.mul(v))).add(f.mul(M.mul(F).add(_.mul(v))))))}),ki=T(([o,e,t,s,n,i,r,a,c,u,l])=>{const p=h(l).toVar(),f=h(u).toVar(),v=h(c).toVar(),_=y(a).toVar(),M=y(r).toVar(),O=y(i).toVar(),R=y(n).toVar(),b=y(s).toVar(),C=y(t).toVar(),D=y(e).toVar(),de=y(o).toVar(),F=h(he(1,v)).toVar(),ie=h(he(1,f)).toVar();return h(he(1,p)).toVar().mul(ie.mul(de.mul(F).add(D.mul(v))).add(f.mul(C.mul(F).add(b.mul(v))))).add(p.mul(ie.mul(R.mul(F).add(O.mul(v))).add(f.mul(M.mul(F).add(_.mul(v))))))}),Hi=be([Wi,ki]),$i=T(([o,e,t])=>{const s=h(t).toVar(),n=h(e).toVar(),i=A(o).toVar(),r=A(i.bitAnd(A(7))).toVar(),a=h(Nt(r.lessThan(A(4)),n,s)).toVar(),c=h(X(2,Nt(r.lessThan(A(4)),s,n))).toVar();return Dt(a,st(r.bitAnd(A(1)))).add(Dt(c,st(r.bitAnd(A(2)))))}),Xi=T(([o,e,t,s])=>{const n=h(s).toVar(),i=h(t).toVar(),r=h(e).toVar(),a=A(o).toVar(),c=A(a.bitAnd(A(15))).toVar(),u=h(Nt(c.lessThan(A(8)),r,i)).toVar(),l=h(Nt(c.lessThan(A(4)),i,Nt(c.equal(A(12)).or(c.equal(A(14))),r,n))).toVar();return Dt(u,st(c.bitAnd(A(1)))).add(Dt(l,st(c.bitAnd(A(2)))))}),ae=be([$i,Xi]),qi=T(([o,e,t])=>{const s=h(t).toVar(),n=h(e).toVar(),i=zt(o).toVar();return y(ae(i.x,n,s),ae(i.y,n,s),ae(i.z,n,s))}),ji=T(([o,e,t,s])=>{const n=h(s).toVar(),i=h(t).toVar(),r=h(e).toVar(),a=zt(o).toVar();return y(ae(a.x,r,i,n),ae(a.y,r,i,n),ae(a.z,r,i,n))}),Me=be([qi,ji]),Yi=T(([o])=>{const e=h(o).toVar();return X(.6616,e)}),Zi=T(([o])=>{const e=h(o).toVar();return X(.982,e)}),Ji=T(([o])=>{const e=y(o).toVar();return X(.6616,e)}),Ki=be([Yi,Ji]),Qi=T(([o])=>{const e=y(o).toVar();return X(.982,e)}),er=be([Zi,Qi]),xe=T(([o,e])=>{const t=d(e).toVar(),s=A(o).toVar();return s.shiftLeft(t).bitOr(s.shiftRight(d(32).sub(t)))}),tr=T(([o,e,t])=>{o.subAssign(t),o.bitXorAssign(xe(t,d(4))),t.addAssign(e),e.subAssign(o),e.bitXorAssign(xe(o,d(6))),o.addAssign(t),t.subAssign(e),t.bitXorAssign(xe(e,d(8))),e.addAssign(o),o.subAssign(t),o.bitXorAssign(xe(t,d(16))),t.addAssign(e),e.subAssign(o),e.bitXorAssign(xe(o,d(19))),o.addAssign(t),t.subAssign(e),t.bitXorAssign(xe(e,d(4))),e.addAssign(o)}),_t=T(([o,e,t])=>{const s=A(t).toVar(),n=A(e).toVar(),i=A(o).toVar();return s.bitXorAssign(n),s.subAssign(xe(n,d(14))),i.bitXorAssign(s),i.subAssign(xe(s,d(11))),n.bitXorAssign(i),n.subAssign(xe(i,d(25))),s.bitXorAssign(n),s.subAssign(xe(n,d(16))),i.bitXorAssign(s),i.subAssign(xe(s,d(4))),n.bitXorAssign(i),n.subAssign(xe(i,d(14))),s.bitXorAssign(n),s.subAssign(xe(n,d(24))),s}),me=T(([o])=>{const e=A(o).toVar();return h(e).div(h(A(d(4294967295))))}),Fe=T(([o])=>{const e=h(o).toVar();return e.mul(e.mul(e.mul(e.mul(e.mul(6).sub(15)).add(10))))}),sr=T(([o])=>{const e=d(o).toVar(),t=A(A(1)).toVar(),s=A(A(d(3735928559)).add(t.shiftLeft(A(2)).add(A(13)))).toVar();return _t(s.add(A(e)),s,s)}),or=T(([o,e])=>{const t=d(e).toVar(),s=d(o).toVar(),n=A(A(2)).toVar(),i=A().toVar(),r=A().toVar(),a=A().toVar();return i.assign(r.assign(a.assign(A(d(3735928559)).add(n.shiftLeft(A(2)).add(A(13)))))),i.addAssign(A(s)),r.addAssign(A(t)),_t(i,r,a)}),nr=T(([o,e,t])=>{const s=d(t).toVar(),n=d(e).toVar(),i=d(o).toVar(),r=A(A(3)).toVar(),a=A().toVar(),c=A().toVar(),u=A().toVar();return a.assign(c.assign(u.assign(A(d(3735928559)).add(r.shiftLeft(A(2)).add(A(13)))))),a.addAssign(A(i)),c.addAssign(A(n)),u.addAssign(A(s)),_t(a,c,u)}),ir=T(([o,e,t,s])=>{const n=d(s).toVar(),i=d(t).toVar(),r=d(e).toVar(),a=d(o).toVar(),c=A(A(4)).toVar(),u=A().toVar(),l=A().toVar(),p=A().toVar();return u.assign(l.assign(p.assign(A(d(3735928559)).add(c.shiftLeft(A(2)).add(A(13)))))),u.addAssign(A(a)),l.addAssign(A(r)),p.addAssign(A(i)),tr(u,l,p),u.addAssign(A(n)),_t(u,l,p)}),rr=T(([o,e,t,s,n])=>{const i=d(n).toVar(),r=d(s).toVar(),a=d(t).toVar(),c=d(e).toVar(),u=d(o).toVar(),l=A(A(5)).toVar(),p=A().toVar(),f=A().toVar(),v=A().toVar();return p.assign(f.assign(v.assign(A(d(3735928559)).add(l.shiftLeft(A(2)).add(A(13)))))),p.addAssign(A(u)),f.addAssign(A(c)),v.addAssign(A(a)),tr(p,f,v),p.addAssign(A(r)),f.addAssign(A(i)),_t(p,f,v)}),B=be([sr,or,nr,ir,rr]),ar=T(([o,e])=>{const t=d(e).toVar(),s=d(o).toVar(),n=A(B(s,t)).toVar(),i=zt().toVar();return i.x.assign(n.bitAnd(d(255))),i.y.assign(n.shiftRight(d(8)).bitAnd(d(255))),i.z.assign(n.shiftRight(d(16)).bitAnd(d(255))),i}),cr=T(([o,e,t])=>{const s=d(t).toVar(),n=d(e).toVar(),i=d(o).toVar(),r=A(B(i,n,s)).toVar(),a=zt().toVar();return a.x.assign(r.bitAnd(d(255))),a.y.assign(r.shiftRight(d(8)).bitAnd(d(255))),a.z.assign(r.shiftRight(d(16)).bitAnd(d(255))),a}),we=be([ar,cr]),ur=T(([o])=>{const e=L(o).toVar(),t=d().toVar(),s=d().toVar(),n=h(k(e.x,t)).toVar(),i=h(k(e.y,s)).toVar(),r=h(Fe(n)).toVar(),a=h(Fe(i)).toVar(),c=h(Gi(ae(B(t,s),n,i),ae(B(t.add(d(1)),s),n.sub(1),i),ae(B(t,s.add(d(1))),n,i.sub(1)),ae(B(t.add(d(1)),s.add(d(1))),n.sub(1),i.sub(1)),r,a)).toVar();return Ki(c)}),lr=T(([o])=>{const e=y(o).toVar(),t=d().toVar(),s=d().toVar(),n=d().toVar(),i=h(k(e.x,t)).toVar(),r=h(k(e.y,s)).toVar(),a=h(k(e.z,n)).toVar(),c=h(Fe(i)).toVar(),u=h(Fe(r)).toVar(),l=h(Fe(a)).toVar(),p=h(Hi(ae(B(t,s,n),i,r,a),ae(B(t.add(d(1)),s,n),i.sub(1),r,a),ae(B(t,s.add(d(1)),n),i,r.sub(1),a),ae(B(t.add(d(1)),s.add(d(1)),n),i.sub(1),r.sub(1),a),ae(B(t,s,n.add(d(1))),i,r,a.sub(1)),ae(B(t.add(d(1)),s,n.add(d(1))),i.sub(1),r,a.sub(1)),ae(B(t,s.add(d(1)),n.add(d(1))),i,r.sub(1),a.sub(1)),ae(B(t.add(d(1)),s.add(d(1)),n.add(d(1))),i.sub(1),r.sub(1),a.sub(1)),c,u,l)).toVar();return er(p)}),Hd=be([ur,lr]),dr=T(([o])=>{const e=L(o).toVar(),t=d().toVar(),s=d().toVar(),n=h(k(e.x,t)).toVar(),i=h(k(e.y,s)).toVar(),r=h(Fe(n)).toVar(),a=h(Fe(i)).toVar(),c=y(Gi(Me(we(t,s),n,i),Me(we(t.add(d(1)),s),n.sub(1),i),Me(we(t,s.add(d(1))),n,i.sub(1)),Me(we(t.add(d(1)),s.add(d(1))),n.sub(1),i.sub(1)),r,a)).toVar();return Ki(c)}),hr=T(([o])=>{const e=y(o).toVar(),t=d().toVar(),s=d().toVar(),n=d().toVar(),i=h(k(e.x,t)).toVar(),r=h(k(e.y,s)).toVar(),a=h(k(e.z,n)).toVar(),c=h(Fe(i)).toVar(),u=h(Fe(r)).toVar(),l=h(Fe(a)).toVar(),p=y(Hi(Me(we(t,s,n),i,r,a),Me(we(t.add(d(1)),s,n),i.sub(1),r,a),Me(we(t,s.add(d(1)),n),i,r.sub(1),a),Me(we(t.add(d(1)),s.add(d(1)),n),i.sub(1),r.sub(1),a),Me(we(t,s,n.add(d(1))),i,r,a.sub(1)),Me(we(t.add(d(1)),s,n.add(d(1))),i.sub(1),r,a.sub(1)),Me(we(t,s.add(d(1)),n.add(d(1))),i,r.sub(1),a.sub(1)),Me(we(t.add(d(1)),s.add(d(1)),n.add(d(1))),i.sub(1),r.sub(1),a.sub(1)),c,u,l)).toVar();return er(p)}),$d=be([dr,hr]),Xd=T(([o])=>{const e=h(o).toVar(),t=d(q(e)).toVar();return me(B(t))}),qd=T(([o])=>{const e=L(o).toVar(),t=d(q(e.x)).toVar(),s=d(q(e.y)).toVar();return me(B(t,s))}),jd=T(([o])=>{const e=y(o).toVar(),t=d(q(e.x)).toVar(),s=d(q(e.y)).toVar(),n=d(q(e.z)).toVar();return me(B(t,s,n))}),Yd=T(([o])=>{const e=P(o).toVar(),t=d(q(e.x)).toVar(),s=d(q(e.y)).toVar(),n=d(q(e.z)).toVar(),i=d(q(e.w)).toVar();return me(B(t,s,n,i))}),pr=T(([o])=>{const e=h(o).toVar(),t=d(q(e)).toVar();return y(me(B(t,d(0))),me(B(t,d(1))),me(B(t,d(2))))}),mr=T(([o])=>{const e=L(o).toVar(),t=d(q(e.x)).toVar(),s=d(q(e.y)).toVar();return y(me(B(t,s,d(0))),me(B(t,s,d(1))),me(B(t,s,d(2))))}),fr=T(([o])=>{const e=y(o).toVar(),t=d(q(e.x)).toVar(),s=d(q(e.y)).toVar(),n=d(q(e.z)).toVar();return y(me(B(t,s,n,d(0))),me(B(t,s,n,d(1))),me(B(t,s,n,d(2))))}),gr=T(([o])=>{const e=P(o).toVar(),t=d(q(e.x)).toVar(),s=d(q(e.y)).toVar(),n=d(q(e.z)).toVar(),i=d(q(e.w)).toVar();return y(me(B(t,s,n,i,d(0))),me(B(t,s,n,i,d(1))),me(B(t,s,n,i,d(2))))}),Nr=be([pr,mr,fr,gr]),Qt=T(([o,e,t,s])=>{const n=h(s).toVar(),i=h(t).toVar(),r=d(e).toVar(),a=y(o).toVar(),c=h(0).toVar(),u=h(1).toVar();return le({start:d(0),end:r},({i:l})=>{c.addAssign(u.mul(Hd(a))),u.mulAssign(n),a.mulAssign(i)}),c}),yr=T(([o,e,t,s])=>{const n=h(s).toVar(),i=h(t).toVar(),r=d(e).toVar(),a=y(o).toVar(),c=y(0).toVar(),u=h(1).toVar();return le({start:d(0),end:r},({i:l})=>{c.addAssign(u.mul($d(a))),u.mulAssign(n),a.mulAssign(i)}),c}),Zd=T(([o,e,t,s])=>{const n=h(s).toVar(),i=h(t).toVar(),r=d(e).toVar(),a=y(o).toVar();return L(Qt(a,r,i,n),Qt(a.add(y(d(19),d(193),d(17))),r,i,n))}),Jd=T(([o,e,t,s])=>{const n=h(s).toVar(),i=h(t).toVar(),r=d(e).toVar(),a=y(o).toVar(),c=y(yr(a,r,i,n)).toVar(),u=h(Qt(a.add(y(d(19),d(193),d(17))),r,i,n)).toVar();return P(c,u)}),xr=T(([o,e,t,s,n,i,r])=>{const a=d(r).toVar(),c=h(i).toVar(),u=d(n).toVar(),l=d(s).toVar(),p=d(t).toVar(),f=d(e).toVar(),v=L(o).toVar(),_=y(Nr(L(f.add(l),p.add(u)))).toVar(),M=L(_.x,_.y).toVar();M.subAssign(.5),M.mulAssign(c),M.addAssign(.5);const O=L(L(h(f),h(p)).add(M)).toVar(),R=L(O.sub(v)).toVar();return W(a.equal(d(2)),()=>Ee(R.x).add(Ee(R.y))),W(a.equal(d(3)),()=>ot(Ee(R.x),Ee(R.y))),Pt(R,R)}),Tr=T(([o,e,t,s,n,i,r,a,c])=>{const u=d(c).toVar(),l=h(a).toVar(),p=d(r).toVar(),f=d(i).toVar(),v=d(n).toVar(),_=d(s).toVar(),M=d(t).toVar(),O=d(e).toVar(),R=y(o).toVar(),b=y(Nr(y(O.add(v),M.add(f),_.add(p)))).toVar();b.subAssign(.5),b.mulAssign(l),b.addAssign(.5);const C=y(y(h(O),h(M),h(_)).add(b)).toVar(),D=y(C.sub(R)).toVar();return W(u.equal(d(2)),()=>Ee(D.x).add(Ee(D.y).add(Ee(D.z)))),W(u.equal(d(3)),()=>ot(ot(Ee(D.x),Ee(D.y)),Ee(D.z))),Pt(D,D)}),Vt=be([xr,Tr]),Kd=T(([o,e,t])=>{const s=d(t).toVar(),n=h(e).toVar(),i=L(o).toVar(),r=d().toVar(),a=d().toVar(),c=L(k(i.x,r),k(i.y,a)).toVar(),u=h(1e6).toVar();return le({start:-1,end:d(1),name:"x",condition:"<="},({x:l})=>{le({start:-1,end:d(1),name:"y",condition:"<="},({y:p})=>{const f=h(Vt(c,l,p,r,a,n,s)).toVar();u.assign(It(u,f))})}),W(s.equal(d(0)),()=>{u.assign(ct(u))}),u}),Qd=T(([o,e,t])=>{const s=d(t).toVar(),n=h(e).toVar(),i=L(o).toVar(),r=d().toVar(),a=d().toVar(),c=L(k(i.x,r),k(i.y,a)).toVar(),u=L(1e6,1e6).toVar();return le({start:-1,end:d(1),name:"x",condition:"<="},({x:l})=>{le({start:-1,end:d(1),name:"y",condition:"<="},({y:p})=>{const f=h(Vt(c,l,p,r,a,n,s)).toVar();W(f.lessThan(u.x),()=>{u.y.assign(u.x),u.x.assign(f)}).elseif(f.lessThan(u.y),()=>{u.y.assign(f)})})}),W(s.equal(d(0)),()=>{u.assign(ct(u))}),u}),eh=T(([o,e,t])=>{const s=d(t).toVar(),n=h(e).toVar(),i=L(o).toVar(),r=d().toVar(),a=d().toVar(),c=L(k(i.x,r),k(i.y,a)).toVar(),u=y(1e6,1e6,1e6).toVar();return le({start:-1,end:d(1),name:"x",condition:"<="},({x:l})=>{le({start:-1,end:d(1),name:"y",condition:"<="},({y:p})=>{const f=h(Vt(c,l,p,r,a,n,s)).toVar();W(f.lessThan(u.x),()=>{u.z.assign(u.y),u.y.assign(u.x),u.x.assign(f)}).elseif(f.lessThan(u.y),()=>{u.z.assign(u.y),u.y.assign(f)}).elseif(f.lessThan(u.z),()=>{u.z.assign(f)})})}),W(s.equal(d(0)),()=>{u.assign(ct(u))}),u}),th=T(([o,e,t])=>{const s=d(t).toVar(),n=h(e).toVar(),i=y(o).toVar(),r=d().toVar(),a=d().toVar(),c=d().toVar(),u=y(k(i.x,r),k(i.y,a),k(i.z,c)).toVar(),l=h(1e6).toVar();return le({start:-1,end:d(1),name:"x",condition:"<="},({x:p})=>{le({start:-1,end:d(1),name:"y",condition:"<="},({y:f})=>{le({start:-1,end:d(1),name:"z",condition:"<="},({z:v})=>{const _=h(Vt(u,p,f,v,r,a,c,n,s)).toVar();l.assign(It(l,_))})})}),W(s.equal(d(0)),()=>{l.assign(ct(l))}),l}),sh=T(([o,e,t])=>{const s=d(t).toVar(),n=h(e).toVar(),i=y(o).toVar(),r=d().toVar(),a=d().toVar(),c=d().toVar(),u=y(k(i.x,r),k(i.y,a),k(i.z,c)).toVar(),l=L(1e6,1e6).toVar();return le({start:-1,end:d(1),name:"x",condition:"<="},({x:p})=>{le({start:-1,end:d(1),name:"y",condition:"<="},({y:f})=>{le({start:-1,end:d(1),name:"z",condition:"<="},({z:v})=>{const _=h(Vt(u,p,f,v,r,a,c,n,s)).toVar();W(_.lessThan(l.x),()=>{l.y.assign(l.x),l.x.assign(_)}).elseif(_.lessThan(l.y),()=>{l.y.assign(_)})})})}),W(s.equal(d(0)),()=>{l.assign(ct(l))}),l}),oh=T(([o,e,t])=>{const s=d(t).toVar(),n=h(e).toVar(),i=y(o).toVar(),r=d().toVar(),a=d().toVar(),c=d().toVar(),u=y(k(i.x,r),k(i.y,a),k(i.z,c)).toVar(),l=y(1e6,1e6,1e6).toVar();return le({start:-1,end:d(1),name:"x",condition:"<="},({x:p})=>{le({start:-1,end:d(1),name:"y",condition:"<="},({y:f})=>{le({start:-1,end:d(1),name:"z",condition:"<="},({z:v})=>{const _=h(Vt(u,p,f,v,r,a,c,n,s)).toVar();W(_.lessThan(l.x),()=>{l.z.assign(l.y),l.y.assign(l.x),l.x.assign(_)}).elseif(_.lessThan(l.y),()=>{l.z.assign(l.y),l.y.assign(_)}).elseif(_.lessThan(l.z),()=>{l.z.assign(_)})})})}),W(s.equal(d(0)),()=>{l.assign(ct(l))}),l});Nt.setLayout({name:"mx_select",type:"float",inputs:[{name:"b",type:"bool"},{name:"t",type:"float"},{name:"f",type:"float"}]});Dt.setLayout({name:"mx_negate_if",type:"float",inputs:[{name:"val",type:"float"},{name:"b",type:"bool"}]});q.setLayout({name:"mx_floor",type:"int",inputs:[{name:"x",type:"float"}]});Ui.setLayout({name:"mx_bilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"}]});Bi.setLayout({name:"mx_bilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"}]});Wi.setLayout({name:"mx_trilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"v4",type:"float"},{name:"v5",type:"float"},{name:"v6",type:"float"},{name:"v7",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]});ki.setLayout({name:"mx_trilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"v4",type:"vec3"},{name:"v5",type:"vec3"},{name:"v6",type:"vec3"},{name:"v7",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]});$i.setLayout({name:"mx_gradient_float_0",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"}]});Xi.setLayout({name:"mx_gradient_float_1",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]});qi.setLayout({name:"mx_gradient_vec3_0",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"}]});ji.setLayout({name:"mx_gradient_vec3_1",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]});Yi.setLayout({name:"mx_gradient_scale2d_0",type:"float",inputs:[{name:"v",type:"float"}]});Zi.setLayout({name:"mx_gradient_scale3d_0",type:"float",inputs:[{name:"v",type:"float"}]});Ji.setLayout({name:"mx_gradient_scale2d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]});Qi.setLayout({name:"mx_gradient_scale3d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]});xe.setLayout({name:"mx_rotl32",type:"uint",inputs:[{name:"x",type:"uint"},{name:"k",type:"int"}]});_t.setLayout({name:"mx_bjfinal",type:"uint",inputs:[{name:"a",type:"uint"},{name:"b",type:"uint"},{name:"c",type:"uint"}]});me.setLayout({name:"mx_bits_to_01",type:"float",inputs:[{name:"bits",type:"uint"}]});Fe.setLayout({name:"mx_fade",type:"float",inputs:[{name:"t",type:"float"}]});sr.setLayout({name:"mx_hash_int_0",type:"uint",inputs:[{name:"x",type:"int"}]});or.setLayout({name:"mx_hash_int_1",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]});nr.setLayout({name:"mx_hash_int_2",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]});ir.setLayout({name:"mx_hash_int_3",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"}]});rr.setLayout({name:"mx_hash_int_4",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"},{name:"yy",type:"int"}]});ar.setLayout({name:"mx_hash_vec3_0",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]});cr.setLayout({name:"mx_hash_vec3_1",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]});ur.setLayout({name:"mx_perlin_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"}]});lr.setLayout({name:"mx_perlin_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"}]});dr.setLayout({name:"mx_perlin_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"}]});hr.setLayout({name:"mx_perlin_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"}]});Xd.setLayout({name:"mx_cell_noise_float_0",type:"float",inputs:[{name:"p",type:"float"}]});qd.setLayout({name:"mx_cell_noise_float_1",type:"float",inputs:[{name:"p",type:"vec2"}]});jd.setLayout({name:"mx_cell_noise_float_2",type:"float",inputs:[{name:"p",type:"vec3"}]});Yd.setLayout({name:"mx_cell_noise_float_3",type:"float",inputs:[{name:"p",type:"vec4"}]});pr.setLayout({name:"mx_cell_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"float"}]});mr.setLayout({name:"mx_cell_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec2"}]});fr.setLayout({name:"mx_cell_noise_vec3_2",type:"vec3",inputs:[{name:"p",type:"vec3"}]});gr.setLayout({name:"mx_cell_noise_vec3_3",type:"vec3",inputs:[{name:"p",type:"vec4"}]});Qt.setLayout({name:"mx_fractal_noise_float",type:"float",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]});yr.setLayout({name:"mx_fractal_noise_vec3",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]});Zd.setLayout({name:"mx_fractal_noise_vec2",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]});Jd.setLayout({name:"mx_fractal_noise_vec4",type:"vec4",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]});xr.setLayout({name:"mx_worley_distance_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});Tr.setLayout({name:"mx_worley_distance_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"zoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});Kd.setLayout({name:"mx_worley_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});Qd.setLayout({name:"mx_worley_noise_vec2_0",type:"vec2",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});eh.setLayout({name:"mx_worley_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});th.setLayout({name:"mx_worley_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});sh.setLayout({name:"mx_worley_noise_vec2_1",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});oh.setLayout({name:"mx_worley_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});const nh=T(([o])=>{const e=y(o).toVar(),t=h(e.x).toVar(),s=h(e.y).toVar(),n=h(e.z).toVar();W(s.lessThan(1e-4),()=>y(n,n,n)).else(()=>{t.assign(X(6,t.sub(Ft(t))));const i=d(gn(t)).toVar(),r=h(t.sub(h(i))).toVar(),a=h(n.mul(he(1,s))).toVar(),c=h(n.mul(he(1,s.mul(r)))).toVar(),u=h(n.mul(he(1,s.mul(he(1,r))))).toVar();return W(i.equal(d(0)),()=>y(n,u,a)).elseif(i.equal(d(1)),()=>y(c,n,a)).elseif(i.equal(d(2)),()=>y(a,n,u)).elseif(i.equal(d(3)),()=>y(a,c,n)).elseif(i.equal(d(4)),()=>y(u,a,n)),y(n,a,c)})}),ih=T(([o])=>{const e=y(o).toVar(),t=h(e.x).toVar(),s=h(e.y).toVar(),n=h(e.z).toVar(),i=h(It(t,It(s,n))).toVar(),r=h(ot(t,ot(s,n))).toVar(),a=h(r.sub(i)).toVar(),c=h().toVar(),u=h().toVar(),l=h().toVar();return l.assign(r),W(r.greaterThan(0),()=>{u.assign(a.div(r))}).else(()=>{u.assign(0)}),W(u.lessThanEqual(0),()=>{c.assign(0)}).else(()=>{W(t.greaterThanEqual(r),()=>{c.assign(s.sub(n).div(a))}).elseif(s.greaterThanEqual(r),()=>{c.assign(Le(2,n.sub(t).div(a)))}).else(()=>{c.assign(Le(4,t.sub(s).div(a)))}),c.mulAssign(1/6),W(c.lessThan(0),()=>{c.addAssign(1)})}),y(c,u,l)});nh.setLayout({name:"mx_hsvtorgb",type:"vec3",inputs:[{name:"hsv",type:"vec3"}]});ih.setLayout({name:"mx_rgbtohsv",type:"vec3",inputs:[{name:"c",type:"vec3"}]});const rh=T(([o])=>{const e=y(o).toVar(),t=Jo(pn(e,y(.04045))).toVar(),s=y(e.div(12.92)).toVar(),n=y(Zs(ot(e.add(y(.055)),y(0)).div(1.055),y(2.4))).toVar();return Ge(s,n,t)});rh.setLayout({name:"mx_srgb_texture_to_lin_rec709",type:"vec3",inputs:[{name:"color",type:"vec3"}]});te.registerPlugin(_r,ScrollSmoother);window.addEventListener("load",()=>{const o=ScrollSmoother.create({smooth:1,effects:!0,normalizeScroll:!0,speed:.8,onUpdate:()=>{typeof window.onSmootherUpdate=="function"&&window.onSmootherUpdate()}});window.smoother=o,location.hash&&o.scrollTo(location.hash,!0,"top top"),matchMedia("screen and (min-width: 1100px)").matches&&te.utils.toArray(".project-item__right").forEach(e=>{let t=te.timeline().to(e.querySelectorAll([".project-item__img img"]),{scale:1.2,filter:"blur(20px)",ease:"power3.inOut",duration:1.5},0).to(e.querySelectorAll([".bg-mask"]),{autoAlpha:.7,ease:"power3.inOut",duration:1.5},0).to(e.querySelectorAll([".home_rollover_image_1 img"]),{xPercent:-100,ease:"power3.inOut"},.5).fromTo(e.querySelectorAll([".home_rollover_image_2"]),{left:"110%"},{left:0,ease:"power3.inOut"},.5).fromTo(e.querySelectorAll([".home_rollover_image_2 img"]),{scale:1.3,filter:"blur(20px)",autoAlpha:1,ease:"power3.inOut"},{scale:1,filter:"blur(0px)",autoAlpha:1,ease:"power3.inOut",duration:1.5},.5).to(e.querySelectorAll([".bg-bg-mask-2"]),{autoAlpha:0,ease:"power3.inOut",duration:1.5},.5).pause();const s=e.closest(".project-item__right");s.addEventListener("mouseenter",()=>{t.play()}),s.addEventListener("mouseleave",()=>{t.reverse()})})});window.addEventListener("load",()=>{var o;return(o=smoother==null?void 0:smoother.get())==null?void 0:o.refresh(!0)});window.MOTIONPAGE_FRONT={version:"2.1.6"};window.MOTIONPAGE_FRONT.mouse={pos:{x:0,y:0},isWithinTarget(o){return this.pos.x>=o.left&&this.pos.x<=o.right&&this.pos.y>=o.top&&this.pos.y<=o.bottom},posWithinTarget(o,e,t){let s=typeof e=="string"?document.querySelector(e):e;if(!s)return{v:-1};let n=s.getBoundingClientRect();return this.isWithinTarget(n)?{v:(this.pos[o]-n[o==="x"?"left":"top"])/n[o==="x"?"width":"height"],wt:!0}:{v:t,wt:!1}},scrollbarWidth:-1,getScrollbarWidth(){if(this.scrollbarWidth!==-1)return this.scrollbarWidth;let o=document.createElement("div");o.style.overflow="scroll",document.body.appendChild(o);let e=o.offsetWidth-o.clientWidth;return document.body.removeChild(o),this.scrollbarWidth=e+1,e},distance(o){let e=typeof o=="string"?document.querySelector(o):o;if(!e)return-1;let t=e.getBoundingClientRect();if(!t||!this.isWithinTarget(t))return-1;let s=t.left+t.width/2,n=t.top+scrollY+t.height/2,i=Math.sqrt(Math.pow(this.pos.x-s,2)+Math.pow(this.pos.y+scrollY-n,2)),r=Math.sqrt(Math.pow(innerWidth/2,2)+Math.pow(innerHeight/2,2));return 1-i/r},smoothEnter(o,e,t,s){te.ticker.remove(o),e.tweenFromTo(e.time(),e.totalDuration()*t,{onComplete(){te.ticker.add(o)},duration:s/1e3,ease:"none"})},smoothLeave(o,e){o.progress<e.progress()?te.to(e,o):e.tweenTo(o.progress,o)}};document.body.addEventListener("mousemove",o=>{window.MOTIONPAGE_FRONT.mouse&&(window.MOTIONPAGE_FRONT.mouse.pos={x:o.clientX,y:o.clientY})});document.addEventListener("DOMContentLoaded",function(){const o=document.querySelector("#dh_cursor"),e=o.querySelector(".dh_cursor__circle"),t={x:-100,y:-100},s={x:0,y:0},n=.2,i=p=>{t.x=p.clientX,t.y=p.clientY};window.addEventListener("mousemove",i);function r(p,f){return Math.atan2(f,p)*180/Math.PI}function a(p,f){const v=Math.sqrt(Math.pow(p,2)+Math.pow(f,2));return Math.min(v/1500,.15)}const c=()=>{const p=Math.round(t.x-s.x),f=Math.round(t.y-s.y);s.x+=p*n,s.y+=f*n;const v=r(p,f),_=a(p,f),M="scale("+(1+_)+", "+(1-_)+")",O="rotate("+v+"deg)",R="translate3d("+s.x+"px ,"+s.y+"px, 0)";o.style.transform=R,e.style.transform=O+M};function u(){c(),requestAnimationFrame(u)}requestAnimationFrame(u),document.querySelectorAll("[cursor-class]").forEach(p=>{p.addEventListener("mouseenter",function(){const f=this.getAttribute("cursor-class");o.classList.add(f)}),p.addEventListener("mouseleave",function(){const f=this.getAttribute("cursor-class");o.classList.remove(f)})})});window.addEventListener("load",()=>{te.context(()=>{te.timeline().to(".hey-content",{scale:.8,ease:"sine.inOut",duration:4}).fromTo(".hey_shadow_wrapper",{filter:"blur(5px)",autoAlpha:.3,y:"7vh"},{scale:.75,filter:"blur(0px)",autoAlpha:.8,y:"0vh",ease:"sine.inOut",duration:4},0).to(".section-content",{"padding-top":"5svh",duration:4}).yoyo(!0).repeat(-1)}),te.context(()=>{te.timeline().fromTo(".bg-color",{background:"linear-gradient(180deg, rgba(216,0,255,1) 0%, rgba(0,33,255,1) 100%)"},{background:"linear-gradient(180deg, rgba(91,0,255,1) 0%, rgba(0,215,214,1) 100%)",duration:5},0).yoyo(!0).repeat(-1)}),window._$W=window,matchMedia("screen and (min-width: 1100px)").matches&&(te.context(()=>{te.timeline().set(".dh_transition_scale_wrapper",{autoAlpha:1}).to(".progress_bar",{ease:"power1",width:"1px",height:"calc(100vh - 400px)"},1.7).to(".progress_bar",{autoAlpha:1,display:"none",duration:.1},3).fromTo(".progress_bar",{width:"20px",height:"20px"},{ease:"power1",width:"1px",height:"1px","border-radius":0,duration:.7},1).fromTo(".progress_bar",{x:"50vw",ease:"power4.inOut"},{autoAlpha:1,x:"0vw",duration:.9},.1).to("#dh_preloader",{display:"none",duration:.1},0).to(".curtain_left",{transformOrigin:"0% 50%",width:"0px",ease:"power4.inOut",duration:1.5},2.6).to(".curtain_right",{transformOrigin:"100% 50%",width:"0px",ease:"power4.inOut",duration:1.5},2.6).to(".dh_home_transitions",{display:"none",duration:.1},4.1).from(".dh_transition_scale_wrapper",{width:"calc(100vw - 400px)",height:"calc(100vh - 400px)",margin:"200px","border-radius":"10px",ease:"power3.inOut",duration:.8},4.8).from(".section-1",{scale:.87,transformOrigin:"55% 33%",ease:"power3.inOut",duration:.8},4.8).to(".dh_transition_scale_wrapper",{autoAlpha:0,duration:.1},5.6).to(".dh_home_transitions",{background:"rgba(0, 0, 0, 0)",duration:.1},0).to(".hey_3d_animation",{ease:"power3.inOut",onUpdate:function(){this._targets.map(({_lottie:o})=>{o&&o.goToAndStop(this.progress()*o.totalFrames,!0)})}},3.9)}),te.context(()=>{function o(){_$W.tl.progress(_$W.MOTIONPAGE_FRONT.mouse.pos.x/(_$W.innerWidth-_$W.MOTIONPAGE_FRONT.mouse.getScrollbarWidth()))}function e(){_$W.tl2.progress(_$W.MOTIONPAGE_FRONT.mouse.pos.y/_$W.innerHeight)}return _$W.tl=te.timeline().fromTo(".section-content",{rotationX:0,rotationY:0,rotationZ:0,xPercent:0,yPercent:0},{rotationX:10,rotationY:10,rotationZ:10,xPercent:15,yPercent:0},0).fromTo(".hey_shadow",{rotationX:0,rotationY:0,rotationZ:0,autoAlpha:1,xPercent:0,yPercent:0,scaleX:1},{rotationX:-2,rotationY:-2,rotationZ:-2,autoAlpha:.6,xPercent:-10,yPercent:5,scaleX:.8},0),_$W.tl2=te.timeline().fromTo(".section-content",{scale:1,skewX:"0deg"},{scale:1.1,skewX:"20deg"},0),te.ticker.add(o),te.ticker.add(e),()=>{te.ticker.remove(o),te.ticker.remove(e)}}))});

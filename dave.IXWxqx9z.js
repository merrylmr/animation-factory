import"./chunk.9p4a8sJU.js";import{g as ye}from"./chunk.FSCrshNh.js";import{C as Ds,V as qe,a as Et,b as wt,M as _r,c as Vr,E as On,d as bn,L as es,S as Sr,e as Mr,I as Er,f as Ar,D as Dn,g as Rr,h as wr,F as zn,i as zs,N as cn,j as Lr,W as Cr,k as Fn,l as Ir,m as Or,U as br,n as Dr,o as zr,p as Fr,q as Pr,T as un,O as Ur,r as Vs,s as Br,R as Gr,t as Wr,A as kr,u as Hr,v as $r,B as Xr,w as ln,x as Ss,H as qr,P as jr,y as Yr,z as Pn,G as Jr,J as Zr,K as Un,Q as Kr,X as Bn,Y as Qr,Z as ea,_ as ta,$ as sa,a0 as na,a1 as oa,a2 as ia}from"./chunk.uVdaq5N5.js";const dn={VERTEX:"vertex",FRAGMENT:"fragment"},Q={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},Fs=["x","y","z","w"];function Gn(n){let e="{";n.isNode===!0&&(e+=n.id);for(const{property:t,childNode:s}of Ht(n))e+=","+t.slice(0,-4)+":"+s.getCacheKey();return e+="}",e}function*Ht(n,e=!1){for(const t in n){if(t.startsWith("_")===!0)continue;const s=n[t];if(Array.isArray(s)===!0)for(let o=0;o<s.length;o++){const i=s[o];i&&(i.isNode===!0||e&&typeof i.toJSON=="function")&&(yield{property:t,index:o,childNode:i})}else if(s&&s.isNode===!0)yield{property:t,childNode:s};else if(typeof s=="object")for(const o in s){const i=s[o];i&&(i.isNode===!0||e&&typeof i.toJSON=="function")&&(yield{property:t,index:o,childNode:i})}}}function tt(n){if(n==null)return null;const e=typeof n;return n.isNode===!0?"node":e==="number"?"float":e==="boolean"?"bool":e==="string"?"string":e==="function"?"shader":n.isVector2===!0?"vec2":n.isVector3===!0?"vec3":n.isVector4===!0?"vec4":n.isMatrix3===!0?"mat3":n.isMatrix4===!0?"mat4":n.isColor===!0?"color":n instanceof ArrayBuffer?"ArrayBuffer":null}function Wn(n,...e){const t=n?n.slice(-4):void 0;return e.length===1&&(t==="vec2"?e=[e[0],e[0]]:t==="vec3"?e=[e[0],e[0],e[0]]:t==="vec4"&&(e=[e[0],e[0],e[0],e[0]])),n==="color"?new Ds(...e):t==="vec2"?new qe(...e):t==="vec3"?new Et(...e):t==="vec4"?new wt(...e):t==="mat3"?new _r(...e):t==="mat4"?new Vr(...e):n==="bool"?e[0]||!1:n==="float"||n==="int"||n==="uint"?e[0]||0:n==="string"?e[0]||"":n==="ArrayBuffer"?Hn(e[0]):null}function kn(n){let e="";const t=new Uint8Array(n);for(let s=0;s<t.length;s++)e+=String.fromCharCode(t[s]);return btoa(e)}function Hn(n){return Uint8Array.from(atob(n),e=>e.charCodeAt(0)).buffer}const hn=new Map;let ra=0;class R extends On{constructor(e=null){super(),this.nodeType=e,this.updateType=Q.NONE,this.updateBeforeType=Q.NONE,this.uuid=bn.generateUUID(),this.isNode=!0,Object.defineProperty(this,"id",{value:ra++})}get type(){return this.constructor.type}getSelf(){return this.self||this}updateReference(){return this}isGlobal(){return!1}*getChildren(){for(const{childNode:e}of Ht(this))yield e}dispose(){this.dispatchEvent({type:"dispose"})}traverse(e){e(this);for(const t of this.getChildren())t.traverse(e)}getCacheKey(){return Gn(this)}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getNodeType(e){const t=e.getNodeProperties(this);return t.outputNode?t.outputNode.getNodeType(e):this.nodeType}getShared(e){const t=this.getHash(e);return e.getNodeFromHash(t)||this}setup(e){const t=e.getNodeProperties(this);for(const s of this.getChildren())t["_node"+s.id]=s;return null}construct(e){return console.warn("THREE.Node: construct() is deprecated. Use setup() instead."),this.setup(e)}analyze(e){const t=e.getDataFromNode(this);if(t.dependenciesCount=t.dependenciesCount===void 0?1:t.dependenciesCount+1,t.dependenciesCount===1){const s=e.getNodeProperties(this);for(const o of Object.values(s))o&&o.isNode===!0&&o.build(e)}}generate(e,t){const{outputNode:s}=e.getNodeProperties(this);if(s&&s.isNode===!0)return s.build(e,t)}updateBefore(){console.warn("Abstract function.")}update(){console.warn("Abstract function.")}build(e,t=null){const s=this.getShared(e);if(this!==s)return s.build(e,t);e.addNode(this),e.addChain(this);let o=null;const i=e.getBuildStage();if(i==="setup"){const r=e.getNodeProperties(this);if(r.initialized!==!0||e.context.tempRead===!1){const a=e.stack.nodes.length;r.initialized=!0,r.outputNode=this.setup(e),r.outputNode!==null&&e.stack.nodes.length!==a&&(r.outputNode=e.stack);for(const c of Object.values(r))c&&c.isNode===!0&&c.build(e)}}else if(i==="analyze")this.analyze(e);else if(i==="generate")if(this.generate.length===1){const a=this.getNodeType(e),c=e.getDataFromNode(this);o=c.snippet,o===void 0&&(o=this.generate(e)||"",c.snippet=o),o=e.format(o,a,t)}else o=this.generate(e,t)||"";return e.removeChain(this),o}getSerializeChildren(){return Ht(this)}serialize(e){const t=this.getSerializeChildren(),s={};for(const{property:o,index:i,childNode:r}of t)i!==void 0?(s[o]===void 0&&(s[o]=Number.isInteger(i)?[]:{}),s[o][i]=r.toJSON(e.meta).uuid):s[o]=r.toJSON(e.meta).uuid;Object.keys(s).length>0&&(e.inputNodes=s)}deserialize(e){if(e.inputNodes!==void 0){const t=e.meta.nodes;for(const s in e.inputNodes)if(Array.isArray(e.inputNodes[s])){const o=[];for(const i of e.inputNodes[s])o.push(t[i]);this[s]=o}else if(typeof e.inputNodes[s]=="object"){const o={};for(const i in e.inputNodes[s]){const r=e.inputNodes[s][i];o[i]=t[r]}this[s]=o}else{const o=e.inputNodes[s];this[s]=t[o]}}}toJSON(e){const{uuid:t,type:s}=this,o=e===void 0||typeof e=="string";o&&(e={textures:{},images:{},nodes:{}});let i=e.nodes[t];i===void 0&&(i={uuid:t,type:s,meta:e,metadata:{version:4.6,type:"Node",generator:"Node.toJSON"}},o!==!0&&(e.nodes[i.uuid]=i),this.serialize(i),delete i.meta);function r(a){const c=[];for(const u in a){const l=a[u];delete l.metadata,c.push(l)}return c}if(o){const a=r(e.textures),c=r(e.images),u=r(e.nodes);a.length>0&&(i.textures=a),c.length>0&&(i.images=c),u.length>0&&(i.nodes=u)}return i}}function x(n,e){if(typeof e!="function"||!n)throw new Error(`Node class ${n} is not a class`);if(hn.has(n)){console.warn(`Redefinition of node class ${n}`);return}hn.set(n,e),e.type=n}class ts extends R{constructor(e,t=null){super(t),this.isInputNode=!0,this.value=e,this.precision=null}getNodeType(){return this.nodeType===null?tt(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}setPrecision(e){return this.precision=e,this}serialize(e){super.serialize(e),e.value=this.value,this.value&&this.value.toArray&&(e.value=this.value.toArray()),e.valueType=tt(this.value),e.nodeType=this.nodeType,e.valueType==="ArrayBuffer"&&(e.value=kn(e.value)),e.precision=this.precision}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=Array.isArray(e.value)?Wn(e.valueType,...e.value):e.value,this.precision=e.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(e.value))}generate(){console.warn("Abstract function.")}}x("InputNode",ts);class Ps extends R{constructor(e,t=!1){super("string"),this.name=e,this.version=0,this.shared=t,this.isUniformGroup=!0}set needsUpdate(e){e===!0&&this.version++}}const aa=n=>new Ps(n),$n=n=>new Ps(n,!0);$n("frame");$n("render");const ca=aa("object");x("UniformGroupNode",Ps);class Us extends R{constructor(e,t){super(),this.node=e,this.indexNode=t,this.isArrayElementNode=!0}getNodeType(e){return this.node.getNodeType(e)}generate(e){const t=this.node.build(e),s=this.indexNode.build(e,"uint");return`${t}[ ${s} ]`}}x("ArrayElementNode",Us);class Bs extends R{constructor(e,t){super(),this.node=e,this.convertTo=t}getNodeType(e){const t=this.node.getNodeType(e);let s=null;for(const o of this.convertTo.split("|"))(s===null||e.getTypeLength(t)===e.getTypeLength(o))&&(s=o);return s}serialize(e){super.serialize(e),e.convertTo=this.convertTo}deserialize(e){super.deserialize(e),this.convertTo=e.convertTo}generate(e,t){const s=this.node,o=this.getNodeType(e),i=s.build(e,o);return e.format(i,o,t)}}x("ConvertNode",Bs);class $ extends R{constructor(e){super(e),this.isTempNode=!0}hasDependencies(e){return e.getDataFromNode(this).dependenciesCount>1}build(e,t){if(e.getBuildStage()==="generate"){const o=e.getVectorType(this.getNodeType(e,t)),i=e.getDataFromNode(this);if(e.context.tempRead!==!1&&i.propertyName!==void 0)return e.format(i.propertyName,o,t);if(e.context.tempWrite!==!1&&o!=="void"&&t!=="void"&&this.hasDependencies(e)){const r=super.build(e,o),a=e.getVarFromNode(this,null,o),c=e.getPropertyName(a);return e.addLineFlowCode(`${c} = ${r}`),i.snippet=r,i.propertyName=c,e.format(i.propertyName,o,t)}}return super.build(e,t)}}x("TempNode",$);class Xn extends ${constructor(e=[],t=null){super(t),this.nodes=e}getNodeType(e){return this.nodeType!==null?e.getVectorType(this.nodeType):e.getTypeFromLength(this.nodes.reduce((t,s)=>t+e.getTypeLength(s.getNodeType(e)),0))}generate(e,t){const s=this.getNodeType(e),o=this.nodes,i=e.getPrimitiveType(s),r=[];for(const c of o){let u=c.build(e);const l=e.getPrimitiveType(c.getNodeType(e));l!==i&&(u=e.format(u,l,i)),r.push(u)}const a=`${e.getType(s)}( ${r.join(", ")} )`;return e.format(a,s,t)}}x("JoinNode",Xn);const ua=Fs.join("");class Ms extends R{constructor(e,t="x"){super(),this.node=e,this.components=t,this.isSplitNode=!0}getVectorLength(){let e=this.components.length;for(const t of this.components)e=Math.max(Fs.indexOf(t)+1,e);return e}getPrimitiveType(e){return e.getPrimitiveType(this.node.getNodeType(e))}getNodeType(e){return e.getTypeFromLength(this.components.length,this.getPrimitiveType(e))}generate(e,t){const s=this.node,o=e.getTypeLength(s.getNodeType(e));let i=null;if(o>1){let r=null;this.getVectorLength()>=o&&(r=e.getTypeFromLength(this.getVectorLength(),this.getPrimitiveType(e)));const c=s.build(e,r);this.components.length===o&&this.components===ua.slice(0,this.components.length)?i=e.format(c,r,t):i=e.format(`${c}.${this.components}`,this.getNodeType(e),t)}else i=s.build(e,t);return i}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}}x("SplitNode",Ms);class qn extends ${constructor(e,t,s){super(),this.sourceNode=e,this.components=t,this.targetNode=s}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{sourceNode:t,components:s,targetNode:o}=this,i=this.getNodeType(e),r=e.getTypeFromLength(s.length),a=o.build(e,r),c=t.build(e,i),u=e.getTypeLength(i),l=[];for(let p=0;p<u;p++){const f=Fs[p];f===s[0]?(l.push(a),p+=s.length-1):l.push(c+"."+f)}return`${e.getType(i)}( ${l.join(", ")} )`}}x("SetNode",qn);class Ie extends ts{constructor(e,t=null){super(e,t),this.isConstNode=!0}generateConst(e){return e.generateConst(this.getNodeType(e),this.value)}generate(e,t){const s=this.getNodeType(e);return e.format(this.generateConst(e),s,t)}}x("ConstNode",Ie);let yt=null;const dt=new Map;function g(n,e){if(dt.has(n)){console.warn(`Redefinition of node element ${n}`);return}if(typeof e!="function")throw new Error(`Node element ${n} is not a function`);dt.set(n,e)}const pn=n=>n.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),jn={setup(n,e){const t=e.shift();return n(os(t),...e)},get(n,e,t){if(typeof e=="string"&&n[e]===void 0){if(n.isStackNode!==!0&&e==="assign")return(...s)=>(yt.assign(t,...s),t);if(dt.has(e)){const s=dt.get(e);return n.isStackNode?(...o)=>t.add(s(...o)):(...o)=>s(t,...o)}else{if(e==="self")return n;if(e.endsWith("Assign")&&dt.has(e.slice(0,e.length-6))){const s=dt.get(e.slice(0,e.length-6));return n.isStackNode?(...o)=>t.assign(o[0],s(...o)):(...o)=>t.assign(s(t,...o))}else{if(/^[xyzwrgbastpq]{1,4}$/.test(e)===!0)return e=pn(e),A(new Ms(t,e));if(/^set[XYZWRGBASTPQ]{1,4}$/.test(e)===!0)return e=pn(e.slice(3).toLowerCase()),e=e.split("").sort().join(""),s=>A(new qn(n,e,s));if(e==="width"||e==="height"||e==="depth")return e==="width"?e="x":e==="height"?e="y":e==="depth"&&(e="z"),A(new Ms(n,e));if(/^\d+$/.test(e)===!0)return A(new Us(t,new Ie(Number(e),"uint")))}}}return Reflect.get(n,e,t)},set(n,e,t,s){return typeof e=="string"&&n[e]===void 0&&(/^[xyzwrgbastpq]{1,4}$/.test(e)===!0||e==="width"||e==="height"||e==="depth"||/^\d+$/.test(e)===!0)?(s[e].assign(t),!0):Reflect.set(n,e,t,s)}},ls=new WeakMap,mn=new WeakMap,la=function(n,e=null){const t=tt(n);if(t==="node"){let s=ls.get(n);return s===void 0&&(s=new Proxy(n,jn),ls.set(n,s),ls.set(s,s)),s}else{if(e===null&&(t==="float"||t==="boolean")||t&&t!=="shader"&&t!=="string")return A(Es(n,e));if(t==="shader")return T(n)}return n},da=function(n,e=null){for(const t in n)n[t]=A(n[t],e);return n},ha=function(n,e=null){const t=n.length;for(let s=0;s<t;s++)n[s]=A(n[s],e);return n},pa=function(n,e=null,t=null,s=null){const o=i=>A(s!==null?Object.assign(i,s):i);return e===null?(...i)=>o(new n(...mt(i))):t!==null?(t=A(t),(...i)=>o(new n(e,...mt(i),t))):(...i)=>o(new n(e,...mt(i)))},ma=function(n,...e){return A(new n(...mt(e)))};class fa extends R{constructor(e,t){super(),this.shaderNode=e,this.inputNodes=t}getNodeType(e){const{outputNode:t}=e.getNodeProperties(this);return t?t.getNodeType(e):super.getNodeType(e)}call(e){const{shaderNode:t,inputNodes:s}=this;if(t.layout){let r=mn.get(e.constructor);r===void 0&&(r=new WeakMap,mn.set(e.constructor,r));let a=r.get(t);return a===void 0&&(a=A(e.buildFunctionNode(t)),r.set(t,a)),e.currentFunctionNode!==null&&e.currentFunctionNode.includes.push(a),A(a.call(s))}const o=t.jsFunc,i=s!==null?o(s,e.stack,e):o(e.stack,e);return A(i)}setup(e){return e.addStack(),e.stack.outputNode=this.call(e),e.removeStack()}generate(e,t){const{outputNode:s}=e.getNodeProperties(this);return s===null?this.call(e).build(e,t):super.generate(e,t)}}class ga extends R{constructor(e){super(),this.jsFunc=e,this.layout=null}get isArrayInput(){return/^\(\s+?\[/.test(this.jsFunc.toString())}setLayout(e){return this.layout=e,this}call(e=null){return os(e),A(new fa(this,e))}setup(){return this.call()}}const Na=[!1,!0],ya=[0,1,2,3],xa=[-1,-2],Yn=[.5,1.5,1/3,1e-6,1e6,Math.PI,Math.PI*2,1/Math.PI,2/Math.PI,1/(Math.PI*2),Math.PI/2],Gs=new Map;for(const n of Na)Gs.set(n,new Ie(n));const Ws=new Map;for(const n of ya)Ws.set(n,new Ie(n,"uint"));const ks=new Map([...Ws].map(n=>new Ie(n.value,"int")));for(const n of xa)ks.set(n,new Ie(n,"int"));const ss=new Map([...ks].map(n=>new Ie(n.value)));for(const n of Yn)ss.set(n,new Ie(n));for(const n of Yn)ss.set(-n,new Ie(-n));const ns={bool:Gs,uint:Ws,ints:ks,float:ss},fn=new Map([...Gs,...ss]),Es=(n,e)=>fn.has(n)?fn.get(n):n.isNode===!0?n:new Ie(n,e),Ta=n=>{try{return n.getNodeType()}catch{return}},H=function(n,e=null){return(...t)=>{if((t.length===0||!["bool","float","int","uint"].includes(n)&&t.every(o=>typeof o!="object"))&&(t=[Wn(n,...t)]),t.length===1&&e!==null&&e.has(t[0]))return A(e.get(t[0]));if(t.length===1){const o=Es(t[0],n);return Ta(o)===n?A(o):A(new Bs(o,n))}const s=t.map(o=>Es(o));return A(new Xn(s,n))}},va=n=>n!=null?n.nodeType||n.convertTo||(typeof n=="string"?n:null):null;function At(n){return new Proxy(new ga(n),jn)}const A=(n,e=null)=>la(n,e),os=(n,e=null)=>new da(n,e),mt=(n,e=null)=>new ha(n,e),N=(...n)=>new pa(...n),S=(...n)=>new ma(...n),T=n=>{const e=new At(n),t=(...s)=>{let o;return os(s),s[0]&&s[0].isNode?o=[...s]:o=s[0],e.call(o)};return t.shaderNode=e,t.setLayout=s=>(e.setLayout(s),t),t};x("ShaderNode",At);const gn=n=>{yt=n},_a=()=>yt,W=(...n)=>yt.if(...n);function Va(n){return yt&&yt.add(n),n}g("append",Va);const Sa=new H("color"),h=new H("float",ns.float),d=new H("int",ns.int),M=new H("uint",ns.uint),st=new H("bool",ns.bool),L=new H("vec2"),Jn=new H("ivec2"),Ma=new H("uvec2"),Ea=new H("bvec2"),y=new H("vec3"),Aa=new H("ivec3"),zt=new H("uvec3"),Zn=new H("bvec3"),P=new H("vec4"),Ra=new H("ivec4"),wa=new H("uvec4"),La=new H("bvec4"),xt=new H("mat3"),Ca=new H("imat3"),Ia=new H("umat3"),Oa=new H("bmat3"),Kn=new H("mat4"),ba=new H("imat4"),Da=new H("umat4"),za=new H("bmat4"),Fa=(n="")=>A(new Ie(n,"string")),Pa=n=>A(new Ie(n,"ArrayBuffer"));g("color",Sa);g("float",h);g("int",d);g("uint",M);g("bool",st);g("vec2",L);g("ivec2",Jn);g("uvec2",Ma);g("bvec2",Ea);g("vec3",y);g("ivec3",Aa);g("uvec3",zt);g("bvec3",Zn);g("vec4",P);g("ivec4",Ra);g("uvec4",wa);g("bvec4",La);g("mat3",xt);g("imat3",Ca);g("umat3",Ia);g("bmat3",Oa);g("mat4",Kn);g("imat4",ba);g("umat4",Da);g("bmat4",za);g("string",Fa);g("arrayBuffer",Pa);const Ua=N(Us),Ba=(n,e)=>A(new Bs(A(n),e));g("element",Ua);g("convert",Ba);class Je extends ts{constructor(e,t=null){super(e,t),this.isUniformNode=!0,this.groupNode=ca}setGroup(e){return this.groupNode=e,this}getGroup(){return this.groupNode}getUniformHash(e){return this.getHash(e)}generate(e,t){const s=this.getNodeType(e),o=this.getUniformHash(e);let i=e.getNodeFromHash(o);i===void 0&&(e.setHashNode(this,o),i=this);const r=i.getInputType(e),a=e.getUniformFromNode(i,r,e.shaderStage,e.context.label),c=e.getPropertyName(a);return e.context.label!==void 0&&delete e.context.label,e.format(c,s,t)}}const J=(n,e)=>{const t=va(e||n),s=n&&n.isNode===!0?n.node&&n.node.value||n.value:n;return A(new Je(s,t))};x("UniformNode",Je);class Ga extends Je{constructor(e=[]){super(),this.isArrayUniformNode=!0,this.nodes=e}getNodeType(e){return this.nodes[0].getNodeType(e)}}x("ArrayUniformNode",Ga);class Qn extends ${constructor(e,t){super(),this.targetNode=e,this.sourceNode=t}hasDependencies(){return!1}getNodeType(e,t){return t!=="void"?this.targetNode.getNodeType(e):"void"}generate(e,t){const s=this.targetNode,o=this.sourceNode,i=s.getNodeType(e),r=s.build(e),a=o.build(e,i),c=`${r} = ${a}`;if(t==="void"){e.addLineFlowCode(c);return}else return o.getNodeType(e)==="void"?(e.addLineFlowCode(c),r):e.format(c,i,t)}}const Wa=N(Qn);x("AssignNode",Qn);g("assign",Wa);class eo extends R{constructor(e,t=null){super(),this.node=e,this.name=t,this.isVaryingNode=!0}isGlobal(){return!0}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}generate(e){const{name:t,node:s}=this,o=this.getNodeType(e),i=e.getVaryingFromNode(this,t,o);i.needsInterpolation||(i.needsInterpolation=e.shaderStage==="fragment");const r=e.getPropertyName(i,dn.VERTEX);return e.flowNodeFromShaderStage(dn.VERTEX,s,o,r),e.getPropertyName(i)}}const Y=N(eo);g("varying",Y);x("VaryingNode",eo);class Hs extends R{constructor(e,t=null){super(t),this._attributeName=e}isGlobal(){return!0}getHash(e){return this.getAttributeName(e)}getNodeType(e){let t=super.getNodeType(e);if(t===null){const s=this.getAttributeName(e);if(e.hasGeometryAttribute(s)){const o=e.geometry.getAttribute(s);t=e.getTypeFromAttribute(o)}else t="float"}return t}setAttributeName(e){return this._attributeName=e,this}getAttributeName(){return this._attributeName}generate(e){const t=this.getAttributeName(e),s=this.getNodeType(e);if(e.hasGeometryAttribute(t)===!0){const i=e.geometry.getAttribute(t),r=e.getTypeFromAttribute(i),a=e.getAttribute(t,r);return e.shaderStage==="vertex"?e.format(a.name,r,s):Y(this).build(e,s)}else return console.warn(`AttributeNode: Attribute "${t}" not found.`),e.generateConst(s)}}const ge=(n,e)=>A(new Hs(n,e));x("AttributeNode",Hs);class to extends R{constructor(e,t){super(),this.isBypassNode=!0,this.outputNode=e,this.callNode=t}getNodeType(e){return this.outputNode.getNodeType(e)}generate(e){const t=this.callNode.build(e,"void");return t!==""&&e.addLineFlowCode(t),this.outputNode.build(e)}}const so=N(to);g("bypass",so);x("BypassNode",to);let ka=0;class Ha{constructor(){this.id=ka++,this.nodesData=new WeakMap}getNodeData(e){return this.nodesData.get(e)}setNodeData(e,t){this.nodesData.set(e,t)}}class no extends R{constructor(e,t=new Ha){super(),this.isCacheNode=!0,this.node=e,this.cache=t}getNodeType(e){return this.node.getNodeType(e)}build(e,...t){const s=e.getCache(),o=this.cache||e.globalCache;e.setCache(o);const i=this.node.build(e,...t);return e.setCache(s),i}}const $t=N(no),$a=n=>$t(n,null);g("cache",$t);g("globalCache",$a);x("CacheNode",no);class $s extends R{constructor(e,t={}){super(),this.isContextNode=!0,this.node=e,this.context=t}getNodeType(e){return this.node.getNodeType(e)}setup(e){const t=e.getContext();e.setContext({...e.context,...this.context});const s=this.node.build(e);return e.setContext(t),s}generate(e,t){const s=e.getContext();e.setContext({...e.context,...this.context});const o=this.node.build(e,t);return e.setContext(s),o}}const He=N($s),oo=(n,e)=>He(n,{label:e});g("context",He);g("label",oo);x("ContextNode",$s);class Pe extends R{constructor(e){super("uint"),this.scope=e,this.isInstanceIndexNode=!0}generate(e){const t=this.getNodeType(e),s=this.scope;let o;if(s===Pe.VERTEX)o=e.getVertexIndex();else if(s===Pe.INSTANCE)o=e.getInstanceIndex();else throw new Error("THREE.IndexNode: Unknown scope: "+s);let i;return e.shaderStage==="vertex"||e.shaderStage==="compute"?i=o:i=Y(this).build(e,t),i}}Pe.VERTEX="vertex";Pe.INSTANCE="instance";const Xa=S(Pe,Pe.VERTEX),qa=S(Pe,Pe.INSTANCE);x("IndexNode",Pe);class io{start(){}finish(){}direct(){}indirectDiffuse(){}indirectSpecular(){}ambientOcclusion(){}}class ro extends R{constructor(e,t=null){super(),this.node=e,this.name=t,this.isVarNode=!0}isGlobal(){return!0}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}generate(e){const{node:t,name:s}=this,o=e.getVarFromNode(this,s,e.getVectorType(this.getNodeType(e))),i=e.getPropertyName(o),r=t.build(e,o.type);return e.addLineFlowCode(`${i} = ${r}`),i}}const Lt=N(ro);g("temp",Lt);g("toVar",(...n)=>Lt(...n).append());x("VarNode",ro);class ee extends R{constructor(e,t=null,s=!1){super(e),this.name=t,this.varying=s,this.isPropertyNode=!0}getHash(e){return this.name||super.getHash(e)}isGlobal(){return!0}generate(e){let t;return this.varying===!0?(t=e.getVaryingFromNode(this,this.name),t.needsInterpolation=!0):t=e.getVarFromNode(this,this.name),e.getPropertyName(t)}}const we=(n,e)=>A(new ee(n,e)),Xe=(n,e)=>A(new ee(n,e,!0)),fe=S(ee,"vec4","DiffuseColor"),Rt=S(ee,"float","Roughness"),ja=S(ee,"float","Metalness"),As=S(ee,"float","Clearcoat"),Xt=S(ee,"float","ClearcoatRoughness"),ht=S(ee,"vec3","Sheen"),Xs=S(ee,"float","SheenRoughness"),qs=S(ee,"float","Iridescence"),ao=S(ee,"float","IridescenceIOR"),co=S(ee,"float","IridescenceThickness"),We=S(ee,"color","SpecularColor"),Rs=S(ee,"float","Shininess"),Ya=S(ee,"vec4","Output"),ft=S(ee,"float","dashSize"),qt=S(ee,"float","gapSize");S(ee,"float","pointWidth");x("PropertyNode",ee);class Ja extends ee{constructor(e,t=null){super(e,t),this.isParameterNode=!0}getHash(){return this.uuid}generate(){return this.name}}x("ParameterNode",Ja);class js extends R{constructor(e="",t=[],s=""){super("code"),this.isCodeNode=!0,this.code=e,this.language=s,this.includes=t}setIncludes(e){return this.includes=e,this}getIncludes(){return this.includes}generate(e){const t=this.getIncludes(e);for(const o of t)o.build(e);const s=e.getCodeFromNode(this,this.getNodeType(e));return s.code=this.code,s.code}serialize(e){super.serialize(e),e.code=this.code,e.language=this.language}deserialize(e){super.deserialize(e),this.code=e.code,this.language=e.language}}N(js);x("CodeNode",js);class Za extends js{constructor(e="",t=[],s=""){super(e,t,s),this.keywords={}}getNodeType(e){return this.getNodeFunction(e).type}getInputs(e){return this.getNodeFunction(e).inputs}getNodeFunction(e){const t=e.getDataFromNode(this);let s=t.nodeFunction;return s===void 0&&(s=e.parser.parseFunction(this.code),t.nodeFunction=s),s}generate(e,t){super.generate(e);const s=this.getNodeFunction(e),o=s.name,i=s.type,r=e.getCodeFromNode(this,i);o!==""&&(r.name=o);const a=e.getPropertyName(r);let c=this.getNodeFunction(e).getCode(a);const u=this.keywords,l=Object.keys(u);if(l.length>0)for(const p of l){const f=new RegExp(`\\b${p}\\b`,"g"),v=u[p].build(e,"property");c=c.replace(f,v)}return r.code=c+`
`,t==="property"?a:e.format(`${a}()`,i,t)}}x("FunctionNode",Za);class uo extends Hs{constructor(e=0){super(null,"vec2"),this.isUVNode=!0,this.index=e}getAttributeName(){const e=this.index;return"uv"+(e>0?e:"")}serialize(e){super.serialize(e),e.index=this.index}deserialize(e){super.deserialize(e),this.index=e.index}}const Ze=(...n)=>A(new uo(...n));x("UVNode",uo);class lo extends R{constructor(e,t=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=e,this.levelNode=t}generate(e,t){const s=this.textureNode.build(e,"property"),o=this.levelNode.build(e,"int");return e.format(`${e.getMethod("textureDimensions")}( ${s}, ${o} )`,this.getNodeType(e),t)}}const ho=N(lo);g("textureSize",ho);x("TextureSizeNode",lo);class j extends ${constructor(e,t,s,...o){if(super(),this.op=e,o.length>0){let i=s;for(let r=0;r<o.length;r++)i=new j(e,i,o[r]);s=i}this.aNode=t,this.bNode=s}getNodeType(e,t){const s=this.op,o=this.aNode,i=this.bNode,r=o.getNodeType(e),a=i.getNodeType(e);if(r==="void"||a==="void")return"void";if(s==="%")return r;if(s==="&"||s==="|"||s==="^"||s===">>"||s==="<<")return e.getIntegerType(r);if(s==="=="||s==="&&"||s==="||"||s==="^^")return"bool";if(s==="<"||s===">"||s==="<="||s===">="){const c=t?e.getTypeLength(t):Math.max(e.getTypeLength(r),e.getTypeLength(a));return c>1?`bvec${c}`:"bool"}else return r==="float"&&e.isMatrix(a)?a:e.isMatrix(r)&&e.isVector(a)?e.getVectorFromMatrix(r):e.isVector(r)&&e.isMatrix(a)?e.getVectorFromMatrix(a):e.getTypeLength(a)>e.getTypeLength(r)?a:r}generate(e,t){const s=this.op,o=this.aNode,i=this.bNode,r=this.getNodeType(e,t);let a=null,c=null;r!=="void"?(a=o.getNodeType(e),c=i.getNodeType(e),s==="<"||s===">"||s==="<="||s===">="||s==="=="?e.isVector(a)?c=a:a=c="float":s===">>"||s==="<<"?(a=r,c=e.changeComponentType(c,"uint")):e.isMatrix(a)&&e.isVector(c)?c=e.getVectorFromMatrix(a):e.isVector(a)&&e.isMatrix(c)?a=e.getVectorFromMatrix(c):a=c=r):a=c=r;const u=o.build(e,a),l=i.build(e,c),p=e.getTypeLength(t),f=e.getFunctionOperator(s);if(t!=="void")return s==="<"&&p>1?e.format(`${e.getMethod("lessThan")}( ${u}, ${l} )`,r,t):s==="<="&&p>1?e.format(`${e.getMethod("lessThanEqual")}( ${u}, ${l} )`,r,t):s===">"&&p>1?e.format(`${e.getMethod("greaterThan")}( ${u}, ${l} )`,r,t):s===">="&&p>1?e.format(`${e.getMethod("greaterThanEqual")}( ${u}, ${l} )`,r,t):f?e.format(`${f}( ${u}, ${l} )`,r,t):e.format(`( ${u} ${s} ${l} )`,r,t);if(a!=="void")return f?e.format(`${f}( ${u}, ${l} )`,r,t):e.format(`${u} ${s} ${l}`,r,t)}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}}const Le=N(j,"+"),de=N(j,"-"),X=N(j,"*"),Ct=N(j,"/"),Ka=N(j,"%"),Qa=N(j,"=="),ec=N(j,"!="),tc=N(j,"<"),po=N(j,">"),sc=N(j,"<="),nc=N(j,">="),oc=N(j,"&&"),ic=N(j,"||"),rc=N(j,"^^"),ac=N(j,"&"),cc=N(j,"|"),uc=N(j,"^"),lc=N(j,"<<"),dc=N(j,">>");g("add",Le);g("sub",de);g("mul",X);g("div",Ct);g("remainder",Ka);g("equal",Qa);g("notEqual",ec);g("lessThan",tc);g("greaterThan",po);g("lessThanEqual",sc);g("greaterThanEqual",nc);g("and",oc);g("or",ic);g("xor",rc);g("bitAnd",ac);g("bitOr",cc);g("bitXor",uc);g("shiftLeft",lc);g("shiftRight",dc);x("OperatorNode",j);class m extends ${constructor(e,t,s=null,o=null){super(),this.method=e,this.aNode=t,this.bNode=s,this.cNode=o}getInputType(e){const t=this.aNode.getNodeType(e),s=this.bNode?this.bNode.getNodeType(e):null,o=this.cNode?this.cNode.getNodeType(e):null,i=e.isMatrix(t)?0:e.getTypeLength(t),r=e.isMatrix(s)?0:e.getTypeLength(s),a=e.isMatrix(o)?0:e.getTypeLength(o);return i>r&&i>a?t:r>a?s:a>i?o:t}getNodeType(e){const t=this.method;return t===m.LENGTH||t===m.DISTANCE||t===m.DOT?"float":t===m.CROSS?"vec3":this.getInputType(e)}generate(e,t){const s=this.method,o=this.getNodeType(e),i=this.getInputType(e),r=this.aNode,a=this.bNode,c=this.cNode,u=e.renderer.isWebGLRenderer===!0;if(s===m.TRANSFORM_DIRECTION){let l=r,p=a;e.isMatrix(l.getNodeType(e))?p=P(y(p),0):l=P(y(l),0);const f=X(l,p).xyz;return Ce(f).build(e,t)}else{if(s===m.NEGATE)return e.format("( - "+r.build(e,i)+" )",o,t);if(s===m.ONE_MINUS)return de(1,r).build(e,t);if(s===m.RECIPROCAL)return Ct(1,r).build(e,t);if(s===m.DIFFERENCE)return Re(de(r,a)).build(e,t);{const l=[];return s===m.CROSS?l.push(r.build(e,o),a.build(e,o)):s===m.STEP?l.push(r.build(e,e.getTypeLength(r.getNodeType(e))===1?"float":i),a.build(e,i)):u&&(s===m.MIN||s===m.MAX)||s===m.MOD?l.push(r.build(e,i),a.build(e,e.getTypeLength(a.getNodeType(e))===1?"float":i)):s===m.REFRACT?l.push(r.build(e,i),a.build(e,i),c.build(e,"float")):s===m.MIX?l.push(r.build(e,i),a.build(e,i),c.build(e,e.getTypeLength(c.getNodeType(e))===1?"float":i)):(l.push(r.build(e,i)),a!==null&&l.push(a.build(e,i)),c!==null&&l.push(c.build(e,i))),e.format(`${e.getMethod(s)}( ${l.join(", ")} )`,o,t)}}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}m.RADIANS="radians";m.DEGREES="degrees";m.EXP="exp";m.EXP2="exp2";m.LOG="log";m.LOG2="log2";m.SQRT="sqrt";m.INVERSE_SQRT="inversesqrt";m.FLOOR="floor";m.CEIL="ceil";m.NORMALIZE="normalize";m.FRACT="fract";m.SIN="sin";m.COS="cos";m.TAN="tan";m.ASIN="asin";m.ACOS="acos";m.ATAN="atan";m.ABS="abs";m.SIGN="sign";m.LENGTH="length";m.NEGATE="negate";m.ONE_MINUS="oneMinus";m.DFDX="dFdx";m.DFDY="dFdy";m.ROUND="round";m.RECIPROCAL="reciprocal";m.TRUNC="trunc";m.FWIDTH="fwidth";m.BITCAST="bitcast";m.ATAN2="atan2";m.MIN="min";m.MAX="max";m.MOD="mod";m.STEP="step";m.REFLECT="reflect";m.DISTANCE="distance";m.DIFFERENCE="difference";m.DOT="dot";m.CROSS="cross";m.POW="pow";m.TRANSFORM_DIRECTION="transformDirection";m.MIX="mix";m.CLAMP="clamp";m.REFRACT="refract";m.SMOOTHSTEP="smoothstep";m.FACEFORWARD="faceforward";const mo=h(1e-6);h(1e6);const hc=N(m,m.RADIANS),pc=N(m,m.DEGREES),mc=N(m,m.EXP),fc=N(m,m.EXP2),gc=N(m,m.LOG),Nc=N(m,m.LOG2),ct=N(m,m.SQRT),yc=N(m,m.INVERSE_SQRT),Ft=N(m,m.FLOOR),fo=N(m,m.CEIL),Ce=N(m,m.NORMALIZE),Ys=N(m,m.FRACT),xc=N(m,m.SIN),Tc=N(m,m.COS),vc=N(m,m.TAN),_c=N(m,m.ASIN),Vc=N(m,m.ACOS),Sc=N(m,m.ATAN),Re=N(m,m.ABS),Mc=N(m,m.SIGN),Ec=N(m,m.LENGTH),Ac=N(m,m.NEGATE),Rc=N(m,m.ONE_MINUS),wc=N(m,m.DFDX),Lc=N(m,m.DFDY),Cc=N(m,m.ROUND),Ic=N(m,m.RECIPROCAL),go=N(m,m.TRUNC),Oc=N(m,m.FWIDTH);N(m,m.BITCAST);const bc=N(m,m.ATAN2),It=N(m,m.MIN),nt=N(m,m.MAX),Dc=N(m,m.MOD),zc=N(m,m.STEP),Fc=N(m,m.REFLECT),Pc=N(m,m.DISTANCE),Uc=N(m,m.DIFFERENCE),Pt=N(m,m.DOT),Bc=N(m,m.CROSS),Js=N(m,m.POW),Gc=N(m,m.POW,2),Wc=N(m,m.POW,3),kc=N(m,m.POW,4),Hc=N(m,m.TRANSFORM_DIRECTION),Ge=N(m,m.MIX),No=(n,e=0,t=1)=>A(new m(m.CLAMP,A(n),A(e),A(t))),$c=n=>No(n),Xc=N(m,m.REFRACT),ot=N(m,m.SMOOTHSTEP),qc=N(m,m.FACEFORWARD),jc=(n,e,t)=>Ge(e,t,n),Yc=(n,e,t)=>ot(e,t,n);g("radians",hc);g("degrees",pc);g("exp",mc);g("exp2",fc);g("log",gc);g("log2",Nc);g("sqrt",ct);g("inverseSqrt",yc);g("floor",Ft);g("ceil",fo);g("normalize",Ce);g("fract",Ys);g("sin",xc);g("cos",Tc);g("tan",vc);g("asin",_c);g("acos",Vc);g("atan",Sc);g("abs",Re);g("sign",Mc);g("length",Ec);g("negate",Ac);g("oneMinus",Rc);g("dFdx",wc);g("dFdy",Lc);g("round",Cc);g("reciprocal",Ic);g("trunc",go);g("fwidth",Oc);g("atan2",bc);g("min",It);g("max",nt);g("mod",Dc);g("step",zc);g("reflect",Fc);g("distance",Pc);g("dot",Pt);g("cross",Bc);g("pow",Js);g("pow2",Gc);g("pow3",Wc);g("pow4",kc);g("transformDirection",Hc);g("mix",jc);g("clamp",No);g("refract",Xc);g("smoothstep",Yc);g("faceForward",qc);g("difference",Uc);g("saturate",$c);x("MathNode",m);const Jc=T(n=>{const{value:e}=n,{rgb:t}=e,s=t.mul(.9478672986).add(.0521327014).pow(2.4),o=t.mul(.0773993808),i=t.lessThanEqual(.04045),r=Ge(s,o,i);return P(r,e.a)}),Zc=T(n=>{const{value:e}=n,{rgb:t}=e,s=t.pow(.41666).mul(1.055).sub(.055),o=t.mul(12.92),i=t.lessThanEqual(.0031308),r=Ge(s,o,i);return P(r,e.a)}),Nn=n=>{let e=null;return n===es?e="Linear":n===Sr&&(e="sRGB"),e},yo=(n,e)=>Nn(n)+"To"+Nn(e);class Ve extends ${constructor(e,t){super("vec4"),this.method=e,this.node=t}setup(){const{method:e,node:t}=this;return e===Ve.LINEAR_TO_LINEAR?t:Kc[e]({value:t})}}Ve.LINEAR_TO_LINEAR="LinearToLinear";Ve.LINEAR_TO_sRGB="LinearTosRGB";Ve.sRGB_TO_LINEAR="sRGBToLinear";const Kc={[Ve.LINEAR_TO_sRGB]:Zc,[Ve.sRGB_TO_LINEAR]:Jc},Qc=(n,e)=>A(new Ve(yo(es,e),A(n))),xo=(n,e)=>A(new Ve(yo(e,es),A(n))),eu=N(Ve,Ve.LINEAR_TO_sRGB),tu=N(Ve,Ve.sRGB_TO_LINEAR);g("linearTosRGB",eu);g("sRGBToLinear",tu);g("linearToColorSpace",Qc);g("colorSpaceToLinear",xo);x("ColorSpaceNode",Ve);class To extends R{constructor(e="",t="void"){super(t),this.snippet=e}generate(e,t){const s=this.getNodeType(e),o=this.snippet;if(s==="void")e.addLineFlowCode(o);else return e.format(`( ${o} )`,s,t)}}const Zs=N(To);x("ExpressionNode",To);class vo extends Je{constructor(e){super(0),this.textureNode=e,this.updateType=Q.FRAME}get texture(){return this.textureNode.value}update(){const e=this.texture,t=e.images,s=t&&t.length>0?t[0]&&t[0].image||t[0]:e.image;if(s&&s.width!==void 0){const{width:o,height:i}=s;this.value=Math.log2(Math.max(o,i))}}}const Ks=N(vo);x("MaxMipLevelNode",vo);class Tt extends Je{constructor(e,t=null,s=null){super(e),this.isTextureNode=!0,this.uvNode=t,this.levelNode=s,this.compareNode=null,this.depthNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=Q.NONE,this.setUpdateMatrix(t===null)}getUniformHash(){return this.value.uuid}getNodeType(){return this.value.isDepthTexture===!0?"float":"vec4"}getInputType(){return"texture"}getDefaultUV(){return Ze(this.value.channel)}updateReference(){return this.value}getTransformedUV(e){const t=this.value;return J(t.matrix).mul(y(e,1)).xy}setUpdateMatrix(e){return this.updateMatrix=e,this.updateType=e?Q.FRAME:Q.NONE,this}setupUV(e,t){const s=this.value;return e.isFlipY()&&(s.isRenderTargetTexture===!0||s.isFramebufferTexture===!0||s.isDepthTexture===!0)&&(t=t.setY(t.y.oneMinus())),t}setup(e){const t=e.getNodeProperties(this);let s=this.uvNode;(s===null||e.context.forceUVContext===!0)&&e.context.getUV&&(s=e.context.getUV(this)),s||(s=this.getDefaultUV()),this.updateMatrix===!0&&(s=this.getTransformedUV(s)),s=this.setupUV(e,s);let o=this.levelNode;o===null&&e.context.getTextureLevel&&(o=e.context.getTextureLevel(this)),o!==null&&e.context.getTextureLevelAlgorithm!==void 0&&(o=e.context.getTextureLevelAlgorithm(this,o)),t.uvNode=s,t.levelNode=o,t.compareNode=this.compareNode,t.depthNode=this.depthNode}generateUV(e,t){return t.build(e,this.sampler===!0?"vec2":"ivec2")}generateSnippet(e,t,s,o,i,r){const a=this.value;let c;return o?c=e.generateTextureLevel(a,t,s,o,i):r?c=e.generateTextureCompare(a,t,s,r,i):this.sampler===!1?c=e.generateTextureLoad(a,t,s,i):c=e.generateTexture(a,t,s,i),c}generate(e,t){const s=e.getNodeProperties(this),o=this.value;if(!o||o.isTexture!==!0)throw new Error("TextureNode: Need a three.js texture.");const i=super.generate(e,"property");if(t==="sampler")return i+"_sampler";if(e.isReference(t))return i;{const r=e.getDataFromNode(this);let a=r.propertyName;if(a===void 0){const{uvNode:l,levelNode:p,compareNode:f,depthNode:v}=s,_=this.generateUV(e,l),E=p?p.build(e,"float"):null,O=v?v.build(e,"int"):null,w=f?f.build(e,"float"):null,b=e.getVarFromNode(this);a=e.getPropertyName(b);const C=this.generateSnippet(e,i,_,E,O,w);e.addLineFlowCode(`${a} = ${C}`),e.context.tempWrite!==!1&&(r.snippet=C,r.propertyName=a)}let c=a;const u=this.getNodeType(e);return e.needsColorSpaceToLinear(o)&&(c=xo(Zs(c,u),o.colorSpace).setup(e).build(e,u)),e.format(c,u,t)}}setSampler(e){return this.sampler=e,this}getSampler(){return this.sampler}uv(e){const t=this.clone();return t.uvNode=e,A(t)}blur(e){const t=this.clone();return t.levelNode=e.mul(Ks(t)),A(t)}level(e){const t=this.clone();return t.levelNode=e,t}size(e){return ho(this,e)}compare(e){const t=this.clone();return t.compareNode=A(e),A(t)}depth(e){const t=this.clone();return t.depthNode=A(e),A(t)}serialize(e){super.serialize(e),e.value=this.value.toJSON(e.meta).uuid}deserialize(e){super.deserialize(e),this.value=e.meta.textures[e.value]}update(){const e=this.value;e.matrixAutoUpdate===!0&&e.updateMatrix()}clone(){const e=new this.constructor(this.value,this.uvNode,this.levelNode);return e.sampler=this.sampler,e}}const De=N(Tt),su=(...n)=>De(...n).setSampler(!1);g("texture",De);x("TextureNode",Tt);class Ut extends R{constructor(e,t,s=null){super(),this.property=e,this.index=null,this.uniformType=t,this.object=s,this.reference=null,this.node=null,this.updateType=Q.OBJECT,this.setNodeType(t)}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setIndex(e){return this.index=e,this}getIndex(){return this.index}setNodeType(e){let t=null;e==="texture"?t=De(null):t=J(e),this.node=t}getNodeType(e){return this.node.getNodeType(e)}update(){let e=this.reference[this.property];this.index!==null&&(e=e[this.index]),this.node.value=e}setup(){return this.node}}const it=(n,e,t)=>A(new Ut(n,e,t)),nu=(n,e,t,s)=>A(new Ut(n,t,s).setIndex(e));x("ReferenceNode",Ut);class _o extends Ut{constructor(e,t,s=null){super(e,t,s),this.material=s}updateReference(e){return this.reference=this.material!==null?this.material:e.material,this.reference}setup(e){const t=this.material!==null?this.material:e.material;return this.node.value=t[this.property],super.setup(e)}}const ou=(n,e,t)=>A(new _o(n,e,t));x("MaterialReferenceNode",_o);class I extends R{constructor(e=I.VIEW_MATRIX,t=null){super(),this.scope=e,this.object3d=t,this.updateType=Q.OBJECT,this._uniformNode=new Je(null)}getNodeType(){const e=this.scope;if(e===I.WORLD_MATRIX||e===I.VIEW_MATRIX)return"mat4";if(e===I.NORMAL_MATRIX)return"mat3";if(e===I.POSITION||e===I.VIEW_POSITION||e===I.DIRECTION||e===I.SCALE)return"vec3"}update(e){const t=this.object3d,s=this._uniformNode,o=this.scope;if(o===I.VIEW_MATRIX)s.value=t.modelViewMatrix;else if(o===I.NORMAL_MATRIX)s.value=t.normalMatrix;else if(o===I.WORLD_MATRIX)s.value=t.matrixWorld;else if(o===I.POSITION)s.value=s.value||new Et,s.value.setFromMatrixPosition(t.matrixWorld);else if(o===I.SCALE)s.value=s.value||new Et,s.value.setFromMatrixScale(t.matrixWorld);else if(o===I.DIRECTION)s.value=s.value||new Et,t.getWorldDirection(s.value);else if(o===I.VIEW_POSITION){const i=e.camera;s.value=s.value||new Et,s.value.setFromMatrixPosition(t.matrixWorld),s.value.applyMatrix4(i.matrixWorldInverse)}}generate(e){const t=this.scope;return t===I.WORLD_MATRIX||t===I.VIEW_MATRIX?this._uniformNode.nodeType="mat4":t===I.NORMAL_MATRIX?this._uniformNode.nodeType="mat3":(t===I.POSITION||t===I.VIEW_POSITION||t===I.DIRECTION||t===I.SCALE)&&(this._uniformNode.nodeType="vec3"),this._uniformNode.build(e)}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}I.VIEW_MATRIX="viewMatrix";I.NORMAL_MATRIX="normalMatrix";I.WORLD_MATRIX="worldMatrix";I.POSITION="position";I.SCALE="scale";I.VIEW_POSITION="viewPosition";I.DIRECTION="direction";N(I,I.DIRECTION);N(I,I.VIEW_MATRIX);N(I,I.NORMAL_MATRIX);N(I,I.WORLD_MATRIX);const ws=N(I,I.POSITION);N(I,I.SCALE);const Vo=N(I,I.VIEW_POSITION);x("Object3DNode",I);class z extends I{constructor(e=z.POSITION){super(e),this.updateType=Q.RENDER}getNodeType(e){const t=this.scope;return t===z.PROJECTION_MATRIX?"mat4":t===z.NEAR||t===z.FAR||t===z.LOG_DEPTH?"float":super.getNodeType(e)}update(e){const t=e.camera,s=this._uniformNode,o=this.scope;o===z.VIEW_MATRIX?s.value=t.matrixWorldInverse:o===z.PROJECTION_MATRIX?s.value=t.projectionMatrix:o===z.NEAR?s.value=t.near:o===z.FAR?s.value=t.far:o===z.LOG_DEPTH?s.value=2/(Math.log(t.far+1)/Math.LN2):(this.object3d=t,super.update(e))}generate(e){const t=this.scope;return t===z.PROJECTION_MATRIX?this._uniformNode.nodeType="mat4":(t===z.NEAR||t===z.FAR||t===z.LOG_DEPTH)&&(this._uniformNode.nodeType="float"),super.generate(e)}}z.PROJECTION_MATRIX="projectionMatrix";z.NEAR="near";z.FAR="far";z.LOG_DEPTH="logDepth";const ke=oo(S(z,z.PROJECTION_MATRIX),"projectionMatrix"),ds=S(z,z.NEAR),hs=S(z,z.FAR),iu=S(z,z.LOG_DEPTH),Ke=S(z,z.VIEW_MATRIX);S(z,z.NORMAL_MATRIX);S(z,z.WORLD_MATRIX);S(z,z.POSITION);x("CameraNode",z);class me extends I{constructor(e=me.VIEW_MATRIX){super(e)}update(e){this.object3d=e.object,super.update(e)}}S(me,me.DIRECTION);const rt=S(me,me.VIEW_MATRIX).label("modelViewMatrix").temp("ModelViewMatrix"),So=S(me,me.NORMAL_MATRIX),jt=S(me,me.WORLD_MATRIX);S(me,me.POSITION);S(me,me.SCALE);S(me,me.VIEW_POSITION);x("ModelNode",me);class te extends R{constructor(e=te.LOCAL){super("vec3"),this.scope=e}isGlobal(){return!0}getHash(){return`normal-${this.scope}`}generate(e){const t=this.scope;let s=null;if(t===te.GEOMETRY)s=ge("normal","vec3");else if(t===te.LOCAL)s=Y(Yt);else if(t===te.VIEW){const o=So.mul($e);s=Ce(Y(o))}else if(t===te.WORLD){const o=Ye.transformDirection(Ke);s=Ce(Y(o))}return s.build(e,this.getNodeType(e))}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}te.GEOMETRY="geometry";te.LOCAL="local";te.VIEW="view";te.WORLD="world";const Yt=S(te,te.GEOMETRY),$e=S(te,te.LOCAL).temp("Normal"),Ye=S(te,te.VIEW),Mo=S(te,te.WORLD),K=we("vec3","TransformedNormalView"),ru=K.transformDirection(Ke).normalize(),pt=we("vec3","TransformedClearcoatNormalView");x("NormalNode",te);const yn=new Map;class V extends R{constructor(e){super(),this.scope=e}getCache(e,t){let s=yn.get(e);return s===void 0&&(s=ou(e,t),yn.set(e,s)),s}getFloat(e){return this.getCache(e,"float")}getColor(e){return this.getCache(e,"color")}getTexture(e){return this.getCache(e==="map"?"map":e+"Map","texture")}setup(e){const t=e.context.material,s=this.scope;let o=null;if(s===V.COLOR){const i=this.getColor(s);t.map&&t.map.isTexture===!0?o=i.mul(this.getTexture("map")):o=i}else if(s===V.OPACITY){const i=this.getFloat(s);t.alphaMap&&t.alphaMap.isTexture===!0?o=i.mul(this.getTexture("alpha")):o=i}else if(s===V.SPECULAR_STRENGTH)t.specularMap&&t.specularMap.isTexture===!0?o=this.getTexture(s).r:o=h(1);else if(s===V.ROUGHNESS){const i=this.getFloat(s);t.roughnessMap&&t.roughnessMap.isTexture===!0?o=i.mul(this.getTexture(s).g):o=i}else if(s===V.METALNESS){const i=this.getFloat(s);t.metalnessMap&&t.metalnessMap.isTexture===!0?o=i.mul(this.getTexture(s).b):o=i}else if(s===V.EMISSIVE){const i=this.getColor(s);t.emissiveMap&&t.emissiveMap.isTexture===!0?o=i.mul(this.getTexture(s)):o=i}else if(s===V.NORMAL)t.normalMap?o=this.getTexture("normal").normalMap(this.getCache("normalScale","vec2")):t.bumpMap?o=this.getTexture("bump").r.bumpMap(this.getFloat("bumpScale")):o=Ye;else if(s===V.CLEARCOAT){const i=this.getFloat(s);t.clearcoatMap&&t.clearcoatMap.isTexture===!0?o=i.mul(this.getTexture(s).r):o=i}else if(s===V.CLEARCOAT_ROUGHNESS){const i=this.getFloat(s);t.clearcoatRoughnessMap&&t.clearcoatRoughnessMap.isTexture===!0?o=i.mul(this.getTexture(s).r):o=i}else if(s===V.CLEARCOAT_NORMAL)t.clearcoatNormalMap?o=this.getTexture(s).normalMap(this.getCache(s+"Scale","vec2")):o=Ye;else if(s===V.SHEEN){const i=this.getColor("sheenColor").mul(this.getFloat("sheen"));t.sheenColorMap&&t.sheenColorMap.isTexture===!0?o=i.mul(this.getTexture("sheenColor").rgb):o=i}else if(s===V.SHEEN_ROUGHNESS){const i=this.getFloat(s);t.sheenRoughnessMap&&t.sheenRoughnessMap.isTexture===!0?o=i.mul(this.getTexture(s).a):o=i,o=o.clamp(.07,1)}else if(s===V.IRIDESCENCE_THICKNESS){const i=it(1,"float",t.iridescenceThicknessRange);if(t.iridescenceThicknessMap){const r=it(0,"float",t.iridescenceThicknessRange);o=i.sub(r).mul(this.getTexture(s).g).add(r)}else o=i}else{const i=this.getNodeType(e);o=this.getCache(s,i)}return o}}V.ALPHA_TEST="alphaTest";V.COLOR="color";V.OPACITY="opacity";V.SHININESS="shininess";V.SPECULAR_COLOR="specular";V.SPECULAR_STRENGTH="specularStrength";V.REFLECTIVITY="reflectivity";V.ROUGHNESS="roughness";V.METALNESS="metalness";V.NORMAL="normal";V.CLEARCOAT="clearcoat";V.CLEARCOAT_ROUGHNESS="clearcoatRoughness";V.CLEARCOAT_NORMAL="clearcoatNormal";V.EMISSIVE="emissive";V.ROTATION="rotation";V.SHEEN="sheen";V.SHEEN_ROUGHNESS="sheenRoughness";V.IRIDESCENCE="iridescence";V.IRIDESCENCE_IOR="iridescenceIOR";V.IRIDESCENCE_THICKNESS="iridescenceThickness";V.LINE_SCALE="scale";V.LINE_DASH_SIZE="dashSize";V.LINE_GAP_SIZE="gapSize";V.LINE_WIDTH="linewidth";V.LINE_DASH_OFFSET="dashOffset";V.POINT_WIDTH="pointWidth";const au=S(V,V.ALPHA_TEST),Ot=S(V,V.COLOR),cu=S(V,V.SHININESS),uu=S(V,V.EMISSIVE),Eo=S(V,V.OPACITY),lu=S(V,V.SPECULAR_COLOR),du=S(V,V.SPECULAR_STRENGTH);S(V,V.REFLECTIVITY);const hu=S(V,V.ROUGHNESS),pu=S(V,V.METALNESS),mu=S(V,V.NORMAL),fu=S(V,V.CLEARCOAT),gu=S(V,V.CLEARCOAT_ROUGHNESS),Nu=S(V,V.CLEARCOAT_NORMAL),yu=S(V,V.ROTATION),xu=S(V,V.SHEEN),Tu=S(V,V.SHEEN_ROUGHNESS),vu=S(V,V.IRIDESCENCE),_u=S(V,V.IRIDESCENCE_IOR),Vu=S(V,V.IRIDESCENCE_THICKNESS),Ls=S(V,V.LINE_SCALE),Ao=S(V,V.LINE_DASH_SIZE),Ro=S(V,V.LINE_GAP_SIZE),St=S(V,V.LINE_WIDTH),xn=S(V,V.LINE_DASH_OFFSET),Su=S(V,V.POINT_WIDTH);x("MaterialNode",V);class G extends R{constructor(e=G.LOCAL){super("vec3"),this.scope=e}isGlobal(){return!0}getHash(){return`position-${this.scope}`}generate(e){const t=this.scope;let s=null;if(t===G.GEOMETRY)s=ge("position","vec3");else if(t===G.LOCAL)s=Y(Ne);else if(t===G.WORLD){const o=jt.mul(ve);s=Y(o)}else if(t===G.VIEW){const o=rt.mul(ve);s=Y(o)}else if(t===G.VIEW_DIRECTION){const o=Ue.negate();s=Ce(Y(o))}else if(t===G.WORLD_DIRECTION){const o=ve.transformDirection(jt);s=Ce(Y(o))}return s.build(e,this.getNodeType(e))}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}G.GEOMETRY="geometry";G.LOCAL="local";G.WORLD="world";G.WORLD_DIRECTION="worldDirection";G.VIEW="view";G.VIEW_DIRECTION="viewDirection";const Ne=S(G,G.GEOMETRY),ve=S(G,G.LOCAL).temp("Position"),Mu=S(G,G.WORLD),Eu=S(G,G.WORLD_DIRECTION),Ue=S(G,G.VIEW),ae=S(G,G.VIEW_DIRECTION);x("PositionNode",G);class wo extends ${constructor(e=null){super("vec4"),this.positionNode=e}setup(e){if(e.shaderStage==="fragment")return Y(e.context.mvp);const t=this.positionNode||ve;return ke.mul(rt).mul(t)}}const Tn=N(wo);x("ModelViewProjectionNode",wo);class Lo extends ts{constructor(e,t=null,s=0,o=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferStride=s,this.bufferOffset=o,this.usage=Mr,this.instanced=!1,this.attribute=null,e&&e.isBufferAttribute===!0&&(this.attribute=e,this.usage=e.usage,this.instanced=e.isInstancedBufferAttribute)}getNodeType(e){return this.bufferType===null&&(this.bufferType=e.getTypeFromAttribute(this.attribute)),this.bufferType}setup(e){if(this.attribute!==null)return;const t=this.getNodeType(e),s=this.value,o=e.getTypeLength(t),i=this.bufferStride||o,r=this.bufferOffset,a=s.isInterleavedBuffer===!0?s:new Er(s,i),c=new Ar(a,o,r);a.setUsage(this.usage),this.attribute=c,this.attribute.isInstancedBufferAttribute=this.instanced}generate(e){const t=this.getNodeType(e),s=e.getBufferAttributeFromNode(this,t),o=e.getPropertyName(s);let i=null;return e.shaderStage==="vertex"?i=o:i=Y(this).build(e,t),i}getInputType(){return"bufferAttribute"}setUsage(e){return this.usage=e,this}setInstanced(e){return this.instanced=e,this}}const Qs=(n,e,t,s)=>A(new Lo(n,e,t,s)),Au=(n,e,t,s)=>Qs(n,e,t,s).setUsage(Dn),Ru=(n,e,t,s)=>Qs(n,e,t,s).setInstanced(!0),wu=(n,e,t,s)=>Au(n,e,t,s).setInstanced(!0);g("toAttribute",n=>Qs(n.value));x("BufferAttributeNode",Lo);class Co extends R{constructor(e){super("void"),this.instanceMesh=e,this.instanceMatrixNode=null}setup(){let e=this.instanceMatrixNode;if(e===null){const a=this.instanceMesh.instanceMatrix,c=new Rr(a.array,16,1),u=a.usage===Dn?wu:Ru,l=[u(c,"vec4",16,0),u(c,"vec4",16,4),u(c,"vec4",16,8),u(c,"vec4",16,12)];e=Kn(...l),this.instanceMatrixNode=e}const t=e.mul(ve).xyz,s=xt(e[0].xyz,e[1].xyz,e[2].xyz),o=$e.div(y(s[0].dot(s[0]),s[1].dot(s[1]),s[2].dot(s[2]))),i=s.mul(o).xyz;ve.assign(t),$e.assign(i)}}const Lu=N(Co);x("InstanceNode",Co);class en extends Je{constructor(e,t,s=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferCount=s}getInputType(){return"buffer"}}const Io=(n,e,t)=>A(new en(n,e,t));x("BufferNode",en);class Z extends R{constructor(e=Z.LOCAL){super(),this.scope=e}getHash(){return`tangent-${this.scope}`}getNodeType(){return this.scope===Z.GEOMETRY?"vec4":"vec3"}generate(e){const t=this.scope;let s=null;if(t===Z.GEOMETRY)s=ge("tangent","vec4");else if(t===Z.LOCAL)s=Y(Jt.xyz);else if(t===Z.VIEW){const o=rt.mul(tn).xyz;s=Ce(Y(o))}else if(t===Z.WORLD){const o=is.transformDirection(Ke);s=Ce(Y(o))}return s.build(e,this.getNodeType(e))}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}Z.GEOMETRY="geometry";Z.LOCAL="local";Z.VIEW="view";Z.WORLD="world";const Jt=S(Z,Z.GEOMETRY),tn=S(Z,Z.LOCAL),is=S(Z,Z.VIEW),Cu=S(Z,Z.WORLD),Oo=Lt(is,"TransformedTangentView");Ce(Oo.transformDirection(Ke));x("TangentNode",Z);class bo extends R{constructor(e){super("void"),this.skinnedMesh=e,this.updateType=Q.OBJECT,this.skinIndexNode=ge("skinIndex","uvec4"),this.skinWeightNode=ge("skinWeight","vec4"),this.bindMatrixNode=J(e.bindMatrix,"mat4"),this.bindMatrixInverseNode=J(e.bindMatrixInverse,"mat4"),this.boneMatricesNode=Io(e.skeleton.boneMatrices,"mat4",e.skeleton.bones.length)}setup(e){const{skinIndexNode:t,skinWeightNode:s,bindMatrixNode:o,bindMatrixInverseNode:i,boneMatricesNode:r}=this,a=r.element(t.x),c=r.element(t.y),u=r.element(t.z),l=r.element(t.w),p=o.mul(ve),f=Le(a.mul(s.x).mul(p),c.mul(s.y).mul(p),u.mul(s.z).mul(p),l.mul(s.w).mul(p)),v=i.mul(f).xyz;let _=Le(s.x.mul(a),s.y.mul(c),s.z.mul(u),s.w.mul(l));_=i.mul(_).mul(o);const E=_.transformDirection($e).xyz;ve.assign(v),$e.assign(E),e.hasGeometryAttribute("tangent")&&tn.assign(E)}generate(e,t){if(t!=="void")return ve.build(e,t)}update(){this.skinnedMesh.skeleton.update()}}const Iu=N(bo);x("SkinningNode",bo);const ps=new WeakMap,Se=new wt,vn=T(({bufferMap:n,influence:e,stride:t,width:s,depth:o,offset:i})=>{const r=d(Xa).mul(t).add(i),a=r.div(s),c=r.sub(a.mul(s));return su(n,Jn(c,a)).depth(o).mul(e)});function Ou(n){const e=n.morphAttributes.position!==void 0,t=n.morphAttributes.normal!==void 0,s=n.morphAttributes.color!==void 0,o=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,i=o!==void 0?o.length:0;let r=ps.get(n);if(r===void 0||r.count!==i){let w=function(){E.dispose(),ps.delete(n),n.removeEventListener("dispose",w)};r!==void 0&&r.texture.dispose();const a=n.morphAttributes.position||[],c=n.morphAttributes.normal||[],u=n.morphAttributes.color||[];let l=0;e===!0&&(l=1),t===!0&&(l=2),s===!0&&(l=3);let p=n.attributes.position.count*l,f=1;const v=4096;p>v&&(f=Math.ceil(p/v),p=v);const _=new Float32Array(p*f*4*i),E=new wr(_,p,f,i);E.type=zn,E.needsUpdate=!0;const O=l*4;for(let b=0;b<i;b++){const C=a[b],D=c[b],le=u[b],F=p*f*4*b;for(let oe=0;oe<C.count;oe++){const ie=oe*O;e===!0&&(Se.fromBufferAttribute(C,oe),_[F+ie+0]=Se.x,_[F+ie+1]=Se.y,_[F+ie+2]=Se.z,_[F+ie+3]=0),t===!0&&(Se.fromBufferAttribute(D,oe),_[F+ie+4]=Se.x,_[F+ie+5]=Se.y,_[F+ie+6]=Se.z,_[F+ie+7]=0),s===!0&&(Se.fromBufferAttribute(le,oe),_[F+ie+8]=Se.x,_[F+ie+9]=Se.y,_[F+ie+10]=Se.z,_[F+ie+11]=le.itemSize===4?Se.w:1)}}r={count:i,texture:E,stride:l,size:new qe(p,f)},ps.set(n,r),n.addEventListener("dispose",w)}return r}class Do extends R{constructor(e){super("void"),this.mesh=e,this.morphBaseInfluence=J(1),this.updateType=Q.OBJECT}setup(e){const{geometry:t}=e,s=t.morphAttributes.position!==void 0,o=t.morphAttributes.normal!==void 0,i=t.morphAttributes.position||t.morphAttributes.normal||t.morphAttributes.color,r=i!==void 0?i.length:0,{texture:a,stride:c,size:u}=Ou(t);s===!0&&ve.mulAssign(this.morphBaseInfluence),o===!0&&$e.mulAssign(this.morphBaseInfluence);const l=d(u.width);for(let p=0;p<r;p++){const f=nu("morphTargetInfluences",p,"float"),v=d(p);s===!0&&ve.addAssign(vn({bufferMap:a,influence:f,stride:c,width:l,depth:v,offset:d(0)})),o===!0&&$e.addAssign(vn({bufferMap:a,influence:f,stride:c,width:l,depth:v,offset:d(1)}))}}update(){const e=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?e.value=1:e.value=1-this.mesh.morphTargetInfluences.reduce((t,s)=>t+s,0)}}const bu=N(Do);x("MorphNode",Do);class zo extends R{constructor(){super("vec3")}getHash(){return"reflectVector"}setup(){return ae.negate().reflect(K).transformDirection(Ke)}}const Du=S(zo);x("ReflectVectorNode",zo);class Fo extends Tt{constructor(e,t=null,s=null){super(e,t,s),this.isCubeTextureNode=!0}getInputType(){return"cubeTexture"}getDefaultUV(){return Du}setUpdateMatrix(){}setupUV(e,t){return y(t.x.negate(),t.yz)}generateUV(e,t){return t.build(e,"vec3")}}const sn=N(Fo);g("cubeTexture",sn);x("CubeTextureNode",Fo);class rs extends R{constructor(){super("vec3")}generate(){console.warn("Abstract function.")}}x("LightingNode",rs);let ms=null;class ut extends rs{constructor(e=null){super(),this.updateType=Q.FRAME,this.light=e,this.rtt=null,this.shadowNode=null,this.color=new Ds,this._defaultColorNode=J(this.color),this.colorNode=this._defaultColorNode,this.isAnalyticLightNode=!0}getCacheKey(){return super.getCacheKey()+"-"+(this.light.id+"-"+(this.light.castShadow?"1":"0"))}getHash(){return this.light.uuid}setupShadow(e){let t=this.shadowNode;if(t===null){ms===null&&(ms=e.createNodeMaterial("MeshBasicNodeMaterial"));const s=this.light.shadow,o=e.getRenderTarget(s.mapSize.width,s.mapSize.height),i=new zs;i.minFilter=cn,i.magFilter=cn,i.image.width=s.mapSize.width,i.image.height=s.mapSize.height,i.compareFunction=Lr,o.depthTexture=i,s.camera.updateProjectionMatrix();const r=it("bias","float",s),a=it("normalBias","float",s);let c=J(s.matrix).mul(Mu.add(Mo.mul(a)));c=c.xyz.div(c.w);const u=c.x.greaterThanEqual(0).and(c.x.lessThanEqual(1)).and(c.y.greaterThanEqual(0)).and(c.y.lessThanEqual(1)).and(c.z.lessThanEqual(1));let l=c.z.add(r);e.renderer.coordinateSystem===Cr&&(l=l.mul(2).sub(1)),c=y(c.x,c.y.oneMinus(),l),t=((f,v,_)=>De(f,v).compare(_))(i,c.xy,c.z),this.rtt=o,this.colorNode=this.colorNode.mul(u.mix(1,t)),this.shadowNode=t,this.updateBeforeType=Q.RENDER}}setup(e){this.light.castShadow?this.setupShadow(e):this.shadowNode!==null&&this.disposeShadow()}updateShadow(e){const{rtt:t,light:s}=this,{renderer:o,scene:i}=e,r=i.overrideMaterial;i.overrideMaterial=ms,t.setSize(s.shadow.mapSize.width,s.shadow.mapSize.height),s.shadow.updateMatrices(s);const a=o.getRenderTarget(),c=o.getRenderObjectFunction();o.setRenderObjectFunction((u,...l)=>{u.castShadow===!0&&o.renderObject(u,...l)}),o.setRenderTarget(t),o.render(i,s.shadow.camera),o.setRenderTarget(a),o.setRenderObjectFunction(c),i.overrideMaterial=r}disposeShadow(){this.rtt.dispose(),this.shadowNode=null,this.rtt=null,this.colorNode=this._defaultColorNode}updateBefore(e){const{light:t}=this;t.castShadow&&this.updateShadow(e)}update(){const{light:e}=this;this.color.copy(e.color).multiplyScalar(e.intensity)}}x("AnalyticLightNode",ut);const Zt=new WeakMap,zu=n=>n.sort((e,t)=>e.id-t.id);class Fu extends R{constructor(e=[]){super("vec3"),this.totalDiffuseNode=y().temp("totalDiffuse"),this.totalSpecularNode=y().temp("totalSpecular"),this.outgoingLightNode=y().temp("outgoingLight"),this.lightNodes=e,this._hash=null}get hasLight(){return this.lightNodes.length>0}getHash(){if(this._hash===null){const e=[];for(const t of this.lightNodes)e.push(t.getHash());this._hash="lights-"+e.join(",")}return this._hash}setup(e){const t=e.context,s=t.lightingModel;let o=this.outgoingLightNode;if(s){const{lightNodes:i,totalDiffuseNode:r,totalSpecularNode:a}=this;t.outgoingLight=o;const c=e.addStack();s.start(t,c,e);for(const O of i)O.build(e);s.indirectDiffuse(t,c,e),s.indirectSpecular(t,c,e),s.ambientOcclusion(t,c,e);const{backdrop:u,backdropAlpha:l}=t,{directDiffuse:p,directSpecular:f,indirectDiffuse:v,indirectSpecular:_}=t.reflectedLight;let E=p.add(v);u!==null&&(E=y(l!==null?l.mix(E,u):u)),r.assign(E),a.assign(f.add(_)),o.assign(r.add(a)),s.finish(t,c,e),o=o.bypass(e.removeStack())}return o}_getLightNodeById(e){for(const t of this.lightNodes)if(t.isAnalyticLightNode&&t.light.id===e)return t;return null}fromLights(e=[]){const t=[];e=zu(e);for(const s of e){let o=this._getLightNodeById(s.id);if(o===null){const i=s.constructor,r=Zt.has(i)?Zt.get(i):ut;o=A(new r(s))}t.push(o)}return this.lightNodes=t,this._hash=null,this}}const Pu=N(Fu);function vt(n,e){if(Zt.has(n)){console.warn(`Redefinition of light node ${e.type}`);return}if(typeof n!="function")throw new Error(`Light ${n.name} is not a class`);if(typeof e!="function"||!e.type)throw new Error(`Light node ${e.type} is not a class`);Zt.set(n,e)}class Po extends rs{constructor(e=null){super(),this.aoNode=e}setup(e){const s=this.aoNode.x.sub(1).mul(1).add(1);e.context.ambientOcclusion.mulAssign(s)}}x("AONode",Po);class Uo extends $s{constructor(e,t=null,s=null,o=null){super(e),this.lightingModel=t,this.backdropNode=s,this.backdropAlphaNode=o,this._context=null}getContext(){const{backdropNode:e,backdropAlphaNode:t}=this,s=y().temp("directDiffuse"),o=y().temp("directSpecular"),i=y().temp("indirectDiffuse"),r=y().temp("indirectSpecular"),a={directDiffuse:s,directSpecular:o,indirectDiffuse:i,indirectSpecular:r};return{radiance:y().temp("radiance"),irradiance:y().temp("irradiance"),iblIrradiance:y().temp("iblIrradiance"),ambientOcclusion:h(1).temp("ambientOcclusion"),reflectedLight:a,backdrop:e,backdropAlpha:t}}setup(e){return this.context=this._context||(this._context=this.getContext()),this.context.lightingModel=this.lightingModel||e.context.lightingModel,super.setup(e)}}const Bo=N(Uo);g("lightingContext",Bo);x("LightingContextNode",Uo);class Go extends ${constructor(e=Eu){super("vec2"),this.dirNode=e}setup(){const e=this.dirNode,t=e.z.atan2(e.x).mul(1/(Math.PI*2)).add(.5),s=e.y.negate().clamp(-1,1).asin().mul(1/Math.PI).add(.5);return L(t,s)}}const Wo=N(Go);x("EquirectUVNode",Go);class ko extends R{constructor(e,t=null){super("float"),this.textureNode=e,this.roughnessNode=t}setup(){const{textureNode:e,roughnessNode:t}=this,s=Ks(e),o=t.mul(t).mul(Math.PI).div(t.add(1));return s.add(o.log2()).clamp(0,s)}}const Uu=N(ko);x("SpecularMIPLevelNode",ko);const _n=new WeakMap;class Ho extends rs{constructor(e=null){super(),this.envNode=e}setup(e){let t=this.envNode;if(t.isTextureNode&&t.value.isCubeTexture!==!0){let c=_n.get(t.value);if(c===void 0){const u=t.value,l=e.renderer,p=e.getCubeRenderTarget(512).fromEquirectangularTexture(l,u);c=sn(p.texture),_n.set(t.value,c)}t=c}const s=it("envMapIntensity","float",e.material),o=He(t,Vn(Rt,K)).mul(s),i=He(t,Bu(ru)).mul(Math.PI).mul(s),r=$t(o);e.context.radiance.addAssign(r),e.context.iblIrradiance.addAssign(i);const a=e.context.lightingModel.clearcoatRadiance;if(a){const c=He(t,Vn(Xt,pt)).mul(s),u=$t(c);a.addAssign(u)}}}const Vn=(n,e)=>{let t=null,s=null;return{getUV:o=>{let i=null;return t===null&&(t=ae.negate().reflect(e),t=n.mul(n).mix(t,e).normalize(),t=t.transformDirection(Ke)),o.isCubeTextureNode?i=t:o.isTextureNode&&(s===null&&(s=Wo(t)),i=s),i},getTextureLevel:()=>n,getTextureLevelAlgorithm:(o,i)=>Uu(o,i)}},Bu=n=>{let e=null;return{getUV:t=>{let s=null;return t.isCubeTextureNode?s=n:t.isTextureNode&&(e===null&&(e=Wo(n),e=L(e.x,e.y.oneMinus())),s=e),s},getTextureLevel:t=>Ks(t)}};x("EnvironmentNode",Ho);let fs,gs;class U extends R{constructor(e){super(),this.scope=e,this.isViewportNode=!0}getNodeType(){return this.scope===U.VIEWPORT?"vec4":"vec2"}getUpdateType(){let e=Q.NONE;return(this.scope===U.RESOLUTION||this.scope===U.VIEWPORT)&&(e=Q.FRAME),this.updateType=e,e}update({renderer:e}){this.scope===U.VIEWPORT?e.getViewport(gs):e.getDrawingBufferSize(fs)}setup(){const e=this.scope;if(e===U.COORDINATE)return;let t=null;if(e===U.RESOLUTION)t=J(fs||(fs=new qe));else if(e===U.VIEWPORT)t=J(gs||(gs=new wt));else{t=Gu.div(Sn);let s=t.x,o=t.y;/bottom/i.test(e)&&(o=o.oneMinus()),/right/i.test(e)&&(s=s.oneMinus()),t=L(s,o)}return t}generate(e){if(this.scope===U.COORDINATE){let t=e.getFragCoord();if(e.isFlipY()){const s=e.getNodeProperties(Sn).outputNode.build(e);t=`${e.getType("vec2")}( ${t}.x, ${s}.y - ${t}.y )`}return t}return super.generate(e)}}U.COORDINATE="coordinate";U.RESOLUTION="resolution";U.VIEWPORT="viewport";U.TOP_LEFT="topLeft";U.BOTTOM_LEFT="bottomLeft";U.TOP_RIGHT="topRight";U.BOTTOM_RIGHT="bottomRight";const Gu=S(U,U.COORDINATE),Sn=S(U,U.RESOLUTION),gt=S(U,U.VIEWPORT),nn=S(U,U.TOP_LEFT);S(U,U.BOTTOM_LEFT);S(U,U.TOP_RIGHT);S(U,U.BOTTOM_RIGHT);x("ViewportNode",U);const Mt=new qe;class Bt extends Tt{constructor(e=nn,t=null,s=null){s===null&&(s=new Fn,s.minFilter=Ir),super(s,e,t),this.generateMipmaps=!1,this.isOutputTextureNode=!0,this.updateBeforeType=Q.FRAME}updateBefore(e){const t=e.renderer;t.getDrawingBufferSize(Mt);const s=this.value;(s.image.width!==Mt.width||s.image.height!==Mt.height)&&(s.image.width=Mt.width,s.image.height=Mt.height,s.needsUpdate=!0);const o=s.generateMipmaps;s.generateMipmaps=this.generateMipmaps,t.copyFramebufferToTexture(s),s.generateMipmaps=o}clone(){return new this.constructor(this.uvNode,this.levelNode,this.value)}}const Wu=N(Bt),ku=N(Bt,null,null,{generateMipmaps:!0});g("viewportTexture",Wu);g("viewportMipTexture",ku);x("ViewportTextureNode",Bt);let lt=null;class $o extends Bt{constructor(e=nn,t=null){lt===null&&(lt=new zs,lt.minFilter=Or,lt.type=br,lt.format=Dr),super(e,t,lt)}}const Xo=N($o);g("viewportDepthTexture",Xo);x("ViewportDepthTextureNode",$o);class he extends R{constructor(e,t=null){super("float"),this.scope=e,this.valueNode=t,this.isViewportDepthNode=!0}generate(e){const{scope:t}=this;return t===he.DEPTH_PIXEL?e.getFragDepth():super.generate(e)}setup(){const{scope:e}=this;let t=null;if(e===he.DEPTH)t=Cs(Ue.z,ds,hs);else if(e===he.DEPTH_TEXTURE){const s=this.valueNode||Xo(),o=qo(s,ds,hs);t=Cs(o,ds,hs)}else e===he.DEPTH_PIXEL&&this.valueNode!==null&&(t=jo().assign(this.valueNode));return t}}const Cs=(n,e,t)=>n.add(e).div(e.sub(t)),qo=(n,e,t)=>e.mul(t).div(t.sub(e).mul(n).sub(t));he.DEPTH="depth";he.DEPTH_TEXTURE="depthTexture";he.DEPTH_PIXEL="depthPixel";const jo=N(he,he.DEPTH_PIXEL);S(he,he.DEPTH);N(he,he.DEPTH_TEXTURE);const Yo=S(he,he.DEPTH_PIXEL);Yo.assign=n=>jo(n);x("ViewportDepthNode",he);const Is=new Map;class Oe extends zr{constructor(){super(),this.isNodeMaterial=!0,this.type=this.constructor.type,this.forceSinglePass=!1,this.fog=!0,this.lights=!0,this.normals=!0,this.colorSpaced=!0,this.lightsNode=null,this.envNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.positionNode=null,this.depthNode=null,this.outputNode=null,this.fragmentNode=null,this.vertexNode=null}customProgramCacheKey(){return this.type+Gn(this)}build(e){this.setup(e)}setup(e){e.addStack(),e.stack.outputNode=this.vertexNode||this.setupPosition(e),e.addFlow("vertex",e.removeStack()),e.addStack();let t;if(this.fragmentNode===null){this.depthWrite===!0&&this.setupDepth(e),this.normals===!0&&this.setupNormal(e),this.setupDiffuseColor(e),this.setupVariants(e);const s=this.setupLighting(e);t=this.setupOutput(e,P(s,fe.a)),Ya.assign(t),this.outputNode!==null&&(t=this.outputNode)}else t=this.setupOutput(e,this.fragmentNode);e.stack.outputNode=t,e.addFlow("fragment",e.removeStack())}setupDepth(e){const{renderer:t}=e;let s=this.depthNode;s===null&&t.logarithmicDepthBuffer===!0&&(s=Tn().w.add(1).log2().mul(iu).mul(.5)),s!==null&&Yo.assign(s).append()}setupPosition(e){const{object:t}=e,s=t.geometry;e.addStack(),(s.morphAttributes.position||s.morphAttributes.normal||s.morphAttributes.color)&&bu(t).append(),t.isSkinnedMesh===!0&&Iu(t).append(),t.instanceMatrix&&t.instanceMatrix.isInstancedBufferAttribute===!0&&e.isAvailable("instance")===!0&&Lu(t).append(),this.positionNode!==null&&ve.assign(this.positionNode);const o=Tn();return e.context.vertex=e.removeStack(),e.context.mvp=o,o}setupDiffuseColor({geometry:e}){let t=this.colorNode?P(this.colorNode):Ot;this.vertexColors===!0&&e.hasAttribute("color")&&(t=P(t.xyz.mul(ge("color","vec3")),t.a)),fe.assign(t);const s=this.opacityNode?h(this.opacityNode):Eo;if(fe.a.assign(fe.a.mul(s)),this.alphaTestNode!==null||this.alphaTest>0){const o=this.alphaTestNode!==null?h(this.alphaTestNode):au;fe.a.lessThanEqual(o).discard()}}setupVariants(){}setupNormal(){if(this.flatShading===!0){const e=Ue.dFdx().cross(Ue.dFdy()).normalize();K.assign(e)}else{const e=this.normalNode?y(this.normalNode):mu;K.assign(e)}}getEnvNode(e){let t=null;return this.envNode?t=this.envNode:this.envMap?t=this.envMap.isCubeTexture?sn(this.envMap):De(this.envMap):e.environmentNode&&(t=e.environmentNode),t}setupLights(e){const t=this.getEnvNode(e),s=[];t&&s.push(new Ho(t)),e.material.aoMap&&s.push(new Po(De(e.material.aoMap)));let o=this.lightsNode||e.lightsNode;return s.length>0&&(o=Pu([...o.lightNodes,...s])),o}setupLightingModel(){}setupLighting(e){const{material:t}=e,{backdropNode:s,backdropAlphaNode:o,emissiveNode:i}=this,a=this.lights===!0||this.lightsNode!==null?this.setupLights(e):null;let c=fe.rgb;if(a&&a.hasLight!==!1){const u=this.setupLightingModel(e);c=Bo(a,u,s,o)}else s!==null&&(c=y(o!==null?Ge(c,s,o):s));return(i&&i.isNode===!0||t.emissive&&t.emissive.isColor===!0)&&(c=c.add(y(i||uu))),c}setupOutput(e,t){const s=e.renderer,o=e.toneMappingNode;if(this.toneMapped===!0&&o&&(t=P(o.context({color:t.rgb}),t.a)),this.fog===!0){const i=e.fogNode;i&&(t=P(i.mixAssign(t.rgb),t.a))}if(this.colorSpaced===!0){const i=s.currentColorSpace;i!==es&&i!==Fr&&(t=t.linearToColorSpace(i))}return t}setDefaultValues(e){for(const s in e){const o=e[s];this[s]===void 0&&(this[s]=o,o&&o.clone&&(this[s]=o.clone()))}Object.assign(this.defines,e.defines);const t=Object.getOwnPropertyDescriptors(e.constructor.prototype);for(const s in t)Object.getOwnPropertyDescriptor(this.constructor.prototype,s)===void 0&&t[s].get!==void 0&&Object.defineProperty(this.constructor.prototype,s,t[s])}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{},nodes:{}});const s=Pr.prototype.toJSON.call(this,e),o=Ht(this);s.inputNodes={};for(const{property:r,childNode:a}of o)s.inputNodes[r]=a.toJSON(e).uuid;function i(r){const a=[];for(const c in r){const u=r[c];delete u.metadata,a.push(u)}return a}if(t){const r=i(e.textures),a=i(e.images),c=i(e.nodes);r.length>0&&(s.textures=r),a.length>0&&(s.images=a),c.length>0&&(s.nodes=c)}return s}copy(e){return this.lightsNode=e.lightsNode,this.envNode=e.envNode,this.colorNode=e.colorNode,this.normalNode=e.normalNode,this.opacityNode=e.opacityNode,this.backdropNode=e.backdropNode,this.backdropAlphaNode=e.backdropAlphaNode,this.alphaTestNode=e.alphaTestNode,this.positionNode=e.positionNode,this.depthNode=e.depthNode,this.outputNode=e.outputNode,this.fragmentNode=e.fragmentNode,this.vertexNode=e.vertexNode,super.copy(e)}static fromMaterial(e){if(e.isNodeMaterial===!0)return e;const t=e.type.replace("Material","NodeMaterial"),s=Hu(t);if(s===void 0)throw new Error(`NodeMaterial: Material "${e.type}" is not compatible.`);for(const o in e)s[o]=e[o];return s}}function Me(n,e){if(typeof e!="function"||!n)throw new Error(`Node material ${n} is not a class`);if(Is.has(n)){console.warn(`Redefinition of node material ${n}`);return}Is.set(n,e),e.type=n}function Hu(n){const e=Is.get(n);if(e!==void 0)return new e}Me("NodeMaterial",Oe);class on extends R{constructor(e,t,s=null){super(),this.condNode=e,this.ifNode=t,this.elseNode=s}getNodeType(e){const t=this.ifNode.getNodeType(e);if(this.elseNode!==null){const s=this.elseNode.getNodeType(e);if(e.getTypeLength(s)>e.getTypeLength(t))return s}return t}generate(e){const t=this.getNodeType(e),s={tempWrite:!1},{ifNode:o,elseNode:i}=this,r=o.getNodeType(e)!=="void"||i&&i.getNodeType(e)!=="void",a=r?we(t).build(e):"",c=He(this.condNode).build(e,"bool");e.addFlowCode(`
${e.tab}if ( ${c} ) {

`).addFlowTab();let u=He(this.ifNode,s).build(e,t);if(u=r?a+" = "+u+";":u,e.removeFlowTab().addFlowCode(e.tab+"	"+u+`

`+e.tab+"}"),i!==null){e.addFlowCode(` else {

`).addFlowTab();let l=He(i,s).build(e,t);l=a?a+" = "+l+";":l,e.removeFlowTab().addFlowCode(e.tab+"	"+l+`

`+e.tab+`}

`)}else e.addFlowCode(`

`);return a}}const je=N(on);g("cond",je);x("CondNode",on);class Jo extends R{constructor(e=null){super(),this.nodes=[],this.outputNode=null,this.parent=e,this._currentCond=null,this.isStackNode=!0}getNodeType(e){return this.outputNode?this.outputNode.getNodeType(e):"void"}add(e){return this.nodes.push(e),this}if(e,t){const s=new At(t);return this._currentCond=je(e,s),this.add(this._currentCond)}elseif(e,t){const s=new At(t),o=je(e,s);return this._currentCond.elseNode=o,this._currentCond=o,this}else(e){return this._currentCond.elseNode=new At(e),this}build(e,...t){const s=_a();gn(this);for(const o of this.nodes)o.build(e,"void");return gn(s),this.outputNode?this.outputNode.build(e,...t):super.build(e,...t)}}N(Jo);x("StackNode",Jo);class Zo extends R{constructor(e){super(),this.types=e,this.isStructTypeNode=!0}getMemberTypes(){return this.types}}x("StructTypeNode",Zo);class Ko extends R{constructor(...e){super(),this.isOutputStructNode=!0,this.members=e}setup(e){super.setup(e);const t=this.members,s=[];for(let o=0;o<t.length;o++)s.push(t[o].getNodeType(e));this.nodeType=e.getStructTypeFromNode(new Zo(s)).name}generate(e,t){const s=e.getVarFromNode(this);s.isOutputStructVar=!0;const o=e.getPropertyName(s),i=this.members,r=o!==""?o+".":"";for(let a=0;a<i.length;a++){const c=i[a].build(e,t);e.addLineFlowCode(`${r}m${a} = ${c}`)}return o}}N(Ko);x("OutputStructNode",Ko);class Qo extends R{constructor(e){super(),this.seedNode=e}setup(){const e=this.seedNode.uint().mul(747796405).add(2891336453),t=e.shiftRight(e.shiftRight(28).add(4)).bitXor(e).mul(277803737);return t.shiftRight(22).bitXor(t).float().mul(1/2**32)}}const $u=N(Qo);g("hash",$u);x("HashNode",Qo);let Ns;class ei extends on{constructor(e){Ns=Ns||Zs("discard"),super(e,Ns)}}const Xu=N(ei),qu=n=>Xu(n).append();g("discard",qu);x("DiscardNode",ei);class ti extends R{constructor(e=[],...t){super(),this.functionNodes=e,this.parametersNodes=t,this._candidateFnCall=null}getNodeType(){return this.functionNodes[0].shaderNode.layout.type}setup(e){const t=this.parametersNodes;let s=this._candidateFnCall;if(s===null){let o=null,i=-1;for(const r of this.functionNodes){const c=r.shaderNode.layout;if(c===null)throw new Error("FunctionOverloadingNode: FunctionNode must be a layout.");const u=c.inputs;if(t.length===u.length){let l=0;for(let p=0;p<t.length;p++){const f=t[p],v=u[p];f.getNodeType(e)===v.type?l++:l=0}l>i&&(o=r,i=l)}}this._candidateFnCall=s=o(...t)}return s}}const ju=N(ti),be=n=>(...e)=>ju(n,...e);x("FunctionOverloadingNode",ti);class si extends R{constructor(e=[]){super(),this.params=e}getVarName(e){return String.fromCharCode(105+e)}getProperties(e){const t=e.getNodeProperties(this);if(t.stackNode!==void 0)return t;const s={};for(let o=0,i=this.params.length-1;o<i;o++){const r=this.params[o],a=r.isNode!==!0&&r.name||this.getVarName(o),c=r.isNode!==!0&&r.type||"int";s[a]=Zs(a,c)}return t.returnsNode=this.params[this.params.length-1](s,e.addStack(),e),t.stackNode=e.removeStack(),t}getNodeType(e){const{returnsNode:t}=this.getProperties(e);return t?t.getNodeType(e):"void"}setup(e){this.getProperties(e)}generate(e){const t=this.getProperties(e),s={tempWrite:!1},o=this.params,i=t.stackNode;for(let c=0,u=o.length-1;c<u;c++){const l=o[c];let p=null,f=null,v=null,_=null,E=null,O=null;l.isNode?(_="int",v=this.getVarName(c),p="0",f=l.build(e,_),E="<"):(_=l.type||"int",v=l.name||this.getVarName(c),p=l.start,f=l.end,E=l.condition,O=l.update,typeof p=="number"?p=p.toString():p&&p.isNode&&(p=p.build(e,_)),typeof f=="number"?f=f.toString():f&&f.isNode&&(f=f.build(e,_)),p!==void 0&&f===void 0?(p=p+" - 1",f="0",E=">="):f!==void 0&&p===void 0&&(p="0",E="<"),E===void 0&&(Number(p)>Number(f)?E=">=":E="<"));const w={start:p,end:f,condition:E},b=w.start,C=w.end;let D="",le="",F="";O||(_==="int"?E.includes("<")?O="++":O="--":E.includes("<")?O="+= 1":O="-= 1"),D+=e.getVar(_,v)+" = "+b,le+=v+" "+E+" "+C,F+=v+" "+O;const oe=`for ( ${D}; ${le}; ${F} )`;e.addFlowCode((c===0?`
`:"")+e.tab+oe+` {

`).addFlowTab()}const r=He(i,s).build(e,"void"),a=t.returnsNode?t.returnsNode.build(e):"";e.removeFlowTab().addFlowCode(`
`+e.tab+r);for(let c=0,u=this.params.length-1;c<u;c++)e.addFlowCode((c===0?"":e.tab)+`}

`).removeFlowTab();return e.addFlowTab(),a}}const ue=(...n)=>A(new si(mt(n,"int"))).append();g("loop",(n,...e)=>so(n,ue(...e)));x("LoopNode",si);class ni extends ${constructor(){super("vec2")}setup(){const e=y(ae.z,0,ae.x.negate()).normalize(),t=ae.cross(e);return L(e.dot(K),t.dot(K)).mul(.495).add(.5)}}S(ni);x("MatcapUVNode",ni);class Te extends Je{constructor(e=Te.LOCAL,t=1,s=0){super(s),this.scope=e,this.scale=t,this.updateType=Q.FRAME}update(e){const t=this.scope,s=this.scale;t===Te.LOCAL?this.value+=e.deltaTime*s:t===Te.DELTA?this.value=e.deltaTime*s:t===Te.FRAME?this.value=e.frameId:this.value=e.time*s}serialize(e){super.serialize(e),e.scope=this.scope,e.scale=this.scale}deserialize(e){super.deserialize(e),this.scope=e.scope,this.scale=e.scale}}Te.LOCAL="local";Te.GLOBAL="global";Te.DELTA="delta";Te.FRAME="frame";const Yu=(n,e=0)=>A(new Te(Te.LOCAL,n,e));S(Te,Te.FRAME).uint();x("TimerNode",Te);class se extends R{constructor(e=se.SINE,t=Yu()){super(),this.method=e,this.timeNode=t}getNodeType(e){return this.timeNode.getNodeType(e)}setup(){const e=this.method,t=A(this.timeNode);let s=null;return e===se.SINE?s=t.add(.75).mul(Math.PI*2).sin().mul(.5).add(.5):e===se.SQUARE?s=t.fract().round():e===se.TRIANGLE?s=t.add(.5).fract().mul(2).sub(1).abs():e===se.SAWTOOTH&&(s=t.fract()),s}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}se.SINE="sine";se.SQUARE="square";se.TRIANGLE="triangle";se.SAWTOOTH="sawtooth";N(se,se.SINE);N(se,se.SQUARE);N(se,se.TRIANGLE);N(se,se.SAWTOOTH);x("OscNode",se);class Be extends ${constructor(e,t){super(),this.scope=e,this.node=t}getNodeType(e){return this.node.getNodeType(e)}setup(){const{scope:e,node:t}=this;let s=null;return e===Be.DIRECTION_TO_COLOR?s=t.mul(.5).add(.5):e===Be.COLOR_TO_DIRECTION&&(s=t.mul(2).sub(1)),s}}Be.DIRECTION_TO_COLOR="directionToColor";Be.COLOR_TO_DIRECTION="colorToDirection";const oi=N(Be,Be.DIRECTION_TO_COLOR),Ju=N(Be,Be.COLOR_TO_DIRECTION);g("directionToColor",oi);g("colorToDirection",Ju);x("PackingNode",Be);class rn extends R{constructor(e,t,s,o=h(0),i=h(1)){super(),this.node=e,this.inLowNode=t,this.inHighNode=s,this.outLowNode=o,this.outHighNode=i,this.doClamp=!0}setup(){const{node:e,inLowNode:t,inHighNode:s,outLowNode:o,outHighNode:i,doClamp:r}=this;let a=e.sub(t).div(s.sub(t));return r===!0&&(a=a.clamp()),a.mul(i.sub(o)).add(o)}}const Zu=N(rn,null,null,{doClamp:!1}),Ku=N(rn);g("remap",Zu);g("remapClamp",Ku);x("RemapNode",rn);class ii extends ${constructor(e,t,s=L(.5)){super("vec2"),this.uvNode=e,this.rotationNode=t,this.centerNode=s}setup(){const{uvNode:e,rotationNode:t,centerNode:s}=this,o=t.cos(),i=t.sin(),r=e.sub(s);return L(L(o,i).dot(r),L(i.negate(),o).dot(r)).add(s)}}const Qu=N(ii);g("rotateUV",Qu);x("RotateUVNode",ii);class ri extends R{constructor(e,t=Ze(),s=h(0)){super("vec2"),this.countNode=e,this.uvNode=t,this.frameNode=s}setup(){const{frameNode:e,uvNode:t,countNode:s}=this,{width:o,height:i}=s,r=e.mod(o.mul(i)).floor(),a=r.mod(o),c=i.sub(r.add(1).div(o).ceil()),u=s.reciprocal(),l=L(a,c);return t.add(l).mul(u)}}N(ri);x("SpriteSheetUVNode",ri);class ai extends R{constructor(e,t=null,s=null,o=h(1),i=ve,r=$e){super("vec4"),this.textureXNode=e,this.textureYNode=t,this.textureZNode=s,this.scaleNode=o,this.positionNode=i,this.normalNode=r}setup(){const{textureXNode:e,textureYNode:t,textureZNode:s,scaleNode:o,positionNode:i,normalNode:r}=this;let a=r.abs().normalize();a=a.div(a.dot(y(1)));const c=i.yz.mul(o),u=i.zx.mul(o),l=i.xy.mul(o),p=e.value,f=t!==null?t.value:p,v=s!==null?s.value:p,_=De(p,c).mul(a.x),E=De(f,u).mul(a.y),O=De(v,l).mul(a.z);return Le(_,E,O)}}const el=N(ai),tl=(...n)=>el(...n);g("triplanarTexture",tl);x("TriplanarTexturesNode",ai);class ne extends R{constructor(e=ne.LOCAL){super("vec3"),this.scope=e}getHash(){return`bitangent-${this.scope}`}generate(e){const t=this.scope;let s;t===ne.GEOMETRY?s=Yt.cross(Jt):t===ne.LOCAL?s=$e.cross(tn):t===ne.VIEW?s=Ye.cross(is):t===ne.WORLD&&(s=Mo.cross(Cu));const o=s.mul(Jt.w).xyz;return Ce(Y(o)).build(e,this.getNodeType(e))}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}ne.GEOMETRY="geometry";ne.LOCAL="local";ne.VIEW="view";ne.WORLD="world";S(ne,ne.GEOMETRY);S(ne,ne.LOCAL);const sl=S(ne,ne.VIEW);S(ne,ne.WORLD);const nl=Ce(K.cross(Oo).mul(Jt.w));Ce(nl.transformDirection(Ke));x("BitangentNode",ne);const as=1/6,ci=n=>X(as,X(n,X(n,n.negate().add(3)).sub(3)).add(1)),Os=n=>X(as,X(n,X(n,X(3,n).sub(6))).add(4)),ui=n=>X(as,X(n,X(n,X(-3,n).add(3)).add(3)).add(1)),bs=n=>X(as,Js(n,3)),Mn=n=>ci(n).add(Os(n)),En=n=>ui(n).add(bs(n)),An=n=>Le(-1,Os(n).div(ci(n).add(Os(n)))),Rn=n=>Le(1,bs(n).div(ui(n).add(bs(n)))),wn=(n,e,t)=>{const s=n.uvNode,o=X(s,e.zw).add(.5),i=Ft(o),r=Ys(o),a=Mn(r.x),c=En(r.x),u=An(r.x),l=Rn(r.x),p=An(r.y),f=Rn(r.y),v=L(i.x.add(u),i.y.add(p)).sub(.5).mul(e.xy),_=L(i.x.add(l),i.y.add(p)).sub(.5).mul(e.xy),E=L(i.x.add(u),i.y.add(f)).sub(.5).mul(e.xy),O=L(i.x.add(l),i.y.add(f)).sub(.5).mul(e.xy),w=Mn(r.y).mul(Le(a.mul(n.uv(v).level(t)),c.mul(n.uv(_).level(t)))),b=En(r.y).mul(Le(a.mul(n.uv(E).level(t)),c.mul(n.uv(O).level(t))));return w.add(b)},ol=(n,e)=>{const t=L(n.size(d(e))),s=L(n.size(d(e.add(1)))),o=Ct(1,t),i=Ct(1,s),r=wn(n,P(o,t),Ft(e)),a=wn(n,P(i,s),fo(e));return Ys(e).mix(r,a)};class li extends ${constructor(e,t=h(3)){super("vec4"),this.textureNode=e,this.blurNode=t}setup(){return ol(this.textureNode,this.blurNode)}}const il=N(li);g("bicubic",il);x("TextureBicubicNode",li);class di extends R{constructor(){super("vec2"),this.isPointUVNode=!0}generate(){return"vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y )"}}S(di);x("PointUVNode",di);class ze extends R{constructor(e=ze.BACKGROUND_BLURRINESS,t=null){super(),this.scope=e,this.scene=t}setup(e){const t=this.scope,s=this.scene!==null?this.scene:e.scene;let o;return t===ze.BACKGROUND_BLURRINESS?o=it("backgroundBlurriness","float",s):t===ze.BACKGROUND_INTENSITY?o=it("backgroundIntensity","float",s):console.error("THREE.SceneNode: Unknown scope:",t),o}}ze.BACKGROUND_BLURRINESS="backgroundBlurriness";ze.BACKGROUND_INTENSITY="backgroundIntensity";S(ze,ze.BACKGROUND_BLURRINESS);S(ze,ze.BACKGROUND_INTENSITY);x("SceneNode",ze);class rl extends en{constructor(e,t,s=0){super(e,t,s),this.isStorageBufferNode=!0}getInputType(){return"storageBuffer"}}x("StorageBufferNode",rl);class hi extends Tt{constructor(e,t,s=null){super(e,t),this.storeNode=s,this.isStoreTextureNode=!0}getNodeType(){return"void"}}N(hi);x("TextureStoreNode",hi);class al extends Ut{constructor(e,t,s=null){super(e,t,s),this.userData=s}update(e){this.reference=this.userData!==null?this.userData:e.object.userData,super.update(e)}}x("UserDataNode",al);const cl=T(({base:n,blend:e})=>{const t=s=>e[s].lessThan(mo).cond(e[s],n[s].oneMinus().div(e[s]).oneMinus().max(0));return y(t("x"),t("y"),t("z"))}),ul=T(({base:n,blend:e})=>{const t=s=>e[s].equal(1).cond(e[s],n[s].div(e[s].oneMinus()).max(0));return y(t("x"),t("y"),t("z"))}),ll=T(({base:n,blend:e})=>{const t=s=>n[s].oneMinus().mul(e[s].oneMinus()).oneMinus();return y(t("x"),t("y"),t("z"))}),dl=T(({base:n,blend:e})=>{const t=s=>n[s].lessThan(.5).cond(n[s].mul(e[s],2),n[s].oneMinus().mul(e[s].oneMinus()).oneMinus());return y(t("x"),t("y"),t("z"))});class ce extends ${constructor(e,t,s){super(),this.blendMode=e,this.baseNode=t,this.blendNode=s}setup(){const{blendMode:e,baseNode:t,blendNode:s}=this,o={base:t,blend:s};let i=null;return e===ce.BURN?i=cl(o):e===ce.DODGE?i=ul(o):e===ce.SCREEN?i=ll(o):e===ce.OVERLAY&&(i=dl(o)),i}}ce.BURN="burn";ce.DODGE="dodge";ce.SCREEN="screen";ce.OVERLAY="overlay";const hl=N(ce,ce.BURN),pl=N(ce,ce.DODGE),ml=N(ce,ce.OVERLAY),fl=N(ce,ce.SCREEN);g("burn",hl);g("dodge",pl);g("overlay",ml);g("screen",fl);x("BlendModeNode",ce);class pi extends R{constructor(){super("bool"),this.isFrontFacingNode=!0}generate(e){return e.getFrontFacing()}}const gl=S(pi),mi=h(gl).mul(2).sub(1);x("FrontFacingNode",pi);const Nl=T(({textureNode:n,bumpScale:e})=>{let t=n;if(t.isTextureNode!==!0&&t.traverse(r=>{r.isTextureNode===!0&&(t=r)}),t.isTextureNode!==!0)throw new Error("THREE.TSL: dHdxy_fwd() requires a TextureNode.");const s=h(n),o=t.uvNode||Ze(),i=r=>n.cache().context({getUV:()=>r,forceUVContext:!0});return L(h(i(o.add(o.dFdx()))).sub(s),h(i(o.add(o.dFdy()))).sub(s)).mul(e)}),yl=T(n=>{const{surf_pos:e,surf_norm:t,dHdxy:s}=n,o=e.dFdx().normalize(),i=e.dFdy().normalize(),r=t,a=i.cross(r),c=r.cross(o),u=o.dot(a).mul(mi),l=u.sign().mul(s.x.mul(a).add(s.y.mul(c)));return u.abs().mul(t).sub(l).normalize()});class fi extends ${constructor(e,t=null){super("vec3"),this.textureNode=e,this.scaleNode=t}setup(){const e=this.scaleNode!==null?this.scaleNode:1,t=Nl({textureNode:this.textureNode,bumpScale:e});return yl({surf_pos:Ue,surf_norm:Ye,dHdxy:t})}}const xl=N(fi);g("bumpMap",xl);x("BumpMapNode",fi);const Tl=T(({color:n,adjustment:e})=>e.mix(Al(n.rgb),n.rgb)),vl=T(({color:n,adjustment:e})=>{const t=Le(n.r,n.g,n.b).div(3),s=n.r.max(n.g.max(n.b)),o=s.sub(t).mul(e).mul(-3);return Ge(n.rgb,s,o)}),_l=T(({color:n,adjustment:e})=>{const t=y(.57735,.57735,.57735),s=e.cos();return y(n.rgb.mul(s).add(t.cross(n.rgb).mul(e.sin()).add(t.mul(Pt(t,n.rgb).mul(s.oneMinus())))))});class _e extends ${constructor(e,t,s=h(1)){super("vec3"),this.method=e,this.colorNode=t,this.adjustmentNode=s}setup(){const{method:e,colorNode:t,adjustmentNode:s}=this,o={color:t,adjustment:s};let i=null;return e===_e.SATURATION?i=Tl(o):e===_e.VIBRANCE?i=vl(o):e===_e.HUE?i=_l(o):console.error(`${this.type}: Method "${this.method}" not supported!`),i}}_e.SATURATION="saturation";_e.VIBRANCE="vibrance";_e.HUE="hue";const Vl=N(_e,_e.SATURATION),Sl=N(_e,_e.VIBRANCE),Ml=N(_e,_e.HUE),El=y(.2125,.7154,.0721),Al=(n,e=El)=>Pt(n,e);g("saturation",Vl);g("vibrance",Sl);g("hue",Ml);x("ColorAdjustmentNode",_e);const Rl=T(n=>{const{eye_pos:e,surf_norm:t,mapN:s,uv:o}=n,i=e.dFdx(),r=e.dFdy(),a=o.dFdx(),c=o.dFdy(),u=t,l=r.cross(u),p=u.cross(i),f=l.mul(a.x).add(p.mul(c.x)),v=l.mul(a.y).add(p.mul(c.y)),_=f.dot(f).max(v.dot(v)),E=mi.mul(_.inverseSqrt());return Le(f.mul(s.x,E),v.mul(s.y,E),u.mul(s.z)).normalize()});class gi extends ${constructor(e,t=null){super("vec3"),this.node=e,this.scaleNode=t,this.normalMapType=un}setup(e){const{normalMapType:t,scaleNode:s}=this;let o=this.node.mul(2).sub(1);s!==null&&(o=y(o.xy.mul(s),o.z));let i=null;return t===Ur?i=So.mul(o).normalize():t===un&&(e.hasGeometryAttribute("tangent")===!0?i=Ll.mul(o).normalize():i=Rl({eye_pos:Ue,surf_norm:Ye,mapN:o,uv:Ze()})),i}}const wl=N(gi),Ll=xt(is,sl,Ye);g("normalMap",wl);x("NormalMapNode",gi);class Ni extends ${constructor(e,t){super(),this.sourceNode=e,this.stepsNode=t}setup(){const{sourceNode:e,stepsNode:t}=this;return e.mul(t).floor().div(t)}}const Cl=N(Ni);g("posterize",Cl);x("PosterizeNode",Ni);const Il=T(({color:n,exposure:e})=>n.mul(e).clamp()),Ol=T(({color:n,exposure:e})=>(n=n.mul(e),n.div(n.add(1)).clamp())),bl=T(({color:n,exposure:e})=>{n=n.mul(e),n=n.sub(.004).max(0);const t=n.mul(n.mul(6.2).add(.5)),s=n.mul(n.mul(6.2).add(1.7)).add(.06);return t.div(s).pow(2.2)}),Dl=T(({color:n})=>{const e=n.mul(n.add(.0245786)).sub(90537e-9),t=n.mul(n.add(.432951).mul(.983729)).add(.238081);return e.div(t)}),zl=T(({color:n,exposure:e})=>{const t=xt(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),s=xt(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return n=n.mul(e).div(.6),n=t.mul(n),n=Dl({color:n}),n=s.mul(n),n.clamp()}),Fl={[Br]:Il,[Gr]:Ol,[Wr]:bl,[kr]:zl};class Pl extends ${constructor(e=Vs,t=h(1),s=null){super("vec3"),this.toneMapping=e,this.exposureNode=t,this.colorNode=s}getCacheKey(){let e=super.getCacheKey();return e="{toneMapping:"+this.toneMapping+",nodes:"+e+"}",e}setup(e){const t=this.colorNode||e.context.color,s=this.toneMapping;if(s===Vs)return t;const o={exposure:this.exposureNode,color:t},i=Fl[s];let r=null;return i?r=i(o):(console.error("ToneMappingNode: Unsupported Tone Mapping configuration.",s),r=t),r}}x("ToneMappingNode",Pl);let ys=null;class yi extends Bt{constructor(e=nn,t=null){ys===null&&(ys=new Fn),super(e,t,ys)}}const Ul=N(yi);g("viewportSharedTexture",Ul);x("ViewportSharedTextureNode",yi);const Bl=new Hr(-1,1,1,-1,0,1);class Gl extends Xr{constructor(e=!1){super();const t=e===!1?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute("position",new ln([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new ln(t,2))}}const Wl=new Gl;class kl{constructor(e=null){this._mesh=new $r(Wl,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,Bl)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}const xs=new kl;class Hl extends ${constructor(e,t=2){super(e),this.textureNode=e,this.sigma=t,this.directionNode=L(1),this._invSize=J(new qe),this._passDirection=J(new qe),this._horizontalRT=new Ss,this._verticalRT=new Ss,this.updateBeforeType=Q.RENDER,this.resolution=new qe(1,1)}setSize(e,t){e=Math.max(Math.round(e*this.resolution.x),1),t=Math.max(Math.round(t*this.resolution.y),1),this._invSize.value.set(1/e,1/t),this._horizontalRT.setSize(e,t),this._verticalRT.setSize(e,t)}updateBefore(e){const{renderer:t}=e,s=this.textureNode,o=s.value,i=t.getRenderTarget(),r=s.value;xs.material=this._material,this.setSize(o.image.width,o.image.height),t.setRenderTarget(this._horizontalRT),this._passDirection.value.set(1,0),xs.render(t),s.value=this._horizontalRT.texture,t.setRenderTarget(this._verticalRT),this._passDirection.value.set(0,1),xs.render(t),t.setRenderTarget(i),s.value=r}setup(e){const t=this.textureNode;if(t.isTextureNode!==!0)return console.error("GaussianBlurNode requires a TextureNode."),P();const s=t.uvNode||Ze(),o=c=>t.cache().context({getUV:()=>c,forceUVContext:!0}),i=T(()=>{const c=3+2*this.sigma,u=this._getCoefficients(c),l=this._invSize,p=L(this.directionNode).mul(this._passDirection),f=h(u[0]).toVar(),v=y(o(s).mul(f)).toVar();for(let _=1;_<c;_++){const E=h(_),O=h(u[_]),w=L(p.mul(l.mul(E))).toVar(),b=y(o(s.add(w))),C=y(o(s.sub(w)));v.addAssign(b.add(C).mul(O)),f.addAssign(X(2,O))}return P(v.div(f),1)}),r=this._material||(this._material=e.createNodeMaterial("MeshBasicNodeMaterial"));r.fragmentNode=i();const a=e.getNodeProperties(this);return a.textureNode=t,De(this._verticalRT.texture)}_getCoefficients(e){const t=[];for(let s=0;s<e;s++)t.push(.39894*Math.exp(-.5*s*s/(e*e))/e);return t}}const $l=(n,e)=>A(new Hl(A(n),e));g("gaussianBlur",$l);class Ln extends Tt{constructor(e,t){super(t),this.passNode=e,this.setUpdateMatrix(!1)}setup(e){return this.passNode.build(e),super.setup(e)}clone(){return new this.constructor(this.passNode,this.value)}}class Gt extends ${constructor(e,t,s){super("vec4"),this.scope=e,this.scene=t,this.camera=s,this._pixelRatio=1,this._width=1,this._height=1;const o=new zs;o.isRenderTargetTexture=!0,o.type=zn,o.name="PostProcessingDepth";const i=new Ss(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:qr});i.texture.name="PostProcessing",i.depthTexture=o,this.renderTarget=i,this.updateBeforeType=Q.FRAME,this._textureNode=A(new Ln(this,i.texture)),this._depthTextureNode=A(new Ln(this,o)),this._depthNode=null,this._cameraNear=J(0),this._cameraFar=J(0),this.isPassNode=!0}isGlobal(){return!0}getTextureNode(){return this._textureNode}getTextureDepthNode(){return this._depthTextureNode}getDepthNode(){if(this._depthNode===null){const e=this._cameraNear,t=this._cameraFar;this._depthNode=Cs(qo(this._depthTextureNode,e,t),e,t)}return this._depthNode}setup(){return this.scope===Gt.COLOR?this.getTextureNode():this.getDepthNode()}updateBefore(e){const{renderer:t}=e,{scene:s,camera:o}=this;this._pixelRatio=t.getPixelRatio();const i=t.getSize(new qe);this.setSize(i.width,i.height);const r=t.toneMapping,a=t.toneMappingNode,c=t.getRenderTarget();this._cameraNear.value=o.near,this._cameraFar.value=o.far,t.toneMapping=Vs,t.toneMappingNode=null,t.setRenderTarget(this.renderTarget),t.render(s,o),t.toneMapping=r,t.toneMappingNode=a,t.setRenderTarget(c)}setSize(e,t){this._width=e,this._height=t;const s=this._width*this._pixelRatio,o=this._height*this._pixelRatio;this.renderTarget.setSize(s,o)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}Gt.COLOR="color";Gt.DEPTH="depth";x("PassNode",Gt);class xi extends ${constructor(e=null,t={}){super(),this.functionNode=e,this.parameters=t}setParameters(e){return this.parameters=e,this}getParameters(){return this.parameters}getNodeType(e){return this.functionNode.getNodeType(e)}generate(e){const t=[],s=this.functionNode,o=s.getInputs(e),i=this.parameters;if(Array.isArray(i))for(let a=0;a<i.length;a++){const c=o[a],u=i[a];t.push(u.build(e,c.type))}else for(const a of o){const c=i[a.name];if(c!==void 0)t.push(c.build(e,a.type));else throw new Error(`FunctionCallNode: Input '${a.name}' not found in FunctionNode.`)}return`${s.build(e,"property")}( ${t.join(", ")} )`}}const Xl=(n,...e)=>(e=e.length>1||e[0]&&e[0].isNode===!0?mt(e):os(e[0]),A(new xi(A(n),e)));g("call",Xl);x("FunctionCallNode",xi);class Ti extends R{constructor(e=null){super(),this._value=e,this._cache=null,this.inputType=null,this.outpuType=null,this.events=new On,this.isScriptableValueNode=!0}get isScriptableOutputNode(){return this.outputType!==null}set value(e){this._value!==e&&(this._cache&&this.inputType==="URL"&&this.value.value instanceof ArrayBuffer&&(URL.revokeObjectURL(this._cache),this._cache=null),this._value=e,this.events.dispatchEvent({type:"change"}),this.refresh())}get value(){return this._value}refresh(){this.events.dispatchEvent({type:"refresh"})}getValue(){const e=this.value;if(e&&this._cache===null&&this.inputType==="URL"&&e.value instanceof ArrayBuffer)this._cache=URL.createObjectURL(new Blob([e.value]));else if(e&&e.value!==null&&e.value!==void 0&&((this.inputType==="URL"||this.inputType==="String")&&typeof e.value=="string"||this.inputType==="Number"&&typeof e.value=="number"||this.inputType==="Vector2"&&e.value.isVector2||this.inputType==="Vector3"&&e.value.isVector3||this.inputType==="Vector4"&&e.value.isVector4||this.inputType==="Color"&&e.value.isColor||this.inputType==="Matrix3"&&e.value.isMatrix3||this.inputType==="Matrix4"&&e.value.isMatrix4))return e.value;return this._cache||e}getNodeType(e){return this.value&&this.value.isNode?this.value.getNodeType(e):"float"}setup(){return this.value&&this.value.isNode?this.value:h()}serialize(e){super.serialize(e),this.value!==null?this.inputType==="ArrayBuffer"?e.value=kn(this.value):e.value=this.value?this.value.toJSON(e.meta).uuid:null:e.value=null,e.inputType=this.inputType,e.outputType=this.outputType}deserialize(e){super.deserialize(e);let t=null;e.value!==null&&(e.inputType==="ArrayBuffer"?t=Hn(e.value):e.inputType==="Texture"?t=e.meta.textures[e.value]:t=e.meta.nodes[e.value]||null),this.value=t,this.inputType=e.inputType,this.outputType=e.outputType}}const kt=N(Ti);g("scriptableValue",kt);x("ScriptableValueNode",Ti);class vi extends Map{get(e,t=null,...s){if(this.has(e))return super.get(e);if(t!==null){const o=t(...s);return this.set(e,o),o}}}class ql{constructor(e){this.scriptableNode=e}get parameters(){return this.scriptableNode.parameters}get layout(){return this.scriptableNode.getLayout()}getInputLayout(e){return this.scriptableNode.getInputLayout(e)}get(e){const t=this.parameters[e];return t?t.getValue():null}}const Ts=new vi;class _i extends R{constructor(e=null,t={}){super(),this.codeNode=e,this.parameters=t,this._local=new vi,this._output=kt(),this._outputs={},this._source=this.source,this._method=null,this._object=null,this._value=null,this._needsOutputUpdate=!0,this.onRefresh=this.onRefresh.bind(this),this.isScriptableNode=!0}get source(){return this.codeNode?this.codeNode.code:""}setLocal(e,t){return this._local.set(e,t)}getLocal(e){return this._local.get(e)}onRefresh(){this._refresh()}getInputLayout(e){for(const t of this.getLayout())if(t.inputType&&(t.id===e||t.name===e))return t}getOutputLayout(e){for(const t of this.getLayout())if(t.outputType&&(t.id===e||t.name===e))return t}setOutput(e,t){const s=this._outputs;return s[e]===void 0?s[e]=kt(t):s[e].value=t,this}getOutput(e){return this._outputs[e]}getParameter(e){return this.parameters[e]}setParameter(e,t){const s=this.parameters;return t&&t.isScriptableNode?(this.deleteParameter(e),s[e]=t,s[e].getDefaultOutput().events.addEventListener("refresh",this.onRefresh)):t&&t.isScriptableValueNode?(this.deleteParameter(e),s[e]=t,s[e].events.addEventListener("refresh",this.onRefresh)):s[e]===void 0?(s[e]=kt(t),s[e].events.addEventListener("refresh",this.onRefresh)):s[e].value=t,this}getValue(){return this.getDefaultOutput().getValue()}deleteParameter(e){let t=this.parameters[e];return t&&(t.isScriptableNode&&(t=t.getDefaultOutput()),t.events.removeEventListener("refresh",this.onRefresh)),this}clearParameters(){for(const e of Object.keys(this.parameters))this.deleteParameter(e);return this.needsUpdate=!0,this}call(e,...t){const o=this.getObject()[e];if(typeof o=="function")return o(...t)}async callAsync(e,...t){const o=this.getObject()[e];if(typeof o=="function")return o.constructor.name==="AsyncFunction"?await o(...t):o(...t)}getNodeType(e){return this.getDefaultOutputNode().getNodeType(e)}refresh(e=null){e!==null?this.getOutput(e).refresh():this._refresh()}getObject(){if(this.needsUpdate&&this.dispose(),this._object!==null)return this._object;const e=()=>this.refresh(),t=(u,l)=>this.setOutput(u,l),s=new ql(this),o=Ts.get("THREE"),i=Ts.get("TSL"),r=this.getMethod(this.codeNode),a=[s,this._local,Ts,e,t,o,i];this._object=r(...a);const c=this._object.layout;if(c&&(c.cache===!1&&this._local.clear(),this._output.outputType=c.outputType||null,Array.isArray(c.elements)))for(const u of c.elements){const l=u.id||u.name;u.inputType&&(this.getParameter(l)===void 0&&this.setParameter(l,null),this.getParameter(l).inputType=u.inputType),u.outputType&&(this.getOutput(l)===void 0&&this.setOutput(l,null),this.getOutput(l).outputType=u.outputType)}return this._object}deserialize(e){super.deserialize(e);for(const t in this.parameters){let s=this.parameters[t];s.isScriptableNode&&(s=s.getDefaultOutput()),s.events.addEventListener("refresh",this.onRefresh)}}getLayout(){return this.getObject().layout}getDefaultOutputNode(){const e=this.getDefaultOutput().value;return e&&e.isNode?e:h()}getDefaultOutput(){return this._exec()._output}getMethod(){if(this.needsUpdate&&this.dispose(),this._method!==null)return this._method;const e=["parameters","local","global","refresh","setOutput","THREE","TSL"],s=["layout","init","main","dispose"].join(", "),o="var "+s+`; var output = {};
`,i=`
return { ...output, `+s+" };",r=o+this.codeNode.code+i;return this._method=new Function(...e,r),this._method}dispose(){this._method!==null&&(this._object&&typeof this._object.dispose=="function"&&this._object.dispose(),this._method=null,this._object=null,this._source=null,this._value=null,this._needsOutputUpdate=!0,this._output.value=null,this._outputs={})}setup(){return this.getDefaultOutputNode()}set needsUpdate(e){e===!0&&this.dispose()}get needsUpdate(){return this.source!==this._source}_exec(){return this.codeNode===null?this:(this._needsOutputUpdate===!0&&(this._value=this.call("main"),this._needsOutputUpdate=!1),this._output.value=this._value,this)}_refresh(){this.needsUpdate=!0,this._exec(),this._output.refresh()}}const jl=N(_i);g("scriptable",jl);x("ScriptableNode",_i);class cs extends R{constructor(e,t){super("float"),this.isFogNode=!0,this.colorNode=e,this.factorNode=t}mixAssign(e){return this.mix(e,this.colorNode)}setup(){return this.factorNode}}const Yl=N(cs);g("fog",Yl);x("FogNode",cs);class Vi extends cs{constructor(e,t,s){super(e),this.isFogRangeNode=!0,this.nearNode=t,this.farNode=s}setup(){return ot(this.nearNode,this.farNode,Ue.z.negate())}}const Jl=N(Vi);g("rangeFog",Jl);x("FogRangeNode",Vi);class Si extends cs{constructor(e,t){super(e),this.isFogExp2Node=!0,this.densityNode=t}setup(){const e=Ue.z.negate(),t=this.densityNode;return t.mul(t,e,e).negate().exp().oneMinus()}}const Zl=N(Si);g("densityFog",Zl);x("FogExp2Node",Si);let Qe=null,et=null;class Mi extends R{constructor(e=h(),t=h()){super(),this.minNode=e,this.maxNode=t}getVectorLength(e){const t=e.getTypeLength(tt(this.minNode.value)),s=e.getTypeLength(tt(this.maxNode.value));return t>s?t:s}getNodeType(e){return e.object.isInstancedMesh===!0?e.getTypeFromLength(this.getVectorLength(e)):"float"}setup(e){const t=e.object;let s=null;if(t.isInstancedMesh===!0){const o=this.minNode.value,i=this.maxNode.value,r=e.getTypeLength(tt(o)),a=e.getTypeLength(tt(i));Qe=Qe||new wt,et=et||new wt,Qe.setScalar(0),et.setScalar(0),r===1?Qe.setScalar(o):o.isColor?Qe.set(o.r,o.g,o.b):Qe.set(o.x,o.y,o.z||0,o.w||0),a===1?et.setScalar(i):i.isColor?et.set(i.r,i.g,i.b):et.set(i.x,i.y,i.z||0,i.w||0);const c=4,u=c*t.count,l=new Float32Array(u);for(let f=0;f<u;f++){const v=f%c,_=Qe.getComponent(v),E=et.getComponent(v);l[f]=bn.lerp(_,E,Math.random())}const p=this.getNodeType(e);s=Io(l,"vec4",t.count).element(qa).convert(p)}else s=h(0);return s}}N(Mi);x("RangeNode",Mi);class Ei extends R{constructor(e,t,s=[64]){super("void"),this.isComputeNode=!0,this.computeNode=e,this.count=t,this.workgroupSize=s,this.dispatchCount=0,this.version=1,this.updateBeforeType=Q.OBJECT,this.updateDispatchCount()}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}updateDispatchCount(){const{count:e,workgroupSize:t}=this;let s=t[0];for(let o=1;o<t.length;o++)s*=t[o];this.dispatchCount=Math.ceil(e/s)}onInit(){}updateBefore({renderer:e}){e.compute(this)}generate(e){const{shaderStage:t}=e;if(t==="compute"){const s=this.computeNode.build(e,"void");s!==""&&e.addLineFlowCode(s)}}}const Kl=(n,e,t)=>A(new Ei(A(n),e,t));g("compute",Kl);x("ComputeNode",Ei);class at extends R{constructor(e=at.TARGET_DIRECTION,t=null){super(),this.scope=e,this.light=t}setup(){const{scope:e,light:t}=this;let s=null;return e===at.TARGET_DIRECTION&&(s=Ke.transformDirection(ws(t).sub(ws(t.target)))),s}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}at.TARGET_DIRECTION="targetDirection";const Ai=N(at,at.TARGET_DIRECTION);x("LightNode",at);const Ri=T(n=>{const{lightDistance:e,cutoffDistance:t,decayExponent:s}=n,o=e.pow(s).max(.01).reciprocal();return t.greaterThan(0).cond(o.mul(e.div(t).pow4().oneMinus().clamp().pow2()),o)});class wi extends ut{constructor(e=null){super(e),this.cutoffDistanceNode=J(0),this.decayExponentNode=J(0)}update(e){const{light:t}=this;super.update(e),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}setup(e){const{colorNode:t,cutoffDistanceNode:s,decayExponentNode:o,light:i}=this,r=e.context.lightingModel,a=Vo(i).sub(Ue),c=a.normalize(),u=a.length(),l=Ri({lightDistance:u,cutoffDistance:s,decayExponent:o}),p=t.mul(l),f=e.context.reflectedLight;r.direct({lightDirection:c,lightColor:p,reflectedLight:f},e.stack,e)}}x("PointLightNode",wi);vt(jr,wi);class Li extends ut{constructor(e=null){super(e)}setup(e){super.setup(e);const t=e.context.lightingModel,s=this.colorNode,o=Ai(this.light),i=e.context.reflectedLight;t.direct({lightDirection:o,lightColor:s,reflectedLight:i},e.stack,e)}}x("DirectionalLightNode",Li);vt(Yr,Li);class an extends ut{constructor(e=null){super(e),this.coneCosNode=J(0),this.penumbraCosNode=J(0),this.cutoffDistanceNode=J(0),this.decayExponentNode=J(0)}update(e){super.update(e);const{light:t}=this;this.coneCosNode.value=Math.cos(t.angle),this.penumbraCosNode.value=Math.cos(t.angle*(1-t.penumbra)),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}getSpotAttenuation(e){const{coneCosNode:t,penumbraCosNode:s}=this;return ot(t,s,e)}setup(e){super.setup(e);const t=e.context.lightingModel,{colorNode:s,cutoffDistanceNode:o,decayExponentNode:i,light:r}=this,a=Vo(r).sub(Ue),c=a.normalize(),u=c.dot(Ai(r)),l=this.getSpotAttenuation(u),p=a.length(),f=Ri({lightDistance:p,cutoffDistance:o,decayExponent:i}),v=s.mul(l).mul(f),_=e.context.reflectedLight;t.direct({lightDirection:c,lightColor:v,reflectedLight:_},e.stack,e)}}x("SpotLightNode",an);vt(Pn,an);class Ql extends Pn{constructor(e,t,s,o,i,r){super(e,t,s,o,i,r),this.iesMap=null}copy(e,t){return super.copy(e,t),this.iesMap=e.iesMap,this}}const ed=Ql;class Ci extends an{getSpotAttenuation(e){const t=this.light.iesMap;let s=null;if(t&&t.isTexture===!0){const o=e.acos().mul(1/Math.PI);s=De(t,L(o,0),0).r}else s=super.getSpotAttenuation(e);return s}}x("IESSpotLightNode",Ci);vt(ed,Ci);class Ii extends ut{constructor(e=null){super(e)}setup({context:e}){e.irradiance.addAssign(this.colorNode)}}x("AmbientLightNode",Ii);vt(Jr,Ii);class Oi extends ut{constructor(e=null){super(e),this.lightPositionNode=ws(e),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=J(new Ds)}update(e){const{light:t}=this;super.update(e),this.lightPositionNode.object3d=t,this.groundColorNode.value.copy(t.groundColor).multiplyScalar(t.intensity)}setup(e){const{colorNode:t,groundColorNode:s,lightDirectionNode:o}=this,r=Ye.dot(o).mul(.5).add(.5),a=Ge(s,t,r);e.context.irradiance.addAssign(a)}}x("HemisphereLightNode",Oi);vt(Zr,Oi);const td=T(n=>{const e=n.uv.mul(2),t=e.x.floor(),s=e.y.floor();return t.add(s).mod(2).sign()});class bi extends ${constructor(e=Ze()){super("float"),this.uvNode=e}setup(){return td({uv:this.uvNode})}}const sd=N(bi);g("checker",sd);x("CheckerNode",bi);const nd=new Un;class od extends Oe{constructor(e={}){super(),this.normals=!1,this.lights=!1,this.useAlphaToCoverage=!0,this.useColor=e.vertexColors,this.pointWidth=1,this.pointColorNode=null,this.setDefaultValues(nd),this.setupShaders(),this.setValues(e)}setupShaders(){const e=this.alphaToCoverage,t=this.useColor;this.vertexNode=T(()=>{Y(L(),"vUv").assign(Ze());const s=ge("instancePosition"),o=we("vec4","mvPos");o.assign(rt.mul(P(s,1)));const i=gt.z.div(gt.w),r=ke.mul(o),a=we("vec2","offset");return a.assign(Ne.xy),a.assign(a.mul(Su)),a.assign(a.div(gt.z)),a.y.assign(a.y.mul(i)),a.assign(a.mul(r.w)),r.assign(r.add(P(a,0,0))),r})(),this.fragmentNode=T(()=>{const s=Y(L(),"vUv"),o=we("float","alpha");o.assign(1);const i=s.x,r=s.y,a=i.mul(i).add(r.mul(r));if(e){const u=we("float","dlen");u.assign(a.fwidth()),o.assign(ot(u.oneMinus(),u.add(1),a).oneMinus())}else a.greaterThan(1).discard();let c;return this.pointColorNode?c=this.pointColorNode:t?c=ge("instanceColor").mul(Ot):c=Ot,P(c,o)})(),this.needsUpdate=!0}get alphaToCoverage(){return this.useAlphaToCoverage}set alphaToCoverage(e){this.useAlphaToCoverage!==e&&(this.useAlphaToCoverage=e,this.setupShaders())}}Me("InstancedPointsNodeMaterial",od);const id=new Kr;class rd extends Oe{constructor(e){super(),this.isLineBasicNodeMaterial=!0,this.lights=!1,this.normals=!1,this.setDefaultValues(id),this.setValues(e)}}Me("LineBasicNodeMaterial",rd);const ad=new Bn;class cd extends Oe{constructor(e){super(),this.isLineDashedNodeMaterial=!0,this.lights=!1,this.normals=!1,this.setDefaultValues(ad),this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(e)}setupVariants(){const e=this.offsetNode,t=this.dashScaleNode?h(this.dashScaleNode):Ls,s=this.dashSizeNode?h(this.dashSizeNode):Ao,o=this.dashSizeNode?h(this.dashGapNode):Ro;ft.assign(s),qt.assign(o);const i=Y(ge("lineDistance").mul(t));(e?i.add(e):i).mod(ft.add(qt)).greaterThan(ft).discard()}}Me("LineDashedNodeMaterial",cd);const ud=new Bn;class ld extends Oe{constructor(e={}){super(),this.normals=!1,this.lights=!1,this.setDefaultValues(ud),this.useAlphaToCoverage=!0,this.useColor=e.vertexColors,this.useDash=e.dashed,this.useWorldUnits=!1,this.dashOffset=0,this.lineWidth=1,this.lineColorNode=null,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setupShaders(),this.setValues(e)}setupShaders(){const e=this.alphaToCoverage,t=this.useColor,s=this.dashed,o=this.worldUnits,i=T(({start:a,end:c})=>{const u=ke.element(2).element(2),f=ke.element(3).element(2).mul(-.5).div(u).sub(a.z).div(c.z.sub(a.z));return P(Ge(a.xyz,c.xyz,f),c.w)});this.vertexNode=T(()=>{Xe("vec2","vUv").assign(Ze());const a=ge("instanceStart"),c=ge("instanceEnd"),u=we("vec4","start"),l=we("vec4","end");u.assign(rt.mul(P(a,1))),l.assign(rt.mul(P(c,1))),o&&(Xe("vec3","worldStart").assign(u.xyz),Xe("vec3","worldEnd").assign(l.xyz));const p=gt.z.div(gt.w),f=ke.element(2).element(3).equal(-1);W(f,()=>{W(u.z.lessThan(0).and(l.z.greaterThan(0)),()=>{l.assign(i({start:u,end:l}))}).elseif(l.z.lessThan(0).and(u.z.greaterThanEqual(0)),()=>{u.assign(i({start:l,end:u}))})});const v=ke.mul(u),_=ke.mul(l),E=v.xyz.div(v.w),O=_.xyz.div(_.w),w=O.xy.sub(E.xy).temp();w.x.assign(w.x.mul(p)),w.assign(w.normalize());const b=Lt(P());if(o){const C=l.xyz.sub(u.xyz).normalize(),D=Ne.y.lessThan(.5).cond(u.xyz.cross(C).normalize(),l.xyz.cross(C).normalize());D.assign(Ne.x.lessThan(0).cond(D.negate(),D));const le=C.dot(y(0,0,1));s||(u.assign(u.sub(P(C.mul(St).mul(.5),0))),l.assign(l.add(P(C.mul(St).mul(.5),0))),D.assign(D.sub(y(w.mul(le),0))),D.z.assign(D.z.add(.5))),W(Ne.y.greaterThan(1).or(Ne.y.lessThan(0)),()=>{D.assign(D.add(y(w.mul(2).mul(le),0)))}),D.assign(D.mul(St).mul(.5));const F=Xe("vec4","worldPos");F.assign(Ne.y.lessThan(.5).cond(u,l)),F.assign(F.add(P(D,0))),b.assign(ke.mul(F));const oe=Lt(y());oe.assign(Ne.y.lessThan(.5).cond(E,O)),b.z.assign(oe.z.mul(b.w))}else{const C=we("vec2","offset");C.assign(L(w.y,w.x.negate())),w.x.assign(w.x.div(p)),C.x.assign(C.x.div(p)),C.assign(Ne.x.lessThan(0).cond(C.negate(),C)),W(Ne.y.lessThan(0),()=>{C.assign(C.sub(w))}).elseif(Ne.y.greaterThan(1),()=>{C.assign(C.add(w))}),C.assign(C.mul(St)),C.assign(C.div(gt.w)),b.assign(Ne.y.lessThan(.5).cond(v,_)),C.assign(C.mul(b.w)),b.assign(b.add(P(C,0,0)))}return b})();const r=T(({p1:a,p2:c,p3:u,p4:l})=>{const p=a.sub(u),f=l.sub(u),v=c.sub(a),_=p.dot(f),E=f.dot(v),O=p.dot(v),w=f.dot(f),C=v.dot(v).mul(w).sub(E.mul(E)),le=_.mul(E).sub(O.mul(w)).div(C).clamp(),F=_.add(E.mul(le)).div(w).clamp();return L(le,F)});this.fragmentNode=T(()=>{const a=Xe("vec2","vUv");if(s){const l=this.offsetNode?h(this.offsetNodeNode):xn,p=this.dashScaleNode?h(this.dashScaleNode):Ls,f=this.dashSizeNode?h(this.dashSizeNode):Ao,v=this.dashSizeNode?h(this.dashGapNode):Ro;ft.assign(f),qt.assign(v);const _=ge("instanceDistanceStart"),E=ge("instanceDistanceEnd"),O=Ne.y.lessThan(.5).cond(p.mul(_),Ls.mul(E)),w=Y(O.add(xn)),b=l?w.add(l):w;a.y.lessThan(-1).or(a.y.greaterThan(1)).discard(),b.mod(ft.add(qt)).greaterThan(ft).discard()}const c=we("float","alpha");if(c.assign(1),o){const l=Xe("vec3","worldStart"),p=Xe("vec3","worldEnd"),f=Xe("vec4","worldPos").xyz.normalize().mul(1e5),v=p.sub(l),_=r({p1:l,p2:p,p3:y(0,0,0),p4:f}),E=l.add(v.mul(_.x)),O=f.mul(_.y),C=E.sub(O).length().div(St);if(!s)if(e){const D=C.fwidth();c.assign(ot(D.negate().add(.5),D.add(.5),C).oneMinus())}else C.greaterThan(.5).discard()}else if(e){const l=a.x,p=a.y.greaterThan(0).cond(a.y.sub(1),a.y.add(1)),f=l.mul(l).add(p.mul(p)),v=we("float","dlen");v.assign(f.fwidth()),W(a.y.abs().greaterThan(1),()=>{c.assign(ot(v.oneMinus(),v.add(1),f).oneMinus())})}else W(a.y.abs().greaterThan(1),()=>{const l=a.x,p=a.y.greaterThan(0).cond(a.y.sub(1),a.y.add(1));l.mul(l).add(p.mul(p)).greaterThan(1).discard()});let u;if(this.lineColorNode)u=this.lineColorNode;else if(t){const l=ge("instanceColorStart"),p=ge("instanceColorEnd");u=Ne.y.lessThan(.5).cond(l,p).mul(Ot)}else u=Ot;return P(u,c)})(),this.needsUpdate=!0}get worldUnits(){return this.useWorldUnits}set worldUnits(e){this.useWorldUnits!==e&&(this.useWorldUnits=e,this.setupShaders())}get dashed(){return this.useDash}set dashed(e){this.useDash!==e&&(this.useDash=e,this.setupShaders())}get alphaToCoverage(){return this.useAlphaToCoverage}set alphaToCoverage(e){this.useAlphaToCoverage!==e&&(this.useAlphaToCoverage=e,this.setupShaders())}}Me("Line2NodeMaterial",ld);const dd=new Qr;class hd extends Oe{constructor(e){super(),this.isMeshNormalNodeMaterial=!0,this.colorSpaced=!1,this.setDefaultValues(dd),this.setValues(e)}setupDiffuseColor(){const e=this.opacityNode?h(this.opacityNode):Eo;fe.assign(P(oi(K),e))}}Me("MeshNormalNodeMaterial",hd);const pd=new ea;class md extends Oe{constructor(e){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!1,this.setDefaultValues(pd),this.setValues(e)}}Me("MeshBasicNodeMaterial",md);const bt=T(({f0:n,f90:e,dotVH:t})=>{const s=t.mul(-5.55473).sub(6.98316).mul(t).exp2();return n.mul(s.oneMinus()).add(e.mul(s))}),Kt=T(n=>n.diffuseColor.mul(1/Math.PI)),fd=()=>h(.25),gd=T(({dotNH:n})=>Rs.mul(.5/Math.PI).add(1).mul(n.pow(Rs))),Nd=T(({lightDirection:n})=>{const e=n.add(ae).normalize(),t=K.dot(e).clamp(),s=ae.dot(e).clamp(),o=bt({f0:We,f90:1,dotVH:s}),i=fd(),r=gd({dotNH:t});return o.mul(i).mul(r)});class Di extends io{constructor(e=!0){super(),this.specular=e}direct({lightDirection:e,lightColor:t,reflectedLight:s}){const i=K.dot(e).clamp().mul(t);s.directDiffuse.addAssign(i.mul(Kt({diffuseColor:fe.rgb}))),this.specular===!0&&s.directSpecular.addAssign(i.mul(Nd({lightDirection:e})).mul(du))}indirectDiffuse({irradiance:e,reflectedLight:t}){t.indirectDiffuse.addAssign(e.mul(Kt({diffuseColor:fe})))}}const yd=new ta;class xd extends Oe{constructor(e){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(yd),this.setValues(e)}setupLightingModel(){return new Di(!1)}}Me("MeshLambertNodeMaterial",xd);const Td=new sa;class vd extends Oe{constructor(e){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(Td),this.setValues(e)}setupLightingModel(){return new Di}setupVariants(){const e=(this.shininessNode?h(this.shininessNode):cu).max(1e-4);Rs.assign(e);const t=this.specularNode||lu;We.assign(t)}copy(e){return this.shininessNode=e.shininessNode,this.specularNode=e.specularNode,super.copy(e)}}Me("MeshPhongNodeMaterial",vd);const _d=T(()=>{const n=Yt.dFdx().abs().max(Yt.dFdy().abs());return n.x.max(n.y).max(n.z)}),Vd=T(n=>{const{roughness:e}=n,t=_d();let s=e.max(.0525);return s=s.add(t),s=s.min(1),s}),Sd=T(n=>{const{alpha:e,dotNL:t,dotNV:s}=n,o=e.pow2(),i=t.mul(o.add(o.oneMinus().mul(s.pow2())).sqrt()),r=s.mul(o.add(o.oneMinus().mul(t.pow2())).sqrt());return Ct(.5,i.add(r).max(mo))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),Md=T(({alpha:n,dotNH:e})=>{const t=n.pow2(),s=e.pow2().mul(t.oneMinus()).oneMinus();return t.div(s.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),Cn=T(n=>{const{lightDirection:e,f0:t,f90:s,roughness:o,iridescenceFresnel:i}=n,r=n.normalView||K,a=o.pow2(),c=e.add(ae).normalize(),u=r.dot(e).clamp(),l=r.dot(ae).clamp(),p=r.dot(c).clamp(),f=ae.dot(c).clamp();let v=bt({f0:t,f90:s,dotVH:f});i&&(v=qs.mix(v,i));const _=Sd({alpha:a,dotNL:u,dotNV:l}),E=Md({alpha:a,dotNH:p});return v.mul(_).mul(E)}),zi=T(({roughness:n,dotNV:e})=>{const t=P(-1,-.0275,-.572,.022),s=P(1,.0425,1.04,-.04),o=n.mul(t).add(s),i=o.x.mul(o.x).min(e.mul(-9.28).exp2()).mul(o.x).add(o.y);return L(-1.04,1.04).mul(i).add(o.zw)}).setLayout({name:"DFGApprox",type:"vec2",inputs:[{name:"roughness",type:"float"},{name:"dotNV",type:"vec3"}]}),Ed=T(n=>{const{dotNV:e,specularColor:t,specularF90:s,roughness:o}=n,i=zi({dotNV:e,roughness:o});return t.mul(i.x).add(s.mul(i.y))}),Ad=T(({f:n,f90:e,dotVH:t})=>{const s=t.oneMinus().saturate(),o=s.mul(s),i=s.mul(o,o).clamp(0,.9999);return n.sub(y(e).mul(i)).div(i.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),Rd=T(({roughness:n,dotNH:e})=>{const t=n.pow2(),s=h(1).div(t),i=e.pow2().oneMinus().max(.0078125);return h(2).add(s).mul(i.pow(s.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),wd=T(({dotNV:n,dotNL:e})=>h(1).div(h(4).mul(e.add(n).sub(e.mul(n))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),Ld=T(({lightDirection:n})=>{const e=n.add(ae).normalize(),t=K.dot(n).clamp(),s=K.dot(ae).clamp(),o=K.dot(e).clamp(),i=Rd({roughness:Xs,dotNH:o}),r=wd({dotNV:s,dotNL:t});return ht.mul(i).mul(r)}),Cd=xt(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),Id=n=>{const e=n.sqrt();return y(1).add(e).div(y(1).sub(e))},In=(n,e)=>n.sub(e).div(n.add(e)).pow2(),Od=(n,e)=>{const t=n.mul(2*Math.PI*1e-9),s=y(54856e-17,44201e-17,52481e-17),o=y(1681e3,1795300,2208400),i=y(43278e5,93046e5,66121e5),r=h(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(t.mul(2239900).add(e.x).cos()).mul(t.pow2().mul(-45282e5).exp());let a=s.mul(i.mul(2*Math.PI).sqrt()).mul(o.mul(t).add(e).cos()).mul(t.pow2().negate().mul(i).exp());return a=y(a.x.add(r),a.y,a.z).div(10685e-11),Cd.mul(a)},bd=T(({outsideIOR:n,eta2:e,cosTheta1:t,thinFilmThickness:s,baseF0:o})=>{const i=Ge(n,e,ot(0,.03,s)),r=n.div(i).pow2().mul(h(1).sub(t.pow2())),c=h(1).sub(r).sqrt(),u=In(i,n),l=bt({f0:u,f90:1,dotVH:t}),p=l.oneMinus(),f=i.lessThan(n).cond(Math.PI,0),v=h(Math.PI).sub(f),_=Id(o.clamp(0,.9999)),E=In(_,i.vec3()),O=bt({f0:E,f90:1,dotVH:c}),w=y(_.x.lessThan(i).cond(Math.PI,0),_.y.lessThan(i).cond(Math.PI,0),_.z.lessThan(i).cond(Math.PI,0)),b=i.mul(s,c,2),C=y(v).add(w),D=l.mul(O).clamp(1e-5,.9999),le=D.sqrt(),F=p.pow2().mul(O).div(y(1).sub(D));let ie=l.add(F),us=F.sub(p);for(let Wt=1;Wt<=2;++Wt){us=us.mul(le);const vr=Od(h(Wt).mul(b),h(Wt).mul(C)).mul(2);ie=ie.add(us.mul(vr))}return ie.max(y(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),Dd=T(({normal:n,viewDir:e,roughness:t})=>{const s=n.dot(e).saturate(),o=t.pow2(),i=je(t.lessThan(.25),h(-339.2).mul(o).add(h(161.4).mul(t)).sub(25.9),h(-8.48).mul(o).add(h(14.3).mul(t)).sub(9.95)),r=je(t.lessThan(.25),h(44).mul(o).sub(h(23.7).mul(t)).add(3.26),h(1.97).mul(o).sub(h(3.27).mul(t)).add(.72));return je(t.lessThan(.25),0,h(.1).mul(t).sub(.025)).add(i.mul(s).add(r).exp()).mul(1/Math.PI).saturate()}),vs=y(.04),_s=y(1);class Fi extends io{constructor(e=!1,t=!1,s=!1){super(),this.clearcoat=e,this.sheen=t,this.iridescence=s,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null}start(){if(this.clearcoat===!0&&(this.clearcoatRadiance=y().temp("clearcoatRadiance"),this.clearcoatSpecularDirect=y().temp("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=y().temp("clearcoatSpecularIndirect")),this.sheen===!0&&(this.sheenSpecularDirect=y().temp("sheenSpecularDirect"),this.sheenSpecularIndirect=y().temp("sheenSpecularIndirect")),this.iridescence===!0){const e=K.dot(ae).clamp();this.iridescenceFresnel=bd({outsideIOR:h(1),eta2:ao,cosTheta1:e,thinFilmThickness:co,baseF0:We}),this.iridescenceF0=Ad({f:this.iridescenceFresnel,f90:1,dotVH:e})}}computeMultiscattering(e,t,s=h(1)){const o=K.dot(ae).clamp(),i=zi({roughness:Rt,dotNV:o}),a=(this.iridescenceF0?qs.mix(We,this.iridescenceF0):We).mul(i.x).add(s.mul(i.y)),u=i.x.add(i.y).oneMinus(),l=We.add(We.oneMinus().mul(.047619)),p=a.mul(l).div(u.mul(l).oneMinus());e.addAssign(a),t.addAssign(p.mul(u))}direct({lightDirection:e,lightColor:t,reflectedLight:s}){const i=K.dot(e).clamp().mul(t);if(this.sheen===!0&&this.sheenSpecularDirect.addAssign(i.mul(Ld({lightDirection:e}))),this.clearcoat===!0){const a=pt.dot(e).clamp().mul(t);this.clearcoatSpecularDirect.addAssign(a.mul(Cn({lightDirection:e,f0:vs,f90:_s,roughness:Xt,normalView:pt})))}s.directDiffuse.addAssign(i.mul(Kt({diffuseColor:fe.rgb}))),s.directSpecular.addAssign(i.mul(Cn({lightDirection:e,f0:We,f90:1,roughness:Rt,iridescence:this.iridescence,iridescenceFresnel:this.iridescenceFresnel})))}indirectDiffuse({irradiance:e,reflectedLight:t}){t.indirectDiffuse.addAssign(e.mul(Kt({diffuseColor:fe})))}indirectSpecular({radiance:e,iblIrradiance:t,reflectedLight:s}){if(this.sheen===!0&&this.sheenSpecularIndirect.addAssign(t.mul(ht,Dd({normal:K,viewDir:ae,roughness:Xs}))),this.clearcoat===!0){const u=pt.dot(ae).clamp(),l=Ed({dotNV:u,specularColor:vs,specularF90:_s,roughness:Xt});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(l))}const o=y().temp("singleScattering"),i=y().temp("multiScattering"),r=t.mul(1/Math.PI);this.computeMultiscattering(o,i);const a=o.add(i),c=fe.mul(a.r.max(a.g).max(a.b).oneMinus());s.indirectSpecular.addAssign(e.mul(o)),s.indirectSpecular.addAssign(i.mul(r)),s.indirectDiffuse.addAssign(c.mul(r))}ambientOcclusion({ambientOcclusion:e,reflectedLight:t}){const o=K.dot(ae).clamp().add(e),i=Rt.mul(-16).oneMinus().negate().exp2(),r=e.sub(o.pow(i).oneMinus()).clamp();this.clearcoat===!0&&this.clearcoatSpecularIndirect.mulAssign(e),this.sheen===!0&&this.sheenSpecularIndirect.mulAssign(e),t.indirectDiffuse.mulAssign(e),t.indirectSpecular.mulAssign(r)}finish(e){const{outgoingLight:t}=e;if(this.clearcoat===!0){const s=pt.dot(ae).clamp(),o=bt({dotVH:s,f0:vs,f90:_s}),i=t.mul(As.mul(o).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(As));t.assign(i)}if(this.sheen===!0){const s=ht.r.max(ht.g).max(ht.b).mul(.157).oneMinus(),o=t.mul(s).add(this.sheenSpecularDirect,this.sheenSpecularIndirect);t.assign(o)}}}const zd=new na;class Pi extends Oe{constructor(e){super(),this.isMeshStandardNodeMaterial=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(zd),this.setValues(e)}setupLightingModel(){return new Fi}setupVariants(){const e=this.metalnessNode?h(this.metalnessNode):pu;ja.assign(e);let t=this.roughnessNode?h(this.roughnessNode):hu;t=Vd({roughness:t}),Rt.assign(t);const s=Ge(y(.04),fe.rgb,e);We.assign(s),fe.assign(P(fe.rgb.mul(e.oneMinus()),fe.a))}copy(e){return this.emissiveNode=e.emissiveNode,this.metalnessNode=e.metalnessNode,this.roughnessNode=e.roughnessNode,super.copy(e)}}Me("MeshStandardNodeMaterial",Pi);const Fd=new oa;class Pd extends Pi{constructor(e){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.setDefaultValues(Fd),this.setValues(e)}get useClearcoat(){return this.clearcoat>0||this.clearcoatNode!==null}get useIridescence(){return this.iridescence>0||this.iridescenceNode!==null}get useSheen(){return this.sheen>0||this.sheenNode!==null}setupLightingModel(){return new Fi(this.useClearcoat,this.useSheen,this.useIridescence)}setupVariants(e){if(super.setupVariants(e),this.useClearcoat){const t=this.clearcoatNode?h(this.clearcoatNode):fu,s=this.clearcoatRoughnessNode?h(this.clearcoatRoughnessNode):gu;As.assign(t),Xt.assign(s)}if(this.useSheen){const t=this.sheenNode?y(this.sheenNode):xu,s=this.sheenRoughnessNode?h(this.sheenRoughnessNode):Tu;ht.assign(t),Xs.assign(s)}if(this.useIridescence){const t=this.iridescenceNode?h(this.iridescenceNode):vu,s=this.iridescenceIORNode?h(this.iridescenceIORNode):_u,o=this.iridescenceThicknessNode?h(this.iridescenceThicknessNode):Vu;qs.assign(t),ao.assign(s),co.assign(o)}}setupNormal(e){super.setupNormal(e);const t=this.clearcoatNormalNode?y(this.clearcoatNormalNode):Nu;pt.assign(t)}copy(e){return this.clearcoatNode=e.clearcoatNode,this.clearcoatRoughnessNode=e.clearcoatRoughnessNode,this.clearcoatNormalNode=e.clearcoatNormalNode,this.sheenNode=e.sheenNode,this.sheenRoughnessNode=e.sheenRoughnessNode,this.iridescenceNode=e.iridescenceNode,this.iridescenceIORNode=e.iridescenceIORNode,this.iridescenceThicknessNode=e.iridescenceThicknessNode,this.specularIntensityNode=e.specularIntensityNode,this.specularColorNode=e.specularColorNode,this.transmissionNode=e.transmissionNode,this.thicknessNode=e.thicknessNode,this.attenuationDistanceNode=e.attenuationDistanceNode,this.attenuationColorNode=e.attenuationColorNode,super.copy(e)}}Me("MeshPhysicalNodeMaterial",Pd);const Ud=new Un;class Bd extends Oe{constructor(e){super(),this.isPointsNodeMaterial=!0,this.lights=!1,this.normals=!1,this.transparent=!0,this.sizeNode=null,this.setDefaultValues(Ud),this.setValues(e)}copy(e){return this.sizeNode=e.sizeNode,super.copy(e)}}Me("PointsNodeMaterial",Bd);const Gd=new ia;class Wd extends Oe{constructor(e){super(),this.isSpriteNodeMaterial=!0,this.lights=!1,this.normals=!1,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.setDefaultValues(Gd),this.setValues(e)}setupPosition({object:e,context:t}){const{positionNode:s,rotationNode:o,scaleNode:i}=this,r=ve;let a=rt.mul(y(s||0)),c=L(jt[0].xyz.length(),jt[1].xyz.length());i!==null&&(c=c.mul(i));let u=r.xy;e.center&&e.center.isVector2===!0&&(u=u.sub(J(e.center).sub(.5))),u=u.mul(c);const l=h(o||yu),p=l.cos(),f=l.sin(),v=L(L(p,f.negate()).dot(u),L(f,p).dot(u));a=P(a.xy.add(v),a.zw);const _=ke.mul(a);return t.vertex=r,_}copy(e){return this.positionNode=e.positionNode,this.rotationNode=e.rotationNode,this.scaleNode=e.scaleNode,super.copy(e)}}Me("SpriteNodeMaterial",Wd);const Nt=T(([n,e,t])=>{const s=h(t).toVar(),o=h(e).toVar(),i=st(n).toVar();return je(i,o,s)}),Dt=T(([n,e])=>{const t=st(e).toVar(),s=h(n).toVar();return je(t,s.negate(),s)}),q=T(([n])=>{const e=h(n).toVar();return d(Ft(e))}),k=T(([n,e])=>{const t=h(n).toVar();return e.assign(q(t)),t.sub(h(e))}),Ui=T(([n,e,t,s,o,i])=>{const r=h(i).toVar(),a=h(o).toVar(),c=h(s).toVar(),u=h(t).toVar(),l=h(e).toVar(),p=h(n).toVar(),f=h(de(1,a)).toVar();return de(1,r).mul(p.mul(f).add(l.mul(a))).add(r.mul(u.mul(f).add(c.mul(a))))}),Bi=T(([n,e,t,s,o,i])=>{const r=h(i).toVar(),a=h(o).toVar(),c=y(s).toVar(),u=y(t).toVar(),l=y(e).toVar(),p=y(n).toVar(),f=h(de(1,a)).toVar();return de(1,r).mul(p.mul(f).add(l.mul(a))).add(r.mul(u.mul(f).add(c.mul(a))))}),Gi=be([Ui,Bi]),Wi=T(([n,e,t,s,o,i,r,a,c,u,l])=>{const p=h(l).toVar(),f=h(u).toVar(),v=h(c).toVar(),_=h(a).toVar(),E=h(r).toVar(),O=h(i).toVar(),w=h(o).toVar(),b=h(s).toVar(),C=h(t).toVar(),D=h(e).toVar(),le=h(n).toVar(),F=h(de(1,v)).toVar(),oe=h(de(1,f)).toVar();return h(de(1,p)).toVar().mul(oe.mul(le.mul(F).add(D.mul(v))).add(f.mul(C.mul(F).add(b.mul(v))))).add(p.mul(oe.mul(w.mul(F).add(O.mul(v))).add(f.mul(E.mul(F).add(_.mul(v))))))}),ki=T(([n,e,t,s,o,i,r,a,c,u,l])=>{const p=h(l).toVar(),f=h(u).toVar(),v=h(c).toVar(),_=y(a).toVar(),E=y(r).toVar(),O=y(i).toVar(),w=y(o).toVar(),b=y(s).toVar(),C=y(t).toVar(),D=y(e).toVar(),le=y(n).toVar(),F=h(de(1,v)).toVar(),oe=h(de(1,f)).toVar();return h(de(1,p)).toVar().mul(oe.mul(le.mul(F).add(D.mul(v))).add(f.mul(C.mul(F).add(b.mul(v))))).add(p.mul(oe.mul(w.mul(F).add(O.mul(v))).add(f.mul(E.mul(F).add(_.mul(v))))))}),Hi=be([Wi,ki]),$i=T(([n,e,t])=>{const s=h(t).toVar(),o=h(e).toVar(),i=M(n).toVar(),r=M(i.bitAnd(M(7))).toVar(),a=h(Nt(r.lessThan(M(4)),o,s)).toVar(),c=h(X(2,Nt(r.lessThan(M(4)),s,o))).toVar();return Dt(a,st(r.bitAnd(M(1)))).add(Dt(c,st(r.bitAnd(M(2)))))}),Xi=T(([n,e,t,s])=>{const o=h(s).toVar(),i=h(t).toVar(),r=h(e).toVar(),a=M(n).toVar(),c=M(a.bitAnd(M(15))).toVar(),u=h(Nt(c.lessThan(M(8)),r,i)).toVar(),l=h(Nt(c.lessThan(M(4)),i,Nt(c.equal(M(12)).or(c.equal(M(14))),r,o))).toVar();return Dt(u,st(c.bitAnd(M(1)))).add(Dt(l,st(c.bitAnd(M(2)))))}),re=be([$i,Xi]),qi=T(([n,e,t])=>{const s=h(t).toVar(),o=h(e).toVar(),i=zt(n).toVar();return y(re(i.x,o,s),re(i.y,o,s),re(i.z,o,s))}),ji=T(([n,e,t,s])=>{const o=h(s).toVar(),i=h(t).toVar(),r=h(e).toVar(),a=zt(n).toVar();return y(re(a.x,r,i,o),re(a.y,r,i,o),re(a.z,r,i,o))}),Ee=be([qi,ji]),Yi=T(([n])=>{const e=h(n).toVar();return X(.6616,e)}),Ji=T(([n])=>{const e=h(n).toVar();return X(.982,e)}),Zi=T(([n])=>{const e=y(n).toVar();return X(.6616,e)}),Ki=be([Yi,Zi]),Qi=T(([n])=>{const e=y(n).toVar();return X(.982,e)}),er=be([Ji,Qi]),xe=T(([n,e])=>{const t=d(e).toVar(),s=M(n).toVar();return s.shiftLeft(t).bitOr(s.shiftRight(d(32).sub(t)))}),tr=T(([n,e,t])=>{n.subAssign(t),n.bitXorAssign(xe(t,d(4))),t.addAssign(e),e.subAssign(n),e.bitXorAssign(xe(n,d(6))),n.addAssign(t),t.subAssign(e),t.bitXorAssign(xe(e,d(8))),e.addAssign(n),n.subAssign(t),n.bitXorAssign(xe(t,d(16))),t.addAssign(e),e.subAssign(n),e.bitXorAssign(xe(n,d(19))),n.addAssign(t),t.subAssign(e),t.bitXorAssign(xe(e,d(4))),e.addAssign(n)}),_t=T(([n,e,t])=>{const s=M(t).toVar(),o=M(e).toVar(),i=M(n).toVar();return s.bitXorAssign(o),s.subAssign(xe(o,d(14))),i.bitXorAssign(s),i.subAssign(xe(s,d(11))),o.bitXorAssign(i),o.subAssign(xe(i,d(25))),s.bitXorAssign(o),s.subAssign(xe(o,d(16))),i.bitXorAssign(s),i.subAssign(xe(s,d(4))),o.bitXorAssign(i),o.subAssign(xe(i,d(14))),s.bitXorAssign(o),s.subAssign(xe(o,d(24))),s}),pe=T(([n])=>{const e=M(n).toVar();return h(e).div(h(M(d(4294967295))))}),Fe=T(([n])=>{const e=h(n).toVar();return e.mul(e.mul(e.mul(e.mul(e.mul(6).sub(15)).add(10))))}),sr=T(([n])=>{const e=d(n).toVar(),t=M(M(1)).toVar(),s=M(M(d(3735928559)).add(t.shiftLeft(M(2)).add(M(13)))).toVar();return _t(s.add(M(e)),s,s)}),nr=T(([n,e])=>{const t=d(e).toVar(),s=d(n).toVar(),o=M(M(2)).toVar(),i=M().toVar(),r=M().toVar(),a=M().toVar();return i.assign(r.assign(a.assign(M(d(3735928559)).add(o.shiftLeft(M(2)).add(M(13)))))),i.addAssign(M(s)),r.addAssign(M(t)),_t(i,r,a)}),or=T(([n,e,t])=>{const s=d(t).toVar(),o=d(e).toVar(),i=d(n).toVar(),r=M(M(3)).toVar(),a=M().toVar(),c=M().toVar(),u=M().toVar();return a.assign(c.assign(u.assign(M(d(3735928559)).add(r.shiftLeft(M(2)).add(M(13)))))),a.addAssign(M(i)),c.addAssign(M(o)),u.addAssign(M(s)),_t(a,c,u)}),ir=T(([n,e,t,s])=>{const o=d(s).toVar(),i=d(t).toVar(),r=d(e).toVar(),a=d(n).toVar(),c=M(M(4)).toVar(),u=M().toVar(),l=M().toVar(),p=M().toVar();return u.assign(l.assign(p.assign(M(d(3735928559)).add(c.shiftLeft(M(2)).add(M(13)))))),u.addAssign(M(a)),l.addAssign(M(r)),p.addAssign(M(i)),tr(u,l,p),u.addAssign(M(o)),_t(u,l,p)}),rr=T(([n,e,t,s,o])=>{const i=d(o).toVar(),r=d(s).toVar(),a=d(t).toVar(),c=d(e).toVar(),u=d(n).toVar(),l=M(M(5)).toVar(),p=M().toVar(),f=M().toVar(),v=M().toVar();return p.assign(f.assign(v.assign(M(d(3735928559)).add(l.shiftLeft(M(2)).add(M(13)))))),p.addAssign(M(u)),f.addAssign(M(c)),v.addAssign(M(a)),tr(p,f,v),p.addAssign(M(r)),f.addAssign(M(i)),_t(p,f,v)}),B=be([sr,nr,or,ir,rr]),ar=T(([n,e])=>{const t=d(e).toVar(),s=d(n).toVar(),o=M(B(s,t)).toVar(),i=zt().toVar();return i.x.assign(o.bitAnd(d(255))),i.y.assign(o.shiftRight(d(8)).bitAnd(d(255))),i.z.assign(o.shiftRight(d(16)).bitAnd(d(255))),i}),cr=T(([n,e,t])=>{const s=d(t).toVar(),o=d(e).toVar(),i=d(n).toVar(),r=M(B(i,o,s)).toVar(),a=zt().toVar();return a.x.assign(r.bitAnd(d(255))),a.y.assign(r.shiftRight(d(8)).bitAnd(d(255))),a.z.assign(r.shiftRight(d(16)).bitAnd(d(255))),a}),Ae=be([ar,cr]),ur=T(([n])=>{const e=L(n).toVar(),t=d().toVar(),s=d().toVar(),o=h(k(e.x,t)).toVar(),i=h(k(e.y,s)).toVar(),r=h(Fe(o)).toVar(),a=h(Fe(i)).toVar(),c=h(Gi(re(B(t,s),o,i),re(B(t.add(d(1)),s),o.sub(1),i),re(B(t,s.add(d(1))),o,i.sub(1)),re(B(t.add(d(1)),s.add(d(1))),o.sub(1),i.sub(1)),r,a)).toVar();return Ki(c)}),lr=T(([n])=>{const e=y(n).toVar(),t=d().toVar(),s=d().toVar(),o=d().toVar(),i=h(k(e.x,t)).toVar(),r=h(k(e.y,s)).toVar(),a=h(k(e.z,o)).toVar(),c=h(Fe(i)).toVar(),u=h(Fe(r)).toVar(),l=h(Fe(a)).toVar(),p=h(Hi(re(B(t,s,o),i,r,a),re(B(t.add(d(1)),s,o),i.sub(1),r,a),re(B(t,s.add(d(1)),o),i,r.sub(1),a),re(B(t.add(d(1)),s.add(d(1)),o),i.sub(1),r.sub(1),a),re(B(t,s,o.add(d(1))),i,r,a.sub(1)),re(B(t.add(d(1)),s,o.add(d(1))),i.sub(1),r,a.sub(1)),re(B(t,s.add(d(1)),o.add(d(1))),i,r.sub(1),a.sub(1)),re(B(t.add(d(1)),s.add(d(1)),o.add(d(1))),i.sub(1),r.sub(1),a.sub(1)),c,u,l)).toVar();return er(p)}),kd=be([ur,lr]),dr=T(([n])=>{const e=L(n).toVar(),t=d().toVar(),s=d().toVar(),o=h(k(e.x,t)).toVar(),i=h(k(e.y,s)).toVar(),r=h(Fe(o)).toVar(),a=h(Fe(i)).toVar(),c=y(Gi(Ee(Ae(t,s),o,i),Ee(Ae(t.add(d(1)),s),o.sub(1),i),Ee(Ae(t,s.add(d(1))),o,i.sub(1)),Ee(Ae(t.add(d(1)),s.add(d(1))),o.sub(1),i.sub(1)),r,a)).toVar();return Ki(c)}),hr=T(([n])=>{const e=y(n).toVar(),t=d().toVar(),s=d().toVar(),o=d().toVar(),i=h(k(e.x,t)).toVar(),r=h(k(e.y,s)).toVar(),a=h(k(e.z,o)).toVar(),c=h(Fe(i)).toVar(),u=h(Fe(r)).toVar(),l=h(Fe(a)).toVar(),p=y(Hi(Ee(Ae(t,s,o),i,r,a),Ee(Ae(t.add(d(1)),s,o),i.sub(1),r,a),Ee(Ae(t,s.add(d(1)),o),i,r.sub(1),a),Ee(Ae(t.add(d(1)),s.add(d(1)),o),i.sub(1),r.sub(1),a),Ee(Ae(t,s,o.add(d(1))),i,r,a.sub(1)),Ee(Ae(t.add(d(1)),s,o.add(d(1))),i.sub(1),r,a.sub(1)),Ee(Ae(t,s.add(d(1)),o.add(d(1))),i,r.sub(1),a.sub(1)),Ee(Ae(t.add(d(1)),s.add(d(1)),o.add(d(1))),i.sub(1),r.sub(1),a.sub(1)),c,u,l)).toVar();return er(p)}),Hd=be([dr,hr]),$d=T(([n])=>{const e=h(n).toVar(),t=d(q(e)).toVar();return pe(B(t))}),Xd=T(([n])=>{const e=L(n).toVar(),t=d(q(e.x)).toVar(),s=d(q(e.y)).toVar();return pe(B(t,s))}),qd=T(([n])=>{const e=y(n).toVar(),t=d(q(e.x)).toVar(),s=d(q(e.y)).toVar(),o=d(q(e.z)).toVar();return pe(B(t,s,o))}),jd=T(([n])=>{const e=P(n).toVar(),t=d(q(e.x)).toVar(),s=d(q(e.y)).toVar(),o=d(q(e.z)).toVar(),i=d(q(e.w)).toVar();return pe(B(t,s,o,i))}),pr=T(([n])=>{const e=h(n).toVar(),t=d(q(e)).toVar();return y(pe(B(t,d(0))),pe(B(t,d(1))),pe(B(t,d(2))))}),mr=T(([n])=>{const e=L(n).toVar(),t=d(q(e.x)).toVar(),s=d(q(e.y)).toVar();return y(pe(B(t,s,d(0))),pe(B(t,s,d(1))),pe(B(t,s,d(2))))}),fr=T(([n])=>{const e=y(n).toVar(),t=d(q(e.x)).toVar(),s=d(q(e.y)).toVar(),o=d(q(e.z)).toVar();return y(pe(B(t,s,o,d(0))),pe(B(t,s,o,d(1))),pe(B(t,s,o,d(2))))}),gr=T(([n])=>{const e=P(n).toVar(),t=d(q(e.x)).toVar(),s=d(q(e.y)).toVar(),o=d(q(e.z)).toVar(),i=d(q(e.w)).toVar();return y(pe(B(t,s,o,i,d(0))),pe(B(t,s,o,i,d(1))),pe(B(t,s,o,i,d(2))))}),Nr=be([pr,mr,fr,gr]),Qt=T(([n,e,t,s])=>{const o=h(s).toVar(),i=h(t).toVar(),r=d(e).toVar(),a=y(n).toVar(),c=h(0).toVar(),u=h(1).toVar();return ue({start:d(0),end:r},({i:l})=>{c.addAssign(u.mul(kd(a))),u.mulAssign(o),a.mulAssign(i)}),c}),yr=T(([n,e,t,s])=>{const o=h(s).toVar(),i=h(t).toVar(),r=d(e).toVar(),a=y(n).toVar(),c=y(0).toVar(),u=h(1).toVar();return ue({start:d(0),end:r},({i:l})=>{c.addAssign(u.mul(Hd(a))),u.mulAssign(o),a.mulAssign(i)}),c}),Yd=T(([n,e,t,s])=>{const o=h(s).toVar(),i=h(t).toVar(),r=d(e).toVar(),a=y(n).toVar();return L(Qt(a,r,i,o),Qt(a.add(y(d(19),d(193),d(17))),r,i,o))}),Jd=T(([n,e,t,s])=>{const o=h(s).toVar(),i=h(t).toVar(),r=d(e).toVar(),a=y(n).toVar(),c=y(yr(a,r,i,o)).toVar(),u=h(Qt(a.add(y(d(19),d(193),d(17))),r,i,o)).toVar();return P(c,u)}),xr=T(([n,e,t,s,o,i,r])=>{const a=d(r).toVar(),c=h(i).toVar(),u=d(o).toVar(),l=d(s).toVar(),p=d(t).toVar(),f=d(e).toVar(),v=L(n).toVar(),_=y(Nr(L(f.add(l),p.add(u)))).toVar(),E=L(_.x,_.y).toVar();E.subAssign(.5),E.mulAssign(c),E.addAssign(.5);const O=L(L(h(f),h(p)).add(E)).toVar(),w=L(O.sub(v)).toVar();return W(a.equal(d(2)),()=>Re(w.x).add(Re(w.y))),W(a.equal(d(3)),()=>nt(Re(w.x),Re(w.y))),Pt(w,w)}),Tr=T(([n,e,t,s,o,i,r,a,c])=>{const u=d(c).toVar(),l=h(a).toVar(),p=d(r).toVar(),f=d(i).toVar(),v=d(o).toVar(),_=d(s).toVar(),E=d(t).toVar(),O=d(e).toVar(),w=y(n).toVar(),b=y(Nr(y(O.add(v),E.add(f),_.add(p)))).toVar();b.subAssign(.5),b.mulAssign(l),b.addAssign(.5);const C=y(y(h(O),h(E),h(_)).add(b)).toVar(),D=y(C.sub(w)).toVar();return W(u.equal(d(2)),()=>Re(D.x).add(Re(D.y).add(Re(D.z)))),W(u.equal(d(3)),()=>nt(nt(Re(D.x),Re(D.y)),Re(D.z))),Pt(D,D)}),Vt=be([xr,Tr]),Zd=T(([n,e,t])=>{const s=d(t).toVar(),o=h(e).toVar(),i=L(n).toVar(),r=d().toVar(),a=d().toVar(),c=L(k(i.x,r),k(i.y,a)).toVar(),u=h(1e6).toVar();return ue({start:-1,end:d(1),name:"x",condition:"<="},({x:l})=>{ue({start:-1,end:d(1),name:"y",condition:"<="},({y:p})=>{const f=h(Vt(c,l,p,r,a,o,s)).toVar();u.assign(It(u,f))})}),W(s.equal(d(0)),()=>{u.assign(ct(u))}),u}),Kd=T(([n,e,t])=>{const s=d(t).toVar(),o=h(e).toVar(),i=L(n).toVar(),r=d().toVar(),a=d().toVar(),c=L(k(i.x,r),k(i.y,a)).toVar(),u=L(1e6,1e6).toVar();return ue({start:-1,end:d(1),name:"x",condition:"<="},({x:l})=>{ue({start:-1,end:d(1),name:"y",condition:"<="},({y:p})=>{const f=h(Vt(c,l,p,r,a,o,s)).toVar();W(f.lessThan(u.x),()=>{u.y.assign(u.x),u.x.assign(f)}).elseif(f.lessThan(u.y),()=>{u.y.assign(f)})})}),W(s.equal(d(0)),()=>{u.assign(ct(u))}),u}),Qd=T(([n,e,t])=>{const s=d(t).toVar(),o=h(e).toVar(),i=L(n).toVar(),r=d().toVar(),a=d().toVar(),c=L(k(i.x,r),k(i.y,a)).toVar(),u=y(1e6,1e6,1e6).toVar();return ue({start:-1,end:d(1),name:"x",condition:"<="},({x:l})=>{ue({start:-1,end:d(1),name:"y",condition:"<="},({y:p})=>{const f=h(Vt(c,l,p,r,a,o,s)).toVar();W(f.lessThan(u.x),()=>{u.z.assign(u.y),u.y.assign(u.x),u.x.assign(f)}).elseif(f.lessThan(u.y),()=>{u.z.assign(u.y),u.y.assign(f)}).elseif(f.lessThan(u.z),()=>{u.z.assign(f)})})}),W(s.equal(d(0)),()=>{u.assign(ct(u))}),u}),eh=T(([n,e,t])=>{const s=d(t).toVar(),o=h(e).toVar(),i=y(n).toVar(),r=d().toVar(),a=d().toVar(),c=d().toVar(),u=y(k(i.x,r),k(i.y,a),k(i.z,c)).toVar(),l=h(1e6).toVar();return ue({start:-1,end:d(1),name:"x",condition:"<="},({x:p})=>{ue({start:-1,end:d(1),name:"y",condition:"<="},({y:f})=>{ue({start:-1,end:d(1),name:"z",condition:"<="},({z:v})=>{const _=h(Vt(u,p,f,v,r,a,c,o,s)).toVar();l.assign(It(l,_))})})}),W(s.equal(d(0)),()=>{l.assign(ct(l))}),l}),th=T(([n,e,t])=>{const s=d(t).toVar(),o=h(e).toVar(),i=y(n).toVar(),r=d().toVar(),a=d().toVar(),c=d().toVar(),u=y(k(i.x,r),k(i.y,a),k(i.z,c)).toVar(),l=L(1e6,1e6).toVar();return ue({start:-1,end:d(1),name:"x",condition:"<="},({x:p})=>{ue({start:-1,end:d(1),name:"y",condition:"<="},({y:f})=>{ue({start:-1,end:d(1),name:"z",condition:"<="},({z:v})=>{const _=h(Vt(u,p,f,v,r,a,c,o,s)).toVar();W(_.lessThan(l.x),()=>{l.y.assign(l.x),l.x.assign(_)}).elseif(_.lessThan(l.y),()=>{l.y.assign(_)})})})}),W(s.equal(d(0)),()=>{l.assign(ct(l))}),l}),sh=T(([n,e,t])=>{const s=d(t).toVar(),o=h(e).toVar(),i=y(n).toVar(),r=d().toVar(),a=d().toVar(),c=d().toVar(),u=y(k(i.x,r),k(i.y,a),k(i.z,c)).toVar(),l=y(1e6,1e6,1e6).toVar();return ue({start:-1,end:d(1),name:"x",condition:"<="},({x:p})=>{ue({start:-1,end:d(1),name:"y",condition:"<="},({y:f})=>{ue({start:-1,end:d(1),name:"z",condition:"<="},({z:v})=>{const _=h(Vt(u,p,f,v,r,a,c,o,s)).toVar();W(_.lessThan(l.x),()=>{l.z.assign(l.y),l.y.assign(l.x),l.x.assign(_)}).elseif(_.lessThan(l.y),()=>{l.z.assign(l.y),l.y.assign(_)}).elseif(_.lessThan(l.z),()=>{l.z.assign(_)})})})}),W(s.equal(d(0)),()=>{l.assign(ct(l))}),l});Nt.setLayout({name:"mx_select",type:"float",inputs:[{name:"b",type:"bool"},{name:"t",type:"float"},{name:"f",type:"float"}]});Dt.setLayout({name:"mx_negate_if",type:"float",inputs:[{name:"val",type:"float"},{name:"b",type:"bool"}]});q.setLayout({name:"mx_floor",type:"int",inputs:[{name:"x",type:"float"}]});Ui.setLayout({name:"mx_bilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"}]});Bi.setLayout({name:"mx_bilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"}]});Wi.setLayout({name:"mx_trilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"v4",type:"float"},{name:"v5",type:"float"},{name:"v6",type:"float"},{name:"v7",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]});ki.setLayout({name:"mx_trilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"v4",type:"vec3"},{name:"v5",type:"vec3"},{name:"v6",type:"vec3"},{name:"v7",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]});$i.setLayout({name:"mx_gradient_float_0",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"}]});Xi.setLayout({name:"mx_gradient_float_1",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]});qi.setLayout({name:"mx_gradient_vec3_0",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"}]});ji.setLayout({name:"mx_gradient_vec3_1",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]});Yi.setLayout({name:"mx_gradient_scale2d_0",type:"float",inputs:[{name:"v",type:"float"}]});Ji.setLayout({name:"mx_gradient_scale3d_0",type:"float",inputs:[{name:"v",type:"float"}]});Zi.setLayout({name:"mx_gradient_scale2d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]});Qi.setLayout({name:"mx_gradient_scale3d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]});xe.setLayout({name:"mx_rotl32",type:"uint",inputs:[{name:"x",type:"uint"},{name:"k",type:"int"}]});_t.setLayout({name:"mx_bjfinal",type:"uint",inputs:[{name:"a",type:"uint"},{name:"b",type:"uint"},{name:"c",type:"uint"}]});pe.setLayout({name:"mx_bits_to_01",type:"float",inputs:[{name:"bits",type:"uint"}]});Fe.setLayout({name:"mx_fade",type:"float",inputs:[{name:"t",type:"float"}]});sr.setLayout({name:"mx_hash_int_0",type:"uint",inputs:[{name:"x",type:"int"}]});nr.setLayout({name:"mx_hash_int_1",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]});or.setLayout({name:"mx_hash_int_2",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]});ir.setLayout({name:"mx_hash_int_3",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"}]});rr.setLayout({name:"mx_hash_int_4",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"},{name:"yy",type:"int"}]});ar.setLayout({name:"mx_hash_vec3_0",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]});cr.setLayout({name:"mx_hash_vec3_1",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]});ur.setLayout({name:"mx_perlin_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"}]});lr.setLayout({name:"mx_perlin_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"}]});dr.setLayout({name:"mx_perlin_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"}]});hr.setLayout({name:"mx_perlin_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"}]});$d.setLayout({name:"mx_cell_noise_float_0",type:"float",inputs:[{name:"p",type:"float"}]});Xd.setLayout({name:"mx_cell_noise_float_1",type:"float",inputs:[{name:"p",type:"vec2"}]});qd.setLayout({name:"mx_cell_noise_float_2",type:"float",inputs:[{name:"p",type:"vec3"}]});jd.setLayout({name:"mx_cell_noise_float_3",type:"float",inputs:[{name:"p",type:"vec4"}]});pr.setLayout({name:"mx_cell_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"float"}]});mr.setLayout({name:"mx_cell_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec2"}]});fr.setLayout({name:"mx_cell_noise_vec3_2",type:"vec3",inputs:[{name:"p",type:"vec3"}]});gr.setLayout({name:"mx_cell_noise_vec3_3",type:"vec3",inputs:[{name:"p",type:"vec4"}]});Qt.setLayout({name:"mx_fractal_noise_float",type:"float",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]});yr.setLayout({name:"mx_fractal_noise_vec3",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]});Yd.setLayout({name:"mx_fractal_noise_vec2",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]});Jd.setLayout({name:"mx_fractal_noise_vec4",type:"vec4",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]});xr.setLayout({name:"mx_worley_distance_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});Tr.setLayout({name:"mx_worley_distance_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"zoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});Zd.setLayout({name:"mx_worley_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});Kd.setLayout({name:"mx_worley_noise_vec2_0",type:"vec2",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});Qd.setLayout({name:"mx_worley_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});eh.setLayout({name:"mx_worley_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});th.setLayout({name:"mx_worley_noise_vec2_1",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});sh.setLayout({name:"mx_worley_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});const nh=T(([n])=>{const e=y(n).toVar(),t=h(e.x).toVar(),s=h(e.y).toVar(),o=h(e.z).toVar();W(s.lessThan(1e-4),()=>y(o,o,o)).else(()=>{t.assign(X(6,t.sub(Ft(t))));const i=d(go(t)).toVar(),r=h(t.sub(h(i))).toVar(),a=h(o.mul(de(1,s))).toVar(),c=h(o.mul(de(1,s.mul(r)))).toVar(),u=h(o.mul(de(1,s.mul(de(1,r))))).toVar();return W(i.equal(d(0)),()=>y(o,u,a)).elseif(i.equal(d(1)),()=>y(c,o,a)).elseif(i.equal(d(2)),()=>y(a,o,u)).elseif(i.equal(d(3)),()=>y(a,c,o)).elseif(i.equal(d(4)),()=>y(u,a,o)),y(o,a,c)})}),oh=T(([n])=>{const e=y(n).toVar(),t=h(e.x).toVar(),s=h(e.y).toVar(),o=h(e.z).toVar(),i=h(It(t,It(s,o))).toVar(),r=h(nt(t,nt(s,o))).toVar(),a=h(r.sub(i)).toVar(),c=h().toVar(),u=h().toVar(),l=h().toVar();return l.assign(r),W(r.greaterThan(0),()=>{u.assign(a.div(r))}).else(()=>{u.assign(0)}),W(u.lessThanEqual(0),()=>{c.assign(0)}).else(()=>{W(t.greaterThanEqual(r),()=>{c.assign(s.sub(o).div(a))}).elseif(s.greaterThanEqual(r),()=>{c.assign(Le(2,o.sub(t).div(a)))}).else(()=>{c.assign(Le(4,t.sub(s).div(a)))}),c.mulAssign(1/6),W(c.lessThan(0),()=>{c.addAssign(1)})}),y(c,u,l)});nh.setLayout({name:"mx_hsvtorgb",type:"vec3",inputs:[{name:"hsv",type:"vec3"}]});oh.setLayout({name:"mx_rgbtohsv",type:"vec3",inputs:[{name:"c",type:"vec3"}]});const ih=T(([n])=>{const e=y(n).toVar(),t=Zn(po(e,y(.04045))).toVar(),s=y(e.div(12.92)).toVar(),o=y(Js(nt(e.add(y(.055)),y(0)).div(1.055),y(2.4))).toVar();return Ge(s,o,t)});ih.setLayout({name:"mx_srgb_texture_to_lin_rec709",type:"vec3",inputs:[{name:"color",type:"vec3"}]});window.MOTIONPAGE_FRONT={version:"2.1.6"};window.MOTIONPAGE_FRONT.mouse={pos:{x:0,y:0},isWithinTarget(n){return this.pos.x>=n.left&&this.pos.x<=n.right&&this.pos.y>=n.top&&this.pos.y<=n.bottom},posWithinTarget(n,e,t){let s=typeof e=="string"?document.querySelector(e):e;if(!s)return{v:-1};let o=s.getBoundingClientRect();return this.isWithinTarget(o)?{v:(this.pos[n]-o[n==="x"?"left":"top"])/o[n==="x"?"width":"height"],wt:!0}:{v:t,wt:!1}},scrollbarWidth:-1,getScrollbarWidth(){if(this.scrollbarWidth!==-1)return this.scrollbarWidth;let n=document.createElement("div");n.style.overflow="scroll",document.body.appendChild(n);let e=n.offsetWidth-n.clientWidth;return document.body.removeChild(n),this.scrollbarWidth=e+1,e},distance(n){let e=typeof n=="string"?document.querySelector(n):n;if(!e)return-1;let t=e.getBoundingClientRect();if(!t||!this.isWithinTarget(t))return-1;let s=t.left+t.width/2,o=t.top+scrollY+t.height/2,i=Math.sqrt(Math.pow(this.pos.x-s,2)+Math.pow(this.pos.y+scrollY-o,2)),r=Math.sqrt(Math.pow(innerWidth/2,2)+Math.pow(innerHeight/2,2));return 1-i/r},smoothEnter(n,e,t,s){ye.ticker.remove(n),e.tweenFromTo(e.time(),e.totalDuration()*t,{onComplete(){ye.ticker.add(n)},duration:s/1e3,ease:"none"})},smoothLeave(n,e){n.progress<e.progress()?ye.to(e,n):e.tweenTo(n.progress,n)}};document.body.addEventListener("mousemove",n=>{window.MOTIONPAGE_FRONT.mouse&&(window.MOTIONPAGE_FRONT.mouse.pos={x:n.clientX,y:n.clientY})});document.addEventListener("DOMContentLoaded",function(){const n=document.querySelector("#dh_cursor"),e=n.querySelector(".dh_cursor__circle"),t={x:-100,y:-100},s={x:0,y:0},o=.2,i=p=>{t.x=p.clientX,t.y=p.clientY};window.addEventListener("mousemove",i);function r(p,f){return Math.atan2(f,p)*180/Math.PI}function a(p,f){const v=Math.sqrt(Math.pow(p,2)+Math.pow(f,2));return Math.min(v/1500,.15)}const c=()=>{const p=Math.round(t.x-s.x),f=Math.round(t.y-s.y);s.x+=p*o,s.y+=f*o;const v=r(p,f),_=a(p,f),E="scale("+(1+_)+", "+(1-_)+")",O="rotate("+v+"deg)",w="translate3d("+s.x+"px ,"+s.y+"px, 0)";n.style.transform=w,e.style.transform=O+E};function u(){c(),requestAnimationFrame(u)}requestAnimationFrame(u),document.querySelectorAll("[cursor-class]").forEach(p=>{p.addEventListener("mouseenter",function(){const f=this.getAttribute("cursor-class");n.classList.add(f)}),p.addEventListener("mouseleave",function(){const f=this.getAttribute("cursor-class");n.classList.remove(f)})})});window.addEventListener("load",()=>{ye.context(()=>{ye.timeline().to(".hey-content",{scale:.8,ease:"sine.inOut",duration:4}).to(".section-content",{"padding-top":"5svh",duration:4}).yoyo(!0).repeat(-1)}),window._$W=window,matchMedia("screen and (min-width: 1100px)").matches&&(ye.context(()=>{ye.timeline().set(".dh_transition_scale_wrapper",{autoAlpha:1}).to(".progress_bar",{ease:"power1",width:"1px",height:"calc(100vh - 400px)"},1.7).to(".progress_bar",{autoAlpha:1,display:"none",duration:.1},3).fromTo(".progress_bar",{width:"20px",height:"20px"},{ease:"power1",width:"1px",height:"1px","border-radius":0,duration:.7},1).fromTo(".progress_bar",{x:"50vw",ease:"power4.inOut"},{autoAlpha:1,x:"0vw",duration:.9},.1).to("#dh_preloader",{display:"none",duration:.1},0).to(".curtain_left",{transformOrigin:"0% 50%",width:"0px",ease:"power4.inOut",duration:1.5},2.6).to(".curtain_right",{transformOrigin:"100% 50%",width:"0px",ease:"power4.inOut",duration:1.5},2.6).to(".dh_home_transitions",{display:"none",duration:.1},4.1).from(".dh_transition_scale_wrapper",{width:"calc(100vw - 400px)",height:"calc(100vh - 400px)",margin:"200px","border-radius":"10px",ease:"power3.inOut",duration:.8},4.8).from(".home_animation_wrapper",{scale:.87,transformOrigin:"55% 33%",ease:"power3.inOut",duration:.8},4.8).to(".dh_transition_scale_wrapper",{autoAlpha:0,duration:.1},5.6).to(".dh_home_transitions",{background:"rgba(0, 0, 0, 0)",duration:.1},0).to(".hey_3d_animation",{ease:"power3.inOut",onUpdate:function(){this._targets.map(({_lottie:n})=>{n&&n.goToAndStop(this.progress()*n.totalFrames,!0)})}},3.9)}),ye.context(()=>{function n(){_$W.tl.progress(_$W.MOTIONPAGE_FRONT.mouse.pos.x/(_$W.innerWidth-_$W.MOTIONPAGE_FRONT.mouse.getScrollbarWidth()))}function e(){_$W.tl2.progress(_$W.MOTIONPAGE_FRONT.mouse.pos.y/_$W.innerHeight)}return _$W.tl=ye.timeline().fromTo(".section-content",{rotationX:0,rotationY:0,rotationZ:0,xPercent:0,yPercent:0},{rotationX:10,rotationY:10,rotationZ:10,xPercent:15,yPercent:0},0),_$W.tl2=ye.timeline().fromTo(".section-content",{scale:1,skewX:"0deg"},{scale:1.1,skewX:"20deg"},0),ye.ticker.add(n),ye.ticker.add(e),()=>{ye.ticker.remove(n),ye.ticker.remove(e)}}))});
